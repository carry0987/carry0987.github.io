import{a as d,R as Z,p as e,w as ge}from"./chunk-WWGJGFF6-B6u1Qf49.js";import{s as xe,g as be,r as ve}from"./index-Cpx2NyP8.js";import{u as T,e as ye,a as ne,_ as re,v as we,b as O,M as je,C as Se}from"./constants-BBDI6V1X.js";import{V as z,a as Me,j as ke,k as me,l as Ne,m as Re,e as _e,g as U,n as Ie,H as Ce,L as se,D as Ee,o as Pe,p as K,q as oe,f as Te,r as Ae,s as Ge,t as Be,u as B,d as De,v as fe,w as pe,x as ze}from"./three.module-BciEV48b.js";import{s as Fe,E as Le}from"./Environment-CIYW_Ags.js";var b=(o=>(o.None="None",o.Road="Road",o.Residential="Residential",o.Commercial="Commercial",o.Industrial="Industrial",o.Park="Park",o))(b||{});const G=15,Oe=2e3,$e=1e6,q={[b.None]:{type:b.None,cost:0,name:"Bulldoze",description:"Clear a tile",color:"#ef4444",popGen:0,incomeGen:0},[b.Road]:{type:b.Road,cost:10,name:"Road",description:"Connects buildings.",color:"#374151",popGen:0,incomeGen:0},[b.Residential]:{type:b.Residential,cost:100,name:"House",description:"+5 Pop/day",color:"#f87171",popGen:5,incomeGen:0},[b.Commercial]:{type:b.Commercial,cost:200,name:"Shop",description:"+$15/day",color:"#60a5fa",popGen:0,incomeGen:15},[b.Industrial]:{type:b.Industrial,cost:400,name:"Factory",description:"+$40/day",color:"#facc15",popGen:0,incomeGen:40},[b.Park]:{type:b.Park,cost:50,name:"Park",description:"Looks nice.",color:"#4ade80",popGen:1,incomeGen:0}},Ue="sky-metropolis-db",F="saves",V="current-save",Ve=1;class He{db=null;dbReady;constructor(){this.dbReady=this.initDB()}initDB(){return new Promise((n,s)=>{if(typeof window>"u"||!window.indexedDB){n();return}const a=indexedDB.open(Ue,1);a.onerror=()=>{console.error("Failed to open IndexedDB:",a.error),s(a.error)},a.onsuccess=()=>{this.db=a.result,n()},a.onupgradeneeded=t=>{const r=t.target.result;r.objectStoreNames.contains(F)||r.createObjectStore(F)}})}async save(n,s){await this.dbReady;const a={grid:n,stats:s,savedAt:Date.now(),version:Ve};return this.db?new Promise(t=>{const c=this.db.transaction([F],"readwrite").objectStore(F).put(a,V);c.onsuccess=()=>t(!0),c.onerror=()=>{console.error("IndexedDB save failed, trying localStorage"),t(this.saveToLocalStorage(a))}}):this.saveToLocalStorage(a)}saveToLocalStorage(n){try{return xe(V,n),!0}catch(s){return console.error("localStorage save failed:",s),!1}}async load(){if(await this.dbReady,this.db){const n=await new Promise(s=>{const r=this.db.transaction([F],"readonly").objectStore(F).get(V);r.onsuccess=()=>s(r.result||null),r.onerror=()=>{console.error("IndexedDB load failed, trying localStorage"),s(null)}});if(n)return n}return this.loadFromLocalStorage()}loadFromLocalStorage(){try{const n=be(V,!0);if(n)return n}catch(n){console.error("localStorage load failed:",n)}return null}async deleteSave(){if(await this.dbReady,this.db)return new Promise(n=>{const t=this.db.transaction([F],"readwrite").objectStore(F).delete(V);t.onsuccess=()=>n(!0),t.onerror=()=>n(!1)});try{return ve(V),!0}catch{return!1}}async hasSave(){return await this.load()!==null}}const J=new He;function We(o,n=Math.PI/3){const s=Math.cos(n),a=(1+1e-10)*100,t=[new z,new z,new z],r=new z,i=new z,c=new z,u=new z;function l(j){const x=~~(j.x*a),v=~~(j.y*a),p=~~(j.z*a);return`${x},${v},${p}`}const f=o.index?o.toNonIndexed():o,h=f.attributes.position,g={};for(let j=0,x=h.count/3;j<x;j++){const v=3*j,p=t[0].fromBufferAttribute(h,v+0),y=t[1].fromBufferAttribute(h,v+1),I=t[2].fromBufferAttribute(h,v+2);r.subVectors(I,y),i.subVectors(p,y);const M=new z().crossVectors(r,i).normalize();for(let S=0;S<3;S++){const N=t[S],_=l(N);_ in g||(g[_]=[]),g[_].push(M)}}const m=new Float32Array(h.count*3),w=new Me(m,3,!1);for(let j=0,x=h.count/3;j<x;j++){const v=3*j,p=t[0].fromBufferAttribute(h,v+0),y=t[1].fromBufferAttribute(h,v+1),I=t[2].fromBufferAttribute(h,v+2);r.subVectors(I,y),i.subVectors(p,y),c.crossVectors(r,i).normalize();for(let M=0;M<3;M++){const S=t[M],N=l(S),_=g[N];u.set(0,0,0);for(let E=0,P=_.length;E<P;E++){const k=_[E];c.dot(k)>s&&u.add(k)}u.normalize(),w.setXYZ(v+M,u.x,u.y,u.z)}}return f.setAttribute("normal",w),f}const ae=Fe({screenspace:!1,color:new U("black"),opacity:1,thickness:.05,size:new me},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${we>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function Ye({color:o="black",opacity:n=1,transparent:s=!1,screenspace:a=!1,toneMapped:t=!0,polygonOffset:r=!1,polygonOffsetFactor:i=0,renderOrder:c=0,thickness:u=.05,angle:l=Math.PI,clippingPlanes:f,...h}){const g=d.useRef(null),[m]=d.useState(()=>new ae({side:ke})),{gl:w}=T(),j=w.getDrawingBufferSize(new me);d.useMemo(()=>ye({OutlinesMaterial:ae}),[]);const x=d.useRef(0),v=d.useRef(null);return d.useLayoutEffect(()=>{const p=g.current;if(!p)return;const y=p.parent;if(y&&y.geometry&&(x.current!==l||v.current!==y.geometry)){var I;x.current=l,v.current=y.geometry;let M=(I=p.children)==null?void 0:I[0];M&&(l&&M.geometry.dispose(),p.remove(M)),y.skeleton?(M=new Ne,M.material=m,M.bind(y.skeleton,y.bindMatrix),p.add(M)):y.isInstancedMesh?(M=new Re(y.geometry,m,y.count),M.instanceMatrix=y.instanceMatrix,p.add(M)):(M=new _e,M.material=m,p.add(M)),M.geometry=l?We(y.geometry,l):y.geometry,M.morphTargetInfluences=y.morphTargetInfluences,M.morphTargetDictionary=y.morphTargetDictionary}}),d.useLayoutEffect(()=>{const p=g.current;if(!p)return;const y=p.children[0];if(y){y.renderOrder=c;const I=p.parent;ne(y,{morphTargetInfluences:I.morphTargetInfluences,morphTargetDictionary:I.morphTargetDictionary}),ne(y.material,{transparent:s,thickness:u,color:o,opacity:n,size:j,screenspace:a,toneMapped:t,polygonOffset:r,polygonOffsetFactor:i,clippingPlanes:f,clipping:f&&f.length>0})}}),d.useEffect(()=>()=>{const p=g.current;if(!p)return;const y=p.children[0];y&&(l&&y.geometry.dispose(),p.remove(y))},[]),d.createElement("group",re({ref:g},h))}function qe(o,n,s){const a=T(m=>m.size),t=T(m=>m.viewport),r=typeof o=="number"?o:a.width*t.dpr,i=a.height*t.dpr,c=(typeof o=="number"?s:o)||{},{samples:u=0,depth:l,...f}=c,h=l??c.depthBuffer,g=d.useMemo(()=>{const m=new Ie(r,i,{minFilter:se,magFilter:se,type:Ce,...f});return h&&(m.depthTexture=new Ee(r,i,Pe)),m.samples=u,m},[]);return d.useLayoutEffect(()=>{g.setSize(r,i),u&&(g.samples=u)},[u,g,r,i]),d.useEffect(()=>()=>g.dispose(),[]),g}const Ze=o=>typeof o=="function",Xe=d.forwardRef(({envMap:o,resolution:n=256,frames:s=1/0,children:a,makeDefault:t,...r},i)=>{const c=T(({set:x})=>x),u=T(({camera:x})=>x),l=T(({size:x})=>x),f=d.useRef(null);d.useImperativeHandle(i,()=>f.current,[]);const h=d.useRef(null),g=qe(n);d.useLayoutEffect(()=>{r.manual||f.current.updateProjectionMatrix()},[l,r]),d.useLayoutEffect(()=>{f.current.updateProjectionMatrix()}),d.useLayoutEffect(()=>{if(t){const x=u;return c(()=>({camera:f.current})),()=>c(()=>({camera:x}))}},[f,t,c]);let m=0,w=null;const j=Ze(a);return O(x=>{j&&(s===1/0||m<s)&&(h.current.visible=!1,x.gl.setRenderTarget(g),w=x.scene.background,o&&(x.scene.background=o),x.gl.render(x.scene,f.current),x.scene.background=w,x.gl.setRenderTarget(null),h.current.visible=!0,m++)}),d.createElement(d.Fragment,null,d.createElement("orthographicCamera",re({left:l.width/-2,right:l.width/2,top:l.height/2,bottom:l.height/-2,ref:f},r),!j&&a),d.createElement("group",{ref:h},j&&a(g.texture)))}),Ke=d.forwardRef((o={enableDamping:!0},n)=>{const{domElement:s,camera:a,makeDefault:t,onChange:r,onStart:i,onEnd:c,...u}=o,l=T(p=>p.invalidate),f=T(p=>p.camera),h=T(p=>p.gl),g=T(p=>p.events),m=T(p=>p.set),w=T(p=>p.get),j=s||g.connected||h.domElement,x=a||f,v=d.useMemo(()=>new je(x),[x]);return d.useEffect(()=>{v.connect(j);const p=y=>{l(),r&&r(y)};return v.addEventListener("change",p),i&&v.addEventListener("start",i),c&&v.addEventListener("end",c),()=>{v.dispose(),v.removeEventListener("change",p),i&&v.removeEventListener("start",i),c&&v.removeEventListener("end",c)}},[r,i,c,v,l,j]),d.useEffect(()=>{if(t){const p=w().controls;return m({controls:v}),()=>m({controls:p})}},[t,v]),O(()=>v.update(),-1),d.createElement("primitive",re({ref:n,object:v,enableDamping:!0},u))}),Je=({focus:o=0,size:n=25,samples:s=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${n})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${o});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${s}; i ++) {
    offset = (vogelDiskSample(j, ${s}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${s}; i++) {
    vogelSample = vogelDiskSample(j, ${s}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${n}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${s}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`;function ie(o,n,s){n.traverse(a=>{a.material&&(o.properties.remove(a.material),a.material.dispose==null||a.material.dispose())}),o.info.programs.length=0,o.compile(n,s)}function Qe({focus:o=0,samples:n=10,size:s=25}){const a=T(i=>i.gl),t=T(i=>i.scene),r=T(i=>i.camera);return d.useEffect(()=>{const i=K.shadowmap_pars_fragment;return K.shadowmap_pars_fragment=K.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP",`#ifdef USE_SHADOWMAP
`+Je({size:s,samples:n,focus:o})).replace("#if defined( SHADOWMAP_TYPE_PCF )",`
return PCSS(shadowMap, shadowCoord);
#if defined( SHADOWMAP_TYPE_PCF )`),ie(a,t,r),()=>{K.shadowmap_pars_fragment=i,ie(a,t,r)}},[o,s,n]),null}const et=d.forwardRef(({children:o,enabled:n=!0,speed:s=1,rotationIntensity:a=1,floatIntensity:t=1,floatingRange:r=[-.1,.1],autoInvalidate:i=!1,...c},u)=>{const l=d.useRef(null);d.useImperativeHandle(u,()=>l.current,[]);const f=d.useRef(Math.random()*1e4);return O(h=>{var g,m;if(!n||s===0)return;i&&h.invalidate();const w=f.current+h.clock.elapsedTime;l.current.rotation.x=Math.cos(w/4*s)/8*a,l.current.rotation.y=Math.sin(w/4*s)/8*a,l.current.rotation.z=Math.sin(w/4*s)/20*a;let j=Math.sin(w/4*s)/10;j=oe.mapLinear(j,-.1,.1,(g=r?.[0])!==null&&g!==void 0?g:-.1,(m=r?.[1])!==null&&m!==void 0?m:.1),l.current.position.y=j*t,l.current.updateMatrix()}),d.createElement("group",c,d.createElement("group",{ref:l,matrixAutoUpdate:!1},o))}),le=G/2-.5,W=(o,n)=>[o-le,0,n-le],Y=(o,n)=>Math.abs(Math.sin(o*12.9898+n*78.233)*43758.5453)%1,D=(o,n)=>Math.random()*(n-o)+o,R=new Te(1,1,1),H=new Ae(1,1,1,8),Q=new Ge(1,1,4),he=new Be(1,8,8),L=Z.memo(({position:o,scale:n})=>e.jsx("mesh",{geometry:R,position:o,scale:n,children:e.jsx("meshStandardMaterial",{color:"#bfdbfe",emissive:"#bfdbfe",emissiveIntensity:.2,roughness:.1,metalness:.8})})),tt=({position:o})=>{const n=d.useRef(null);return O(s=>{n.current&&n.current.children.forEach((a,t)=>{const r=a;r.position.y+=.01+t*.005,r.scale.addScalar(.005);const i=r.material;i&&(i.opacity-=.005,r.position.y>1.5&&(r.position.y=0,r.scale.setScalar(.1+Math.random()*.1),i.opacity=.6))})}),e.jsxs("group",{position:o,children:[e.jsx("mesh",{geometry:H,castShadow:!0,receiveShadow:!0,position:[0,.5,0],scale:[.2,1,.2],children:e.jsx("meshStandardMaterial",{color:"#4b5563"})}),e.jsx("group",{ref:n,position:[0,1,0],children:[0,1,2].map(s=>e.jsx("mesh",{geometry:he,position:[Math.random()*.1,s*.4,Math.random()*.1],scale:.2,children:e.jsx("meshStandardMaterial",{color:"#d1d5db",transparent:!0,opacity:.6,flatShading:!0})},s))})]})},ce=Z.memo(({type:o,baseColor:n,x:s,y:a,opacity:t=1,transparent:r=!1})=>{const i=Y(s,a),c=Math.floor(i*100),u=Math.floor(i*4)*(Math.PI/2),l=d.useMemo(()=>{const j=new U(n);return j.offsetHSL(i*.1-.05,0,i*.2-.1),j},[n,i]),f=d.useMemo(()=>new B({color:l,flatShading:!0,opacity:t,transparent:r,roughness:.8}),[l,t,r]),h=d.useMemo(()=>new B({color:new U(l).multiplyScalar(.7),flatShading:!0,opacity:t,transparent:r}),[l,t,r]),g=d.useMemo(()=>new B({color:new U(l).multiplyScalar(.5).offsetHSL(0,0,-.1),flatShading:!0,opacity:t,transparent:r}),[l,t,r]),m={castShadow:!0,receiveShadow:!0},w=-.3;return e.jsx("group",{rotation:[0,u,0],position:[0,w,0],children:(()=>{switch(o){case b.Residential:return c<33?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...m,material:f,geometry:R,position:[0,.3,0],scale:[.7,.6,.6]}),e.jsx("mesh",{...m,material:g,geometry:Q,position:[0,.75,0],scale:[.6,.4,.6],rotation:[0,Math.PI/4,0]}),e.jsx(L,{position:[.2,.3,.31],scale:[.15,.2,.05]}),e.jsx(L,{position:[-.2,.3,.31],scale:[.15,.2,.05]}),e.jsx("mesh",{...m,material:h,geometry:R,position:[0,.1,.32],scale:[.15,.2,.05]})]}):c<66?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...m,material:f,geometry:R,position:[-.1,.35,0],scale:[.6,.7,.8]}),e.jsx("mesh",{...m,material:h,geometry:R,position:[.25,.25,.1],scale:[.4,.5,.6]}),e.jsx(L,{position:[-.1,.5,.41],scale:[.4,.2,.05]})]}):e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...m,material:f,geometry:R,position:[0,.5,0],scale:[.5,1,.6]}),e.jsx("mesh",{...m,material:g,geometry:R,position:[0,1.05,0],scale:[.55,.1,.65]}),e.jsx(L,{position:[0,.7,.31],scale:[.3,.2,.05]}),e.jsx(L,{position:[0,.3,.31],scale:[.3,.2,.05]})]});case b.Commercial:if(c<40){const v=1.5+i*1.5;return e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...m,material:f,geometry:R,position:[0,v/2,0],scale:[.7,v,.7]}),Array.from({length:Math.floor(v*3)}).map((p,y)=>e.jsx(L,{position:[0,.2+y*.3,0],scale:[.72,.15,.72]},y)),e.jsx("mesh",{...m,material:h,geometry:R,position:[0,v+.1,0],scale:[.5,.2,.5]})]})}else return c<70?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...m,material:f,geometry:R,position:[0,.4,0],scale:[.9,.8,.8]}),e.jsx(L,{position:[0,.3,.41],scale:[.8,.4,.05]}),e.jsx("mesh",{...m,material:new B({color:i>.5?"#ef4444":"#3b82f6"}),geometry:R,position:[0,.55,.5],scale:[.9,.1,.2],rotation:[Math.PI/6,0,0]})]}):e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...m,material:f,geometry:R,position:[-.2,.5,-.2],scale:[.5,1,.5]}),e.jsx("mesh",{...m,material:h,geometry:R,position:[.1,.3,.1],scale:[.7,.6,.7]}),e.jsx(L,{position:[.1,.3,.46],scale:[.6,.3,.05]}),e.jsx("mesh",{...m,material:new B({color:"#9ca3af"}),geometry:R,position:[.2,.65,.2],scale:[.2,.1,.2]})]});case b.Industrial:return c<50?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...m,material:f,geometry:R,position:[0,.4,0],scale:[.9,.8,.8]}),e.jsx("mesh",{...m,material:g,geometry:R,position:[-.2,.9,0],scale:[.4,.2,.8],rotation:[0,0,Math.PI/4]}),e.jsx("mesh",{...m,material:g,geometry:R,position:[.2,.9,0],scale:[.4,.2,.8],rotation:[0,0,Math.PI/4]}),e.jsx(tt,{position:[.3,.4,.3]})]}):e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...m,material:f,geometry:R,position:[-.2,.3,0],scale:[.5,.6,.9]}),e.jsx("mesh",{...m,material:h,geometry:H,position:[.25,.4,-.2],scale:[.2,.8,.2]}),e.jsx("mesh",{...m,material:h,geometry:H,position:[.25,.4,.25],scale:[.2,.8,.2]}),e.jsx("mesh",{...m,material:new B({color:"#6b7280"}),geometry:R,position:[.25,.7,0],scale:[.05,.05,.5]})]});case b.Park:const j=1+Math.floor(i*3),x=[[-.2,-.2],[.2,.2],[-.2,.2],[.2,-.2]];return e.jsxs("group",{position:[0,-w-.29,0],children:[" ",e.jsxs("mesh",{receiveShadow:!0,rotation:[-Math.PI/2,0,0],position:[0,.01,0],children:[e.jsx("planeGeometry",{args:[.9,.9]}),e.jsx("meshStandardMaterial",{color:"#86efac"})]}),c<30&&e.jsxs("group",{position:[0,.05,0],children:[e.jsx("mesh",{material:new B({color:"#cbd5e1"}),geometry:H,scale:[.4,.1,.4],castShadow:!0,receiveShadow:!0}),e.jsx("mesh",{material:new B({color:"#3b82f6",roughness:.1}),geometry:H,position:[0,.06,0],scale:[.3,.05,.3]})]}),Array.from({length:j}).map((v,p)=>{const y=x[p%x.length],I=.5+Y(s+p,a-p)*.5,M=new U("#166534").offsetHSL(0,0,Y(s,a+p)*.2);return e.jsxs("group",{position:[y[0],0,y[1]],scale:I,rotation:[0,Y(p,s)*Math.PI,0],children:[e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:new B({color:"#78350f"}),geometry:H,position:[0,.15,0],scale:[.1,.3,.1]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:new B({color:M,flatShading:!0}),geometry:Q,position:[0,.4,0],scale:[.4,.5,.4]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:new B({color:M,flatShading:!0}),geometry:Q,position:[0,.65,0],scale:[.3,.4,.3]})]},p)})]});case b.Road:return null;default:return null}})()})}),de=["#ef4444","#3b82f6","#eab308","#ffffff","#1f2937","#f97316"],ot=({grid:o})=>{const n=d.useMemo(()=>{const i=[];return o.forEach(c=>c.forEach(u=>{u.buildingType===b.Road&&i.push({x:u.x,y:u.y})})),i},[o]),s=Math.min(n.length,30),a=d.useRef(null),t=d.useRef(new Float32Array(0)),r=d.useMemo(()=>new fe,[]);return d.useMemo(()=>new Float32Array(0),[]),d.useEffect(()=>{if(n.length<2)return;t.current=new Float32Array(s*6);const i=new Float32Array(s*3);for(let c=0;c<s;c++){const u=n[Math.floor(Math.random()*n.length)];t.current[c*6+0]=u.x,t.current[c*6+1]=u.y,t.current[c*6+2]=u.x,t.current[c*6+3]=u.y,t.current[c*6+4]=1,t.current[c*6+5]=D(.01,.03);const l=new U(de[Math.floor(Math.random()*de.length)]);i[c*3]=l.r,i[c*3+1]=l.g,i[c*3+2]=l.b}a.current&&(a.current.instanceColor=new pe(i,3))},[n,s]),O(()=>{if(!(!a.current||n.length<2||t.current.length===0)){for(let i=0;i<s;i++){const c=i*6;let u=t.current[c],l=t.current[c+1],f=t.current[c+2],h=t.current[c+3],g=t.current[c+4];const m=t.current[c+5];if(g+=m,g>=1){u=f,l=h,g=0;const P=n.filter(k=>Math.abs(k.x-u)===1&&k.y===l||Math.abs(k.y-l)===1&&k.x===u);if(P.length>0){const k=P.length>1?P.filter(A=>Math.abs(A.x-t.current[c])>.1||Math.abs(A.y-t.current[c+1])>.1):P,C=k.length>0?k[Math.floor(Math.random()*k.length)]:P[0];f=C.x,h=C.y}else{const k=n[Math.floor(Math.random()*n.length)];u=k.x,l=k.y,f=k.x,h=k.y}}t.current[c]=u,t.current[c+1]=l,t.current[c+2]=f,t.current[c+3]=h,t.current[c+4]=g;const w=oe.lerp(u,f,g),j=oe.lerp(l,h,g),x=f-u,v=h-l,p=Math.atan2(v,x),y=.15,I=Math.sqrt(x*x+v*v)||1,M=-v/I*y,S=x/I*y,[N,_,E]=W(w+M,j+S);r.position.set(N,-.3+.075,E),r.rotation.set(0,-p,0),r.scale.set(.5,.15,.3),r.updateMatrix(),a.current.setMatrixAt(i,r.matrix)}a.current.instanceMatrix.needsUpdate=!0}}),n.length<2?null:e.jsx("instancedMesh",{ref:a,args:[R,void 0,s],castShadow:!0,children:e.jsx("meshStandardMaterial",{roughness:.5,metalness:.3})})},ue=["#ef4444","#3b82f6","#10b981","#f59e0b","#8b5cf6","#ec4899","#ffffff"],rt=({population:o,grid:n})=>{const s=Math.min(Math.floor(o/2),300),a=d.useRef(null),t=d.useMemo(()=>{const c=[];return n.forEach(u=>u.forEach(l=>{(l.buildingType===b.Road||l.buildingType===b.Park||l.buildingType===b.None)&&c.push({x:l.x,y:l.y})})),c},[n]),r=d.useRef(new Float32Array(0)),i=d.useMemo(()=>new fe,[]);return d.useEffect(()=>{if(s===0||t.length===0)return;r.current=new Float32Array(s*6);const c=new Float32Array(s*3);for(let u=0;u<s;u++){const l=t[Math.floor(Math.random()*t.length)],f=l.x+D(-.4,.4),h=l.y+D(-.4,.4);r.current[u*6+0]=f,r.current[u*6+1]=h;const g=t[Math.floor(Math.random()*t.length)];r.current[u*6+2]=g.x+D(-.4,.4),r.current[u*6+3]=g.y+D(-.4,.4),r.current[u*6+4]=D(.005,.015),r.current[u*6+5]=Math.random()*Math.PI*2;const m=new U(ue[Math.floor(Math.random()*ue.length)]);c[u*3]=m.r,c[u*3+1]=m.g,c[u*3+2]=m.b}a.current&&(a.current.instanceColor=new pe(c,3))},[s,t]),O(c=>{if(!a.current||s===0||r.current.length===0)return;const u=c.clock.elapsedTime;for(let l=0;l<s;l++){const f=l*6;let h=r.current[f],g=r.current[f+1],m=r.current[f+2],w=r.current[f+3];const j=r.current[f+4],x=r.current[f+5],v=m-h,p=w-g,y=Math.sqrt(v*v+p*p);if(y<.1){if(t.length>0){const k=t[Math.floor(Math.random()*t.length)];m=k.x+D(-.4,.4),w=k.y+D(-.4,.4),r.current[f+2]=m,r.current[f+3]=w}}else h+=v/y*j,g+=p/y*j,r.current[f]=h,r.current[f+1]=g;const[I,M,S]=W(h,g),N=Math.abs(Math.sin(u*10+x))*.03,_=.2,E=.08;i.position.set(I,-.35+_/2+N,S),i.rotation.set(0,-Math.atan2(p,v),0),i.scale.set(E,_,E),i.updateMatrix(),a.current.setMatrixAt(l,i.matrix)}a.current.instanceMatrix.needsUpdate=!0}),s===0?null:e.jsx("instancedMesh",{ref:a,args:[R,void 0,s],castShadow:!0,children:e.jsx("meshStandardMaterial",{roughness:.8})})},ee=({position:o,scale:n,speed:s})=>{const a=d.useRef(null);O((r,i)=>{a.current&&(a.current.position.x+=s*i,a.current.position.x>G*1.5&&(a.current.position.x=-G*1.5))});const t=d.useMemo(()=>Array.from({length:5+Math.random()*5}).map(()=>({pos:[D(-1,1),D(-.5,.5),D(-1,1)],scale:D(.5,1.2)})),[]);return e.jsx("group",{ref:a,position:o,scale:n,children:t.map((r,i)=>e.jsx("mesh",{geometry:he,position:r.pos,scale:r.scale,castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"white",flatShading:!0,opacity:.9,transparent:!0})},i))})},te=({position:o,speed:n,offset:s})=>{const a=d.useRef(null);return O(t=>{if(a.current){const r=t.clock.elapsedTime+s;a.current.position.x=o[0]+Math.sin(r*n)*G,a.current.position.z=o[1]+Math.cos(r*n)*G/2,a.current.rotation.y=-r*n+Math.PI,a.current.scale.y=1+Math.sin(r*15)*.3}}),e.jsxs("group",{ref:a,position:[o[0],o[2],o[1]],children:[e.jsx("mesh",{geometry:R,scale:[.2,.05,.05],position:[.1,0,0],rotation:[0,Math.PI/4,0],children:e.jsx("meshBasicMaterial",{color:"#333"})}),e.jsx("mesh",{geometry:R,scale:[.2,.05,.05],position:[-.1,0,0],rotation:[0,-Math.PI/4,0],children:e.jsx("meshBasicMaterial",{color:"#333"})})]})},nt=()=>e.jsxs("group",{raycast:()=>null,children:[e.jsx(ee,{position:[-12,8,4],scale:1.5,speed:.3}),e.jsx(ee,{position:[5,9,-8],scale:1.2,speed:.5}),e.jsx(ee,{position:[15,7,10],scale:1.8,speed:.2}),e.jsxs("group",{position:[0,0,0],scale:.8,children:[e.jsx(te,{position:[0,0,10],speed:.6,offset:0}),e.jsx(te,{position:[0,0,10],speed:.6,offset:1.2}),e.jsx(te,{position:[0,0,10],speed:.6,offset:2.5})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.6,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[G*4,G*4]}),e.jsx("meshStandardMaterial",{color:"#3b82f6",roughness:.1,metalness:.5,opacity:.8,transparent:!0})]})]}),st=Z.memo(({x:o,y:n,grid:s,yOffset:a})=>{const t=d.useMemo(()=>new B({color:"#fbbf24"}),[]),r=d.useMemo(()=>new De(.1,.5),[]),i=n>0&&s[n-1][o].buildingType===b.Road,c=n<G-1&&s[n+1][o].buildingType===b.Road,u=o>0&&s[n][o-1].buildingType===b.Road,l=o<G-1&&s[n][o+1].buildingType===b.Road;return[i,c,u,l].filter(Boolean).length===0?e.jsx("mesh",{rotation:[-Math.PI/2,0,0],position:[0,a,0],geometry:r,material:t}):e.jsxs("group",{rotation:[-Math.PI/2,0,0],position:[0,a,0],children:[(i||c)&&(u||l)&&e.jsx("mesh",{position:[0,0,.005],material:t,children:e.jsx("planeGeometry",{args:[.12,.12]})}),i&&e.jsx("mesh",{position:[0,.25,0],geometry:r,material:t}),c&&e.jsx("mesh",{position:[0,-.25,0],geometry:r,material:t}),u&&e.jsx("mesh",{position:[-.25,0,0],rotation:[0,0,Math.PI/2],geometry:r,material:t}),l&&e.jsx("mesh",{position:[.25,0,0],rotation:[0,0,Math.PI/2],geometry:r,material:t})]})}),at=Z.memo(({type:o,x:n,y:s,grid:a,onHover:t,onLeave:r,onClick:i})=>{const[c,u,l]=W(n,s);let f="#10b981",h=-.3,g=.5;if(o===b.None){const w=Y(n,s);f=w>.7?"#059669":w>.3?"#10b981":"#34d399",h=-.3-w*.1}else o===b.Road?(f="#374151",h=-.29):(f="#d1d5db",h=-.28);const m=h-g/2;return e.jsxs("mesh",{position:[c,m,l],receiveShadow:!0,castShadow:!0,onPointerEnter:w=>{w.stopPropagation(),t(n,s)},onPointerOut:w=>{w.stopPropagation(),r()},onPointerDown:w=>{w.stopPropagation(),w.button===0&&i(n,s)},children:[e.jsx("boxGeometry",{args:[1,g,1]}),e.jsx("meshStandardMaterial",{color:f,flatShading:!0,roughness:1}),o===b.Road&&e.jsx(st,{x:n,y:s,grid:a,yOffset:g/2+.001})]})}),it=({x:o,y:n,color:s})=>{const[a,t,r]=W(o,n);return e.jsxs("mesh",{position:[a,-.25,r],rotation:[-Math.PI/2,0,0],raycast:()=>null,children:[e.jsx("planeGeometry",{args:[1,1]}),e.jsx("meshBasicMaterial",{color:s,transparent:!0,opacity:.4,side:ze,depthTest:!1}),e.jsx(Ye,{thickness:.05,color:"white"})]})},lt=({grid:o,onTileClick:n,hoveredTool:s,population:a})=>{const[t,r]=d.useState(null),i=d.useCallback((g,m)=>{r({x:g,y:m})},[]),c=d.useCallback(()=>{r(null)},[]),u=t&&o[t.y][t.x].buildingType===b.None&&s!==b.None,l=u?q[s].color:"white",f=s===b.None,h=t?W(t.x,t.y):[0,0,0];return e.jsx("div",{className:"absolute inset-0 bg-sky-900 touch-none",children:e.jsxs(Se,{shadows:!0,dpr:[1,1.5],gl:{antialias:!0},children:[e.jsx(Xe,{makeDefault:!0,zoom:45,position:[20,20,20],near:-100,far:200}),e.jsx(Ke,{enableRotate:!0,enableZoom:!0,minZoom:20,maxZoom:120,maxPolarAngle:Math.PI/2.2,minPolarAngle:.1,target:[0,-.5,0]}),e.jsx("ambientLight",{intensity:.5,color:"#cceeff"}),e.jsx("directionalLight",{castShadow:!0,position:[15,20,10],intensity:2,color:"#fffbeb","shadow-mapSize":[2048,2048],"shadow-camera-left":-15,"shadow-camera-right":15,"shadow-camera-top":15,"shadow-camera-bottom":-15}),e.jsx(Le,{preset:"city"}),e.jsx(nt,{}),e.jsxs("group",{children:[o.map((g,m)=>g.map((w,j)=>{const[x,v,p]=W(j,m);return e.jsxs(Z.Fragment,{children:[e.jsx(at,{type:w.buildingType,x:j,y:m,grid:o,onHover:i,onLeave:c,onClick:n}),e.jsx("group",{position:[x,0,p],raycast:()=>null,children:w.buildingType!==b.None&&w.buildingType!==b.Road&&e.jsx(ce,{type:w.buildingType,baseColor:q[w.buildingType].color,x:j,y:m})})]},`${j}-${m}`)})),e.jsxs("group",{raycast:()=>null,children:[e.jsx(ot,{grid:o}),e.jsx(rt,{population:a,grid:o}),u&&t&&e.jsx("group",{position:[h[0],0,h[2]],children:e.jsx(et,{speed:3,rotationIntensity:0,floatIntensity:.1,floatingRange:[0,.1],children:e.jsx(ce,{type:s,baseColor:l,x:t.x,y:t.y,transparent:!0,opacity:.7})})}),t&&e.jsx(it,{x:t.x,y:t.y,color:f?"#ef4444":u?"#ffffff":"#000000"})]})]}),e.jsx(Qe,{size:10,samples:8})]})})},ct=[b.None,b.Road,b.Residential,b.Commercial,b.Industrial,b.Park],dt=({type:o,isSelected:n,onClick:s,money:a})=>{const t=q[o],r=a>=t.cost,i=o===b.None,c=t.color;return e.jsxs("button",{onClick:s,disabled:!i&&!r,className:`
        relative flex flex-col items-center justify-center rounded-lg border-2 transition-all shadow-lg backdrop-blur-sm shrink-0
        w-14 h-14 md:w-16 md:h-16
        ${n?"border-white bg-white/20 scale-110 z-10":"border-gray-600 bg-gray-900/80 hover:bg-gray-800"}
        ${!i&&!r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
      `,title:t.description,children:[e.jsxs("div",{className:"w-6 h-6 md:w-8 md:h-8 rounded mb-0.5 md:mb-1 border border-black/30 shadow-inner flex items-center justify-center overflow-hidden",style:{backgroundColor:i?"transparent":c},children:[i&&e.jsx("div",{className:"w-full h-full bg-red-600 text-white flex justify-center items-center font-bold text-base md:text-lg",children:"âœ•"}),o===b.Road&&e.jsx("div",{className:"w-full h-2 bg-gray-800 transform -rotate-45"})]}),e.jsx("span",{className:"text-[8px] md:text-[10px] font-bold text-white uppercase tracking-wider drop-shadow-md leading-none",children:t.name}),t.cost>0&&e.jsxs("span",{className:`text-[8px] md:text-[10px] font-mono leading-none ${r?"text-green-300":"text-red-400"}`,children:["$",t.cost]})]})},ut=({stats:o,selectedTool:n,onSelectTool:s,newsFeed:a,saveSettings:t,onSave:r,onToggleAutoSave:i})=>{const c=d.useRef(null);d.useEffect(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},[a]);const u=()=>t.lastSavedAt?new Date(t.lastSavedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Never";return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-2 md:p-4 font-sans z-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-start pointer-events-auto gap-2 w-full max-w-full",children:[e.jsxs("div",{className:"bg-gray-900/90 text-white p-2 md:p-3 rounded-xl border border-gray-700 shadow-2xl backdrop-blur-md flex gap-3 md:gap-6 items-center justify-between md:justify-start w-full md:w-auto",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:"Treasury"}),e.jsxs("span",{className:"text-lg md:text-2xl font-black text-green-400 font-mono drop-shadow-md",children:["$",o.money.toLocaleString()]})]}),e.jsx("div",{className:"w-px h-6 md:h-8 bg-gray-700"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:"Citizens"}),e.jsx("span",{className:"text-base md:text-xl font-bold text-blue-300 font-mono drop-shadow-md",children:o.population.toLocaleString()})]}),e.jsx("div",{className:"w-px h-6 md:h-8 bg-gray-700"}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:"Day"}),e.jsx("span",{className:"text-base md:text-lg font-bold text-white font-mono",children:o.day})]})]}),e.jsxs("div",{className:"bg-gray-900/90 text-white p-2 md:p-3 rounded-xl border border-gray-700 shadow-2xl backdrop-blur-md flex gap-2 md:gap-3 items-center",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-lg transition-colors text-xs font-bold uppercase tracking-wide",title:"Save Game",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),e.jsx("span",{className:"hidden md:inline",children:"Save"})]}),e.jsxs("button",{onClick:i,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-xs font-bold uppercase tracking-wide ${t.autoSaveEnabled?"bg-green-600 hover:bg-green-500":"bg-gray-600 hover:bg-gray-500"}`,title:t.autoSaveEnabled?"Auto-save ON (every 30s)":"Auto-save OFF",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{className:"hidden md:inline",children:"Auto"})]}),e.jsxs("div",{className:"flex flex-col items-end text-[8px] md:text-[10px] leading-tight",children:[e.jsx("span",{className:"text-gray-400 uppercase font-bold tracking-widest",children:"Saved"}),e.jsx("span",{className:`font-mono ${t.lastSavedAt?"text-green-300":"text-gray-500"}`,children:u()})]})]})]}),e.jsxs("div",{className:"flex flex-col-reverse md:flex-row md:justify-between md:items-end pointer-events-auto mt-auto gap-2 w-full max-w-full",children:[e.jsxs("div",{className:"flex gap-1 md:gap-2 bg-gray-900/80 p-1 md:p-2 rounded-2xl border border-gray-600/50 backdrop-blur-xl shadow-2xl w-full md:w-auto overflow-x-auto no-scrollbar justify-start md:justify-start",children:[e.jsx("div",{className:"flex gap-1 md:gap-2 min-w-max px-1",children:ct.map(l=>e.jsx(dt,{type:l,isSelected:n===l,onClick:()=>s(l),money:o.money},l))}),e.jsx("div",{className:"text-[8px] text-gray-500 uppercase writing-mode-vertical flex items-center justify-center font-bold tracking-widest border-l border-gray-700 pl-1 ml-1 select-none",children:"Build"})]}),e.jsxs("div",{className:"w-full md:w-80 h-32 md:h-48 bg-black/80 text-white rounded-xl border border-gray-700/80 backdrop-blur-xl shadow-2xl flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"bg-gray-800/90 px-3 py-1.5 text-[10px] font-bold uppercase tracking-widest text-gray-300 border-b border-gray-600 flex justify-between items-center",children:[e.jsx("span",{children:"City Feed"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none bg-[linear-gradient(to_bottom,rgba(255,255,255,0)_50%,rgba(0,0,0,0.1)_50%)] bg-size-[100%_4px] opacity-30 z-20"}),e.jsxs("div",{ref:c,className:"flex-1 overflow-y-auto p-2 md:p-3 space-y-2 text-[10px] md:text-xs font-mono scroll-smooth mask-image-b z-10",children:[a.length===0&&e.jsx("div",{className:"text-gray-500 italic text-center mt-10",children:"No active news stream."}),a.map(l=>e.jsxs("div",{className:`
                border-l-2 pl-2 py-1 transition-all animate-fade-in leading-tight relative
                ${l.type==="positive"?"border-green-500 text-green-200 bg-green-900/20":""}
                ${l.type==="negative"?"border-red-500 text-red-200 bg-red-900/20":""}
                ${l.type==="neutral"?"border-blue-400 text-blue-100 bg-blue-900/20":""}
              `,children:[e.jsx("span",{className:"opacity-70 text-[8px] absolute top-0.5 right-1",children:new Date(Number(l.id.split(".")[0])).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),l.text]},l.id))]})]})]})]})},mt=({onStart:o,hasSavedGame:n})=>e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-50 text-white font-sans p-6 bg-black/30 backdrop-blur-sm transition-all duration-1000",children:e.jsxs("div",{className:"max-w-md w-full bg-slate-900/90 p-8 rounded-2xl border border-slate-700 shadow-2xl backdrop-blur-xl relative overflow-hidden animate-fade-in",children:[e.jsx("div",{className:"absolute -top-24 -right-24 w-48 h-48 bg-cyan-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute -bottom-24 -left-24 w-48 h-48 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h1",{className:"text-5xl font-black mb-2 bg-linear-to-br from-white via-cyan-200 to-blue-400 bg-clip-text text-transparent tracking-tight",children:"SkyMetropolis"}),e.jsx("p",{className:"text-slate-400 mb-8 text-sm font-medium uppercase tracking-widest",children:"Isometric City Builder"}),e.jsxs("div",{className:"space-y-3",children:[n&&e.jsxs("button",{onClick:()=>o(!0),className:"w-full py-4 bg-linear-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold rounded-xl shadow-lg shadow-green-900/20 transform transition-all hover:scale-[1.02] active:scale-[0.98] text-lg tracking-wide flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Continue"]}),e.jsx("button",{onClick:()=>o(!1),className:`w-full py-4 text-white font-bold rounded-xl shadow-lg transform transition-all hover:scale-[1.02] active:scale-[0.98] text-lg tracking-wide ${n?"bg-linear-to-r from-slate-600 to-slate-700 hover:from-slate-500 hover:to-slate-600 shadow-slate-900/20":"bg-linear-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 shadow-cyan-900/20"}`,children:n?"New Game":"Start Building"})]})]})]})}),ft=()=>{const o=[];for(let n=0;n<G;n++){const s=[];for(let a=0;a<G;a++)s.push({x:a,y:n,buildingType:b.None});o.push(s)}return o};function pt(){const[o,n]=d.useState(!1),[s,a]=d.useState(ft),[t,r]=d.useState({money:$e,population:0,day:1}),[i,c]=d.useState(b.Road),[u,l]=d.useState([]),[f,h]=d.useState({autoSaveEnabled:!0,lastSavedAt:null}),[g,m]=d.useState(!1),w=d.useRef(s),j=d.useRef(t);d.useEffect(()=>{w.current=s},[s]),d.useEffect(()=>{j.current=t},[t]);const x=d.useCallback(S=>{l(N=>[...N.slice(-12),S])},[]),v=d.useCallback(async(S=!1)=>{const N=await J.save(w.current,j.current);return N?(h(_=>({..._,lastSavedAt:Date.now()})),S||x({id:Date.now().toString(),text:"City saved successfully.",type:"positive"})):S||x({id:Date.now().toString(),text:"Failed to save city data.",type:"negative"}),N},[x]),p=d.useCallback(async()=>{const S=await J.load();return S?(a(S.grid),r(S.stats),h(N=>({...N,lastSavedAt:S.savedAt})),x({id:Date.now().toString(),text:`City restored from ${new Date(S.savedAt).toLocaleString()}.`,type:"positive"}),!0):!1},[x]),y=d.useCallback(()=>{h(S=>{const N=!S.autoSaveEnabled;return x({id:Date.now().toString(),text:N?"Auto-save enabled (every 30 seconds).":"Auto-save disabled.",type:"neutral"}),{...S,autoSaveEnabled:N}})},[x]);d.useEffect(()=>{J.hasSave().then(m)},[]),d.useEffect(()=>{if(!o||!f.autoSaveEnabled)return;const S=setInterval(()=>{v(!0)},3e4);return()=>clearInterval(S)},[o,f.autoSaveEnabled,v]),d.useEffect(()=>{o&&x({id:Date.now().toString(),text:"Welcome to SkyMetropolis. Terrain generation complete.",type:"positive"})},[o,x]),d.useEffect(()=>{if(!o)return;const S=setInterval(()=>{let N=0,_=0,E={};w.current.flat().forEach(C=>{if(C.buildingType!==b.None){const A=q[C.buildingType];N+=A.incomeGen,_+=A.popGen,E[C.buildingType]=(E[C.buildingType]||0)+1}});const P=E[b.Residential]||0,k=P*50;r(C=>{let A=C.population+_;return A>k&&(A=k),P===0&&C.population>0&&(A=Math.max(0,C.population-5)),{money:C.money+N,population:A,day:C.day+1}})},Oe);return()=>clearInterval(S)},[o]);const I=d.useCallback((S,N)=>{if(!o)return;const _=w.current,E=j.current,P=i;if(S<0||S>=G||N<0||N>=G)return;const k=_[N][S],C=q[P];if(P===b.None){if(k.buildingType!==b.None)if(E.money>=5){const $=_.map(X=>[...X]);$[N][S]={...k,buildingType:b.None},a($),r(X=>({...X,money:X.money-5}))}else x({id:Date.now().toString(),text:"Cannot afford demolition costs.",type:"negative"});return}if(k.buildingType===b.None)if(E.money>=C.cost){r($=>({...$,money:$.money-C.cost}));const A=_.map($=>[...$]);A[N][S]={...k,buildingType:P},a(A)}else x({id:Date.now().toString()+Math.random(),text:`Treasury insufficient for ${C.name}.`,type:"negative"})},[i,x,o]),M=async(S=!1)=>{S&&await p(),n(!0)};return e.jsxs("div",{className:"relative w-screen h-screen overflow-hidden selection:bg-transparent selection:text-transparent bg-sky-900",children:[e.jsx(lt,{grid:s,onTileClick:I,hoveredTool:i,population:t.population}),!o&&e.jsx(mt,{onStart:M,hasSavedGame:g}),o&&e.jsx(ut,{stats:t,selectedTool:i,onSelectTool:c,newsFeed:u,saveSettings:f,onSave:()=>v(!1),onToggleAutoSave:y}),e.jsx("style",{children:`
        @keyframes fade-in { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .animate-fade-in { animation: fade-in 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        .mask-image-b { -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%); mask-image: linear-gradient(to bottom, transparent 0%, black 15%); }
        
        /* Vertical text for toolbar label */
        .writing-mode-vertical { writing-mode: vertical-rl; text-orientation: mixed; }
        
        /* Custom scrollbar for news */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
        `})]})}const yt={fullscreen:!0};function wt(){return[{title:"Sky Metropolis"},{property:"og:title",content:"Sky Metropolis"},{name:"description",content:"Sky Metropolis - A city building simulation game with isometric 3D graphics."}]}const jt=ge(pt);export{jt as default,yt as handle,wt as meta};
