var E=Object.defineProperty;var C=(c,t,i)=>t in c?E(c,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[t]=i;var o=(c,t,i)=>C(c,typeof t!="symbol"?t+"":t,i);import{r as A,j as g}from"./app-DhZdJ68g.js";import{S as L}from"./stats.esm-BlRy9uj9.js";class x{constructor(t){o(this,"options");o(this,"destory",!1);o(this,"fixed",!1);o(this,"step");o(this,"bigger");o(this,"isAdd",!1);o(this,"ir",0);this.options=t,this.step=2,this.bigger=5,this.animate(0)}drawLight(t,i,s){let e;return this.isAdd?(this.ir+=this.step)>this.options.r+this.bigger&&(this.isAdd=!1):(this.ir=this.ir<=this.options.r?this.options.r:this.ir-this.step,this.destory&&this.ir===this.options.r&&s.splice(s.indexOf(this),1)),e=this.ir*1.4,t.drawImage(i,this.options.x-e,this.options.y-e,e*2,e*2)}draw(t){return t.beginPath(),t.fillStyle="#000",t.arc(this.options.x,this.options.y,this.ir,0,Math.PI*2),t.fill()}animate(t){return this.ir=t,this.isAdd=!0}attract(t){if(this.fixed||t.fixed)return;let i,s,e,a,n,h;if(t.options.r>=this.options.r)return i=t.options.x-this.options.x,s=t.options.y-this.options.y,e=Math.sqrt(i*i+s*s),h=(t.options.r-this.options.r)*10/e+.5,a=Math.abs(h*i/e),n=Math.abs(h*s/e),this.options.x+=i>0?a:-a,this.options.y+=s>0?n:-n}check(t){let i,s,e,a,n;return!(t instanceof x)||this.destory||t.destory?!1:(s=t.options.x-this.options.x,e=t.options.y-this.options.y,i=t.ir+this.ir,s=Math.abs(s),e=Math.abs(e),s<i&&e<i&&Math.sqrt(s*s+e*e)<=Math.abs(t.options.r-this.options.r)+3?(t.options.r>this.options.r?[n,a]=[t,this]:[n,a]=[this,t],n.options.r=~~Math.sqrt(t.options.r*t.options.r+this.options.r*this.options.r),n.options.power=t.options.power+this.options.power,n.animate(Math.max(t.options.r,this.options.r)),n.options.r>50&&(n.destory=!0),a):!1)}}class S{constructor(t){o(this,"options");o(this,"vx",0);o(this,"vy",0);o(this,"ax",0);o(this,"ay",0);o(this,"oldx",0);o(this,"oldy",0);o(this,"canvas",document.getElementById("cas"));this.options=t,this.init()}init(){return this.vx=Math.random()*4-2,this.vy=Math.random()*4-2,this.ax=0,this.ay=0}move(){let t,i,s;return this.vx+=this.ax,this.vy+=this.ay,t=10,this.vx=Math.abs(this.vx)>t?t*Math.abs(this.vx)/this.vx:this.vx,this.vy=Math.abs(this.vy)>t?t*Math.abs(this.vy)/this.vy:this.vy,this.oldx=this.options.x,this.oldy=this.options.y,this.options.x+=this.vx,this.options.y+=this.vy,this.vx=0<=(i=this.options.x)&&i<=this.canvas.width+this.options.r*2?this.vx:-this.vx*.98,this.vy=0<=(s=this.options.y)&&s<=this.canvas.height+this.options.r*2?this.vy:-this.vy*.98}attract(t){let i,s,e,a,n,h,r,d,l,p;for(this.ax=this.ay=0,p=[],n=0,d=t.length;n<d;n++)s=t[n],e=s.options.x-this.options.x,a=s.options.y-this.options.y,i=Math.atan(e/a),l=s.options.power*.1,h=Math.abs(l*Math.sin(i)),r=Math.abs(l*Math.cos(i)),this.ax+=e>0?h:-h,p.push(this.ay+=a>0?r:-r);return p}draw(t){return t.save(),t.strokeStyle=this.options.color,t.lineCap=t.lineJoin="round",t.lineWidth=this.options.r,t.beginPath(),t.moveTo(this.oldx-this.options.r,this.oldy-this.options.r),t.lineTo(this.options.x-this.options.r,this.options.y-this.options.r),t.stroke(),t.restore()}}class I{constructor(){o(this,"blackholes",[]);o(this,"particles",[]);o(this,"target",null);o(this,"canvas");o(this,"bufferCanvas");o(this,"BH_SIZE",15);o(this,"stats");o(this,"bhImage",(()=>{const t=document.createElement("canvas");t.width=t.height=50;const i=t.getContext("2d");if(!i)throw new Error("Canvas is not supported");let s=0;for(let e=0;e<20;e++)s+=.05,i.beginPath(),i.fillStyle=`rgba(188,186,187,${s})`,i.arc(t.width/2,t.height/2,25-e,0,Math.PI*2),i.fill();return t})());o(this,"RAF",(window.requestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}).bind(window));o(this,"animate",()=>{let t,i,s,e,a,n,h,r,d,l,p,u,M,b,y,m,w;if(!this.canvas||!this.bufferCanvas)throw new Error("Canvas is not initialized");const k=this.bufferCanvas,f=k.getContext("2d"),v=this.canvas.getContext("2d");if(!f||!v)throw new Error("Canvas is not supported");for(f.save(),f.globalCompositeOperation="destination-out",f.globalAlpha=.3,f.fillRect(0,0,this.canvas.width,this.canvas.height),f.restore(),v.clearRect(0,0,this.canvas.width,this.canvas.height),a=h=0,d=this.blackholes.length;h<d;a=++h)s=this.blackholes[a],s&&s.drawLight(v,this.bhImage,this.blackholes);for(t=[],a=r=0,l=this.blackholes.length;r<l;a=++r)for(s=this.blackholes[a],s&&s.draw(v),n=b=0,p=this.blackholes.length;b<p;n=++b)e=this.blackholes[n],!(!s||!e||s===e)&&(s.attract(e),n>a&&(i=s.check(e))&&t.push(i));for(y=0,u=t.length;y<u;y++)i=t[y],i instanceof x&&this.blackholes.splice(this.blackholes.indexOf(i),1);for(m=0,M=this.particles.length;m<M;m++)w=this.particles[m],w.attract(this.blackholes),w.move(),w.draw(f);return v.drawImage(k,0,0),this.stats.update(),this.RAF(this.animate)});this.stats=new L,this.stats.setMode(0),this.renderStats(),this.init()}renderStats(){this.stats.dom.style.position="absolute",this.stats.dom.style.left="unset",this.stats.dom.style.right="0",this.stats.dom.style.top="0",document.body.appendChild(this.stats.dom)}init(){this.canvas=this.createCanvas(),this.windowResize(),this.execAnimate()}windowResize(){if(!this.canvas)throw new Error("Canvas is not initialized");this.bufferCanvas=document.createElement("canvas"),this.bufferCanvas.width=this.canvas.width=document.body.offsetWidth,this.bufferCanvas.height=this.canvas.height=document.body.offsetHeight,window.addEventListener("resize",()=>{if(!(!this.canvas||!this.bufferCanvas))return this.bufferCanvas.width=this.canvas.width=document.body.offsetWidth,this.bufferCanvas.height=this.canvas.height=document.body.offsetHeight})}createCanvas(){const t=document.querySelector("#cas");if(!t)throw new Error("Canvas element not found");return t.width=window.innerWidth,t.height=window.innerHeight,t.addEventListener("mousedown",i=>{let s,e,a,n,h,r,d,l;for(d=i.clientX-t.offsetLeft,l=i.clientY-t.offsetTop,n=h=0,r=this.blackholes.length;h<r;n=++h)if(s=this.blackholes[n],e=s.options.x-d,a=s.options.y-l,e*e+a*a<=s.options.r*s.options.r){this.target=s;break}const p=i.ctrlKey||i.metaKey;if(!this.target&&i.button===0&&this.bhImage){const u=new x({x:d,y:l,r:this.BH_SIZE,power:2});return u.fixed=p,this.blackholes.push(u)}else if(s&&i.button===2)return s.destory=!0,s.animate(s.options.r),s.options.r+=5}),t.addEventListener("mousemove",i=>{let s,e;if(this.target)return s=i.clientX-t.offsetLeft,e=i.clientY-t.offsetTop,this.target.options.x=s,this.target.options.y=e}),t.addEventListener("mouseup",()=>this.target=null),t.addEventListener("mouseout",()=>this.target=null),t}execAnimate(){if(!this.canvas)throw new Error("Canvas is not initialized");for(let t=0;t<4e3;t++)this.particles.push(new S({x:this.canvas.width*Math.random(),y:this.canvas.height*Math.random(),r:Math.random()*2+1,color:"rgba(255,255,255,.5)"}));return this.animate()}}function z(){return document.body.addEventListener("contextmenu",c=>{c.preventDefault()}),A.useEffect(()=>{new I},[]),g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"tips",children:"Left click to build one hole, right click to delete a hole"}),g.jsx("canvas",{id:"cas",className:"bg-[#0A3136]"})]})}export{z as default};
