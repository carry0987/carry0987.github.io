import{w as k,a as E,p as y}from"./chunk-FGUA77HG-CcDfAx5b.js";import{S as C}from"./stats.esm-IRX7mck_.js";class w{options;destory=!1;fixed=!1;step;bigger;isAdd=!1;ir=0;constructor(t){this.options=t,this.step=2,this.bigger=5,this.animate(0)}drawLight(t,i,s){let e;return this.isAdd?(this.ir+=this.step)>this.options.r+this.bigger&&(this.isAdd=!1):(this.ir=this.ir<=this.options.r?this.options.r:this.ir-this.step,this.destory&&this.ir===this.options.r&&s.splice(s.indexOf(this),1)),e=this.ir*1.4,t.drawImage(i,this.options.x-e,this.options.y-e,e*2,e*2)}draw(t){return t.beginPath(),t.fillStyle="#000",t.arc(this.options.x,this.options.y,this.ir,0,Math.PI*2),t.fill()}animate(t){return this.ir=t,this.isAdd=!0}attract(t){if(this.fixed||t.fixed)return;let i,s,e,n,o,a;if(t.options.r>=this.options.r)return i=t.options.x-this.options.x,s=t.options.y-this.options.y,e=Math.sqrt(i*i+s*s),a=(t.options.r-this.options.r)*10/e+.5,n=Math.abs(a*i/e),o=Math.abs(a*s/e),this.options.x+=i>0?n:-n,this.options.y+=s>0?o:-o}check(t){let i,s,e,n,o;return!(t instanceof w)||this.destory||t.destory?!1:(s=t.options.x-this.options.x,e=t.options.y-this.options.y,i=t.ir+this.ir,s=Math.abs(s),e=Math.abs(e),s<i&&e<i&&Math.sqrt(s*s+e*e)<=Math.abs(t.options.r-this.options.r)+3?(t.options.r>this.options.r?[o,n]=[t,this]:[o,n]=[this,t],o.options.r=~~Math.sqrt(t.options.r*t.options.r+this.options.r*this.options.r),o.options.power=t.options.power+this.options.power,o.animate(Math.max(t.options.r,this.options.r)),o.options.r>50&&(o.destory=!0),n):!1)}}class A{options;vx=0;vy=0;ax=0;ay=0;oldx=0;oldy=0;canvas=document.getElementById("cas");constructor(t){this.options=t,this.init()}init(){return this.vx=Math.random()*4-2,this.vy=Math.random()*4-2,this.ax=0,this.ay=0}move(){let t,i,s;return this.vx+=this.ax,this.vy+=this.ay,t=10,this.vx=Math.abs(this.vx)>t?t*Math.abs(this.vx)/this.vx:this.vx,this.vy=Math.abs(this.vy)>t?t*Math.abs(this.vy)/this.vy:this.vy,this.oldx=this.options.x,this.oldy=this.options.y,this.options.x+=this.vx,this.options.y+=this.vy,this.vx=0<=(i=this.options.x)&&i<=this.canvas.width+this.options.r*2?this.vx:-this.vx*.98,this.vy=0<=(s=this.options.y)&&s<=this.canvas.height+this.options.r*2?this.vy:-this.vy*.98}attract(t){let i,s,e,n,o,a,h,l,r,d;for(this.ax=this.ay=0,d=[],o=0,l=t.length;o<l;o++)s=t[o],e=s.options.x-this.options.x,n=s.options.y-this.options.y,i=Math.atan(e/n),r=s.options.power*.1,a=Math.abs(r*Math.sin(i)),h=Math.abs(r*Math.cos(i)),this.ax+=e>0?a:-a,d.push(this.ay+=n>0?h:-h);return d}draw(t){return t.save(),t.strokeStyle=this.options.color,t.lineCap=t.lineJoin="round",t.lineWidth=this.options.r,t.beginPath(),t.moveTo(this.oldx-this.options.r,this.oldy-this.options.r),t.lineTo(this.options.x-this.options.r,this.options.y-this.options.r),t.stroke(),t.restore()}}class I{blackholes=[];particles=[];target=null;canvas;bufferCanvas;animationId=0;resizeHandler;BH_SIZE=15;stats;constructor(){this.stats=new C,this.stats.setMode(0),this.renderStats(),this.init()}renderStats(){this.stats.dom.style.position="absolute",this.stats.dom.style.left="unset",this.stats.dom.style.right="0",this.stats.dom.style.top="0",document.body.appendChild(this.stats.dom)}init(){this.canvas=this.createCanvas(),this.windowResize(),this.execAnimate()}windowResize(){if(!this.canvas)throw new Error("Canvas is not initialized");this.bufferCanvas=document.createElement("canvas"),this.bufferCanvas.width=this.canvas.width=document.body.offsetWidth,this.bufferCanvas.height=this.canvas.height=document.body.offsetHeight,this.resizeHandler=()=>{!this.canvas||!this.bufferCanvas||(this.bufferCanvas.width=this.canvas.width=document.body.offsetWidth,this.bufferCanvas.height=this.canvas.height=document.body.offsetHeight)},window.addEventListener("resize",this.resizeHandler)}bhImage=(()=>{const t=document.createElement("canvas");t.width=t.height=50;const i=t.getContext("2d");if(!i)throw new Error("Canvas is not supported");let s=0;for(let e=0;e<20;e++)s+=.05,i.beginPath(),i.fillStyle=`rgba(188,186,187,${s})`,i.arc(t.width/2,t.height/2,25-e,0,Math.PI*2),i.fill();return t})();RAF=(window.requestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}).bind(window);createCanvas(){const t=document.querySelector("#cas");if(!t)throw new Error("Canvas element not found");return t.width=window.innerWidth,t.height=window.innerHeight,t.addEventListener("mousedown",i=>{let s,e,n,o,a,h,l,r;for(l=i.clientX-t.offsetLeft,r=i.clientY-t.offsetTop,o=a=0,h=this.blackholes.length;a<h;o=++a)if(s=this.blackholes[o],e=s.options.x-l,n=s.options.y-r,e*e+n*n<=s.options.r*s.options.r){this.target=s;break}const d=i.ctrlKey||i.metaKey;if(!this.target&&i.button===0&&this.bhImage){const p=new w({x:l,y:r,r:this.BH_SIZE,power:2});return p.fixed=d,this.blackholes.push(p)}else if(s&&i.button===2)return s.destory=!0,s.animate(s.options.r),s.options.r+=5}),t.addEventListener("mousemove",i=>{let s,e;if(this.target)return s=i.clientX-t.offsetLeft,e=i.clientY-t.offsetTop,this.target.options.x=s,this.target.options.y=e}),t.addEventListener("mouseup",()=>this.target=null),t.addEventListener("mouseout",()=>this.target=null),t}animate=()=>{let t,i,s,e,n,o,a,h,l,r,d,p,b,g,u,v,m;if(!this.canvas||!this.bufferCanvas)throw new Error("Canvas is not initialized");const M=this.bufferCanvas,c=M.getContext("2d"),f=this.canvas.getContext("2d");if(!c||!f)throw new Error("Canvas is not supported");for(c.save(),c.globalCompositeOperation="destination-out",c.globalAlpha=.3,c.fillRect(0,0,this.canvas.width,this.canvas.height),c.restore(),f.clearRect(0,0,this.canvas.width,this.canvas.height),n=a=0,l=this.blackholes.length;a<l;n=++a)s=this.blackholes[n],s&&s.drawLight(f,this.bhImage,this.blackholes);for(t=[],n=h=0,r=this.blackholes.length;h<r;n=++h)for(s=this.blackholes[n],s&&s.draw(f),o=g=0,d=this.blackholes.length;g<d;o=++g)e=this.blackholes[o],!(!s||!e||s===e)&&(s.attract(e),o>n&&(i=s.check(e))&&t.push(i));for(u=0,p=t.length;u<p;u++)i=t[u],i instanceof w&&this.blackholes.splice(this.blackholes.indexOf(i),1);for(v=0,b=this.particles.length;v<b;v++)m=this.particles[v],m.attract(this.blackholes),m.move(),m.draw(c);f.drawImage(M,0,0),this.stats.update(),this.animationId=this.RAF(this.animate)};dispose(){this.animationId&&cancelAnimationFrame(this.animationId),this.stats.dom&&this.stats.dom.parentNode&&this.stats.dom.parentNode.removeChild(this.stats.dom),this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler)}execAnimate(){if(!this.canvas)throw new Error("Canvas is not initialized");for(let t=0;t<4e3;t++)this.particles.push(new A({x:this.canvas.width*Math.random(),y:this.canvas.height*Math.random(),r:Math.random()*2+1,color:"rgba(255,255,255,.5)"}));return this.animate()}}function H(){return[{title:"Blackhole"},{property:"og:title",content:"Blackhole"},{name:"description",content:"A Funny Canvas Game"}]}const S={fullscreen:!0},B=k(function(){return E.useEffect(()=>{const t=s=>{s.preventDefault()};document.body.addEventListener("contextmenu",t);const i=new I;return()=>{document.body.removeEventListener("contextmenu",t),i.dispose()}},[]),y.jsxs(y.Fragment,{children:[y.jsx("span",{className:"tips",children:"Left click to build one hole, right click to delete a hole"}),y.jsx("canvas",{id:"cas",className:"bg-[#0A3136]"})]})});export{B as default,S as handle,H as meta};
