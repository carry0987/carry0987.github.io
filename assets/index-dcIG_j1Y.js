import{a as l,R as K,p as e,w as ve}from"./chunk-WWGJGFF6-B6u1Qf49.js";import{s as ye,g as we,r as je}from"./index-Cpx2NyP8.js";import{u as I,e as Se,a as ie,_ as se,b as U,M as Me,C as Ne}from"./OrbitControls-2wmebMyn.js";import{V as L,a as ke,j as Re,k as pe,l as _e,m as Ce,e as Ie,g as H,n as Ee,H as Pe,L as le,D as Te,o as Ae,p as Q,q as ne,f as Ge,r as Be,s as De,t as ze,u as T,d as Fe,v as ge,w as xe,x as Le}from"./three.module-DcpnAN3g.js";import{E as Oe}from"./Environment-NsypuC9q.js";import{s as $e}from"./shaderMaterial-CmZ-zmui.js";import{v as Ue}from"./constants-E6iK5bbg.js";import{c as ae}from"./createLucideIcon-DTDhPEOD.js";const Ve=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],He=ae("chevron-down",Ve);const We=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Ye=ae("chevron-up",We);const qe=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Ze=ae("trash-2",qe);var b=(o=>(o.None="None",o.Road="Road",o.Residential="Residential",o.Commercial="Commercial",o.Industrial="Industrial",o.Park="Park",o))(b||{});const P=15,Xe=2e3,Ke=1e6,X={[b.None]:{type:b.None,cost:0,name:"Bulldoze",description:"Clear a tile",color:"#ef4444",popGen:0,incomeGen:0},[b.Road]:{type:b.Road,cost:10,name:"Road",description:"Connects buildings.",color:"#374151",popGen:0,incomeGen:0},[b.Residential]:{type:b.Residential,cost:100,name:"House",description:"+5 Pop/day",color:"#f87171",popGen:5,incomeGen:0},[b.Commercial]:{type:b.Commercial,cost:200,name:"Shop",description:"+$15/day",color:"#60a5fa",popGen:0,incomeGen:15},[b.Industrial]:{type:b.Industrial,cost:400,name:"Factory",description:"+$40/day",color:"#facc15",popGen:0,incomeGen:40},[b.Park]:{type:b.Park,cost:50,name:"Park",description:"Looks nice.",color:"#4ade80",popGen:1,incomeGen:0}},Je="sky-metropolis-db",O="saves",W="current-save",Qe=1;class et{db=null;dbReady;constructor(){this.dbReady=this.initDB()}initDB(){return new Promise((n,s)=>{if(typeof window>"u"||!window.indexedDB){n();return}const a=indexedDB.open(Je,1);a.onerror=()=>{console.error("Failed to open IndexedDB:",a.error),s(a.error)},a.onsuccess=()=>{this.db=a.result,n()},a.onupgradeneeded=t=>{const r=t.target.result;r.objectStoreNames.contains(O)||r.createObjectStore(O)}})}async save(n,s){await this.dbReady;const a={grid:n,stats:s,savedAt:Date.now(),version:Qe};return this.db?new Promise(t=>{const c=this.db.transaction([O],"readwrite").objectStore(O).put(a,W);c.onsuccess=()=>t(!0),c.onerror=()=>{console.error("IndexedDB save failed, trying localStorage"),t(this.saveToLocalStorage(a))}}):this.saveToLocalStorage(a)}saveToLocalStorage(n){try{return ye(W,n),!0}catch(s){return console.error("localStorage save failed:",s),!1}}async load(){if(await this.dbReady,this.db){const n=await new Promise(s=>{const r=this.db.transaction([O],"readonly").objectStore(O).get(W);r.onsuccess=()=>s(r.result||null),r.onerror=()=>{console.error("IndexedDB load failed, trying localStorage"),s(null)}});if(n)return n}return this.loadFromLocalStorage()}loadFromLocalStorage(){try{const n=we(W,!0);if(n)return n}catch(n){console.error("localStorage load failed:",n)}return null}async deleteSave(){if(await this.dbReady,this.db)return new Promise(n=>{const t=this.db.transaction([O],"readwrite").objectStore(O).delete(W);t.onsuccess=()=>n(!0),t.onerror=()=>n(!1)});try{return je(W),!0}catch{return!1}}async hasSave(){return await this.load()!==null}}const ee=new et;function tt(o,n=Math.PI/3){const s=Math.cos(n),a=(1+1e-10)*100,t=[new L,new L,new L],r=new L,i=new L,c=new L,u=new L;function d(j){const x=~~(j.x*a),y=~~(j.y*a),p=~~(j.z*a);return`${x},${y},${p}`}const f=o.index?o.toNonIndexed():o,g=f.attributes.position,m={};for(let j=0,x=g.count/3;j<x;j++){const y=3*j,p=t[0].fromBufferAttribute(g,y+0),v=t[1].fromBufferAttribute(g,y+1),_=t[2].fromBufferAttribute(g,y+2);r.subVectors(_,v),i.subVectors(p,v);const M=new L().crossVectors(r,i).normalize();for(let G=0;G<3;G++){const z=t[G],S=d(z);S in m||(m[S]=[]),m[S].push(M)}}const h=new Float32Array(g.count*3),w=new ke(h,3,!1);for(let j=0,x=g.count/3;j<x;j++){const y=3*j,p=t[0].fromBufferAttribute(g,y+0),v=t[1].fromBufferAttribute(g,y+1),_=t[2].fromBufferAttribute(g,y+2);r.subVectors(_,v),i.subVectors(p,v),c.crossVectors(r,i).normalize();for(let M=0;M<3;M++){const G=t[M],z=d(G),S=m[z];u.set(0,0,0);for(let N=0,C=S.length;N<C;N++){const k=S[N];c.dot(k)>s&&u.add(k)}u.normalize(),w.setXYZ(y+M,u.x,u.y,u.z)}}return f.setAttribute("normal",w),f}const ce=$e({screenspace:!1,color:new H("black"),opacity:1,thickness:.05,size:new pe},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${Ue>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function ot({color:o="black",opacity:n=1,transparent:s=!1,screenspace:a=!1,toneMapped:t=!0,polygonOffset:r=!1,polygonOffsetFactor:i=0,renderOrder:c=0,thickness:u=.05,angle:d=Math.PI,clippingPlanes:f,...g}){const m=l.useRef(null),[h]=l.useState(()=>new ce({side:Re})),{gl:w}=I(),j=w.getDrawingBufferSize(new pe);l.useMemo(()=>Se({OutlinesMaterial:ce}),[]);const x=l.useRef(0),y=l.useRef(null);return l.useLayoutEffect(()=>{const p=m.current;if(!p)return;const v=p.parent;if(v&&v.geometry&&(x.current!==d||y.current!==v.geometry)){var _;x.current=d,y.current=v.geometry;let M=(_=p.children)==null?void 0:_[0];M&&(d&&M.geometry.dispose(),p.remove(M)),v.skeleton?(M=new _e,M.material=h,M.bind(v.skeleton,v.bindMatrix),p.add(M)):v.isInstancedMesh?(M=new Ce(v.geometry,h,v.count),M.instanceMatrix=v.instanceMatrix,p.add(M)):(M=new Ie,M.material=h,p.add(M)),M.geometry=d?tt(v.geometry,d):v.geometry,M.morphTargetInfluences=v.morphTargetInfluences,M.morphTargetDictionary=v.morphTargetDictionary}}),l.useLayoutEffect(()=>{const p=m.current;if(!p)return;const v=p.children[0];if(v){v.renderOrder=c;const _=p.parent;ie(v,{morphTargetInfluences:_.morphTargetInfluences,morphTargetDictionary:_.morphTargetDictionary}),ie(v.material,{transparent:s,thickness:u,color:o,opacity:n,size:j,screenspace:a,toneMapped:t,polygonOffset:r,polygonOffsetFactor:i,clippingPlanes:f,clipping:f&&f.length>0})}}),l.useEffect(()=>()=>{const p=m.current;if(!p)return;const v=p.children[0];v&&(d&&v.geometry.dispose(),p.remove(v))},[]),l.createElement("group",se({ref:m},g))}function rt(o,n,s){const a=I(h=>h.size),t=I(h=>h.viewport),r=typeof o=="number"?o:a.width*t.dpr,i=a.height*t.dpr,c=(typeof o=="number"?s:o)||{},{samples:u=0,depth:d,...f}=c,g=d??c.depthBuffer,m=l.useMemo(()=>{const h=new Ee(r,i,{minFilter:le,magFilter:le,type:Pe,...f});return g&&(h.depthTexture=new Te(r,i,Ae)),h.samples=u,h},[]);return l.useLayoutEffect(()=>{m.setSize(r,i),u&&(m.samples=u)},[u,m,r,i]),l.useEffect(()=>()=>m.dispose(),[]),m}const nt=o=>typeof o=="function",st=l.forwardRef(({envMap:o,resolution:n=256,frames:s=1/0,children:a,makeDefault:t,...r},i)=>{const c=I(({set:x})=>x),u=I(({camera:x})=>x),d=I(({size:x})=>x),f=l.useRef(null);l.useImperativeHandle(i,()=>f.current,[]);const g=l.useRef(null),m=rt(n);l.useLayoutEffect(()=>{r.manual||f.current.updateProjectionMatrix()},[d,r]),l.useLayoutEffect(()=>{f.current.updateProjectionMatrix()}),l.useLayoutEffect(()=>{if(t){const x=u;return c(()=>({camera:f.current})),()=>c(()=>({camera:x}))}},[f,t,c]);let h=0,w=null;const j=nt(a);return U(x=>{j&&(s===1/0||h<s)&&(g.current.visible=!1,x.gl.setRenderTarget(m),w=x.scene.background,o&&(x.scene.background=o),x.gl.render(x.scene,f.current),x.scene.background=w,x.gl.setRenderTarget(null),g.current.visible=!0,h++)}),l.createElement(l.Fragment,null,l.createElement("orthographicCamera",se({left:d.width/-2,right:d.width/2,top:d.height/2,bottom:d.height/-2,ref:f},r),!j&&a),l.createElement("group",{ref:g},j&&a(m.texture)))}),at=l.forwardRef((o={enableDamping:!0},n)=>{const{domElement:s,camera:a,makeDefault:t,onChange:r,onStart:i,onEnd:c,...u}=o,d=I(p=>p.invalidate),f=I(p=>p.camera),g=I(p=>p.gl),m=I(p=>p.events),h=I(p=>p.set),w=I(p=>p.get),j=s||m.connected||g.domElement,x=a||f,y=l.useMemo(()=>new Me(x),[x]);return l.useEffect(()=>{y.connect(j);const p=v=>{d(),r&&r(v)};return y.addEventListener("change",p),i&&y.addEventListener("start",i),c&&y.addEventListener("end",c),()=>{y.dispose(),y.removeEventListener("change",p),i&&y.removeEventListener("start",i),c&&y.removeEventListener("end",c)}},[r,i,c,y,d,j]),l.useEffect(()=>{if(t){const p=w().controls;return h({controls:y}),()=>h({controls:p})}},[t,y]),U(()=>y.update(),-1),l.createElement("primitive",se({ref:n,object:y,enableDamping:!0},u))}),it=({focus:o=0,size:n=25,samples:s=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${n})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${o});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${s}; i ++) {
    offset = (vogelDiskSample(j, ${s}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${s}; i++) {
    vogelSample = vogelDiskSample(j, ${s}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${n}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${s}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`;function de(o,n,s){n.traverse(a=>{a.material&&(o.properties.remove(a.material),a.material.dispose==null||a.material.dispose())}),o.info.programs.length=0,o.compile(n,s)}function lt({focus:o=0,samples:n=10,size:s=25}){const a=I(i=>i.gl),t=I(i=>i.scene),r=I(i=>i.camera);return l.useEffect(()=>{const i=Q.shadowmap_pars_fragment;return Q.shadowmap_pars_fragment=Q.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP",`#ifdef USE_SHADOWMAP
`+it({size:s,samples:n,focus:o})).replace("#if defined( SHADOWMAP_TYPE_PCF )",`
return PCSS(shadowMap, shadowCoord);
#if defined( SHADOWMAP_TYPE_PCF )`),de(a,t,r),()=>{Q.shadowmap_pars_fragment=i,de(a,t,r)}},[o,s,n]),null}const ct=l.forwardRef(({children:o,enabled:n=!0,speed:s=1,rotationIntensity:a=1,floatIntensity:t=1,floatingRange:r=[-.1,.1],autoInvalidate:i=!1,...c},u)=>{const d=l.useRef(null);l.useImperativeHandle(u,()=>d.current,[]);const f=l.useRef(Math.random()*1e4);return U(g=>{var m,h;if(!n||s===0)return;i&&g.invalidate();const w=f.current+g.clock.elapsedTime;d.current.rotation.x=Math.cos(w/4*s)/8*a,d.current.rotation.y=Math.sin(w/4*s)/8*a,d.current.rotation.z=Math.sin(w/4*s)/20*a;let j=Math.sin(w/4*s)/10;j=ne.mapLinear(j,-.1,.1,(m=r?.[0])!==null&&m!==void 0?m:-.1,(h=r?.[1])!==null&&h!==void 0?h:.1),d.current.position.y=j*t,d.current.updateMatrix()}),l.createElement("group",c,l.createElement("group",{ref:d,matrixAutoUpdate:!1},o))}),ue=P/2-.5,q=(o,n)=>[o-ue,0,n-ue],Z=(o,n)=>Math.abs(Math.sin(o*12.9898+n*78.233)*43758.5453)%1,A=(o,n)=>Math.random()*(n-o)+o,R=new Ge(1,1,1),Y=new Be(1,1,1,8),te=new De(1,1,4),be=new ze(1,8,8),$=K.memo(({position:o,scale:n})=>e.jsx("mesh",{geometry:R,position:o,scale:n,children:e.jsx("meshStandardMaterial",{color:"#bfdbfe",emissive:"#bfdbfe",emissiveIntensity:.2,roughness:.1,metalness:.8})})),dt=({position:o})=>{const n=l.useRef(null);return U(s=>{n.current&&n.current.children.forEach((a,t)=>{const r=a;r.position.y+=.01+t*.005,r.scale.addScalar(.005);const i=r.material;i&&(i.opacity-=.005,r.position.y>1.5&&(r.position.y=0,r.scale.setScalar(.1+Math.random()*.1),i.opacity=.6))})}),e.jsxs("group",{position:o,children:[e.jsx("mesh",{geometry:Y,castShadow:!0,receiveShadow:!0,position:[0,.5,0],scale:[.2,1,.2],children:e.jsx("meshStandardMaterial",{color:"#4b5563"})}),e.jsx("group",{ref:n,position:[0,1,0],children:[0,1,2].map(s=>e.jsx("mesh",{geometry:be,position:[Math.random()*.1,s*.4,Math.random()*.1],scale:.2,children:e.jsx("meshStandardMaterial",{color:"#d1d5db",transparent:!0,opacity:.6,flatShading:!0})},s))})]})},me=K.memo(({type:o,baseColor:n,x:s,y:a,opacity:t=1,transparent:r=!1})=>{const i=Z(s,a),c=Math.floor(i*100),u=Math.floor(i*4)*(Math.PI/2),d=l.useMemo(()=>{const j=new H(n);return j.offsetHSL(i*.1-.05,0,i*.2-.1),j},[n,i]),f=l.useMemo(()=>new T({color:d,flatShading:!0,opacity:t,transparent:r,roughness:.8}),[d,t,r]),g=l.useMemo(()=>new T({color:new H(d).multiplyScalar(.7),flatShading:!0,opacity:t,transparent:r}),[d,t,r]),m=l.useMemo(()=>new T({color:new H(d).multiplyScalar(.5).offsetHSL(0,0,-.1),flatShading:!0,opacity:t,transparent:r}),[d,t,r]),h={castShadow:!0,receiveShadow:!0},w=-.3;return e.jsx("group",{rotation:[0,u,0],position:[0,w,0],children:(()=>{switch(o){case b.Residential:return c<33?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...h,material:f,geometry:R,position:[0,.3,0],scale:[.7,.6,.6]}),e.jsx("mesh",{...h,material:m,geometry:te,position:[0,.75,0],scale:[.6,.4,.6],rotation:[0,Math.PI/4,0]}),e.jsx($,{position:[.2,.3,.31],scale:[.15,.2,.05]}),e.jsx($,{position:[-.2,.3,.31],scale:[.15,.2,.05]}),e.jsx("mesh",{...h,material:g,geometry:R,position:[0,.1,.32],scale:[.15,.2,.05]})]}):c<66?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...h,material:f,geometry:R,position:[-.1,.35,0],scale:[.6,.7,.8]}),e.jsx("mesh",{...h,material:g,geometry:R,position:[.25,.25,.1],scale:[.4,.5,.6]}),e.jsx($,{position:[-.1,.5,.41],scale:[.4,.2,.05]})]}):e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...h,material:f,geometry:R,position:[0,.5,0],scale:[.5,1,.6]}),e.jsx("mesh",{...h,material:m,geometry:R,position:[0,1.05,0],scale:[.55,.1,.65]}),e.jsx($,{position:[0,.7,.31],scale:[.3,.2,.05]}),e.jsx($,{position:[0,.3,.31],scale:[.3,.2,.05]})]});case b.Commercial:if(c<40){const y=1.5+i*1.5;return e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...h,material:f,geometry:R,position:[0,y/2,0],scale:[.7,y,.7]}),Array.from({length:Math.floor(y*3)}).map((p,v)=>e.jsx($,{position:[0,.2+v*.3,0],scale:[.72,.15,.72]},v)),e.jsx("mesh",{...h,material:g,geometry:R,position:[0,y+.1,0],scale:[.5,.2,.5]})]})}else return c<70?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...h,material:f,geometry:R,position:[0,.4,0],scale:[.9,.8,.8]}),e.jsx($,{position:[0,.3,.41],scale:[.8,.4,.05]}),e.jsx("mesh",{...h,material:new T({color:i>.5?"#ef4444":"#3b82f6"}),geometry:R,position:[0,.55,.5],scale:[.9,.1,.2],rotation:[Math.PI/6,0,0]})]}):e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...h,material:f,geometry:R,position:[-.2,.5,-.2],scale:[.5,1,.5]}),e.jsx("mesh",{...h,material:g,geometry:R,position:[.1,.3,.1],scale:[.7,.6,.7]}),e.jsx($,{position:[.1,.3,.46],scale:[.6,.3,.05]}),e.jsx("mesh",{...h,material:new T({color:"#9ca3af"}),geometry:R,position:[.2,.65,.2],scale:[.2,.1,.2]})]});case b.Industrial:return c<50?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...h,material:f,geometry:R,position:[0,.4,0],scale:[.9,.8,.8]}),e.jsx("mesh",{...h,material:m,geometry:R,position:[-.2,.9,0],scale:[.4,.2,.8],rotation:[0,0,Math.PI/4]}),e.jsx("mesh",{...h,material:m,geometry:R,position:[.2,.9,0],scale:[.4,.2,.8],rotation:[0,0,Math.PI/4]}),e.jsx(dt,{position:[.3,.4,.3]})]}):e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...h,material:f,geometry:R,position:[-.2,.3,0],scale:[.5,.6,.9]}),e.jsx("mesh",{...h,material:g,geometry:Y,position:[.25,.4,-.2],scale:[.2,.8,.2]}),e.jsx("mesh",{...h,material:g,geometry:Y,position:[.25,.4,.25],scale:[.2,.8,.2]}),e.jsx("mesh",{...h,material:new T({color:"#6b7280"}),geometry:R,position:[.25,.7,0],scale:[.05,.05,.5]})]});case b.Park:const j=1+Math.floor(i*3),x=[[-.2,-.2],[.2,.2],[-.2,.2],[.2,-.2]];return e.jsxs("group",{position:[0,-w-.29,0],children:[" ",e.jsxs("mesh",{receiveShadow:!0,rotation:[-Math.PI/2,0,0],position:[0,.01,0],children:[e.jsx("planeGeometry",{args:[.9,.9]}),e.jsx("meshStandardMaterial",{color:"#86efac"})]}),c<30&&e.jsxs("group",{position:[0,.05,0],children:[e.jsx("mesh",{material:new T({color:"#cbd5e1"}),geometry:Y,scale:[.4,.1,.4],castShadow:!0,receiveShadow:!0}),e.jsx("mesh",{material:new T({color:"#3b82f6",roughness:.1}),geometry:Y,position:[0,.06,0],scale:[.3,.05,.3]})]}),Array.from({length:j}).map((y,p)=>{const v=x[p%x.length],_=.5+Z(s+p,a-p)*.5,M=new H("#166534").offsetHSL(0,0,Z(s,a+p)*.2);return e.jsxs("group",{position:[v[0],0,v[1]],scale:_,rotation:[0,Z(p,s)*Math.PI,0],children:[e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:new T({color:"#78350f"}),geometry:Y,position:[0,.15,0],scale:[.1,.3,.1]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:new T({color:M,flatShading:!0}),geometry:te,position:[0,.4,0],scale:[.4,.5,.4]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:new T({color:M,flatShading:!0}),geometry:te,position:[0,.65,0],scale:[.3,.4,.3]})]},p)})]});case b.Road:return null;default:return null}})()})}),fe=["#ef4444","#3b82f6","#eab308","#ffffff","#1f2937","#f97316"],ut=({grid:o})=>{const n=l.useMemo(()=>{const i=[];return o.forEach(c=>c.forEach(u=>{u.buildingType===b.Road&&i.push({x:u.x,y:u.y})})),i},[o]),s=Math.min(n.length,30),a=l.useRef(null),t=l.useRef(new Float32Array(0)),r=l.useMemo(()=>new ge,[]);return l.useMemo(()=>new Float32Array(0),[]),l.useEffect(()=>{if(n.length<2)return;t.current=new Float32Array(s*6);const i=new Float32Array(s*3);for(let c=0;c<s;c++){const u=n[Math.floor(Math.random()*n.length)];t.current[c*6+0]=u.x,t.current[c*6+1]=u.y,t.current[c*6+2]=u.x,t.current[c*6+3]=u.y,t.current[c*6+4]=1,t.current[c*6+5]=A(.01,.03);const d=new H(fe[Math.floor(Math.random()*fe.length)]);i[c*3]=d.r,i[c*3+1]=d.g,i[c*3+2]=d.b}a.current&&(a.current.instanceColor=new xe(i,3))},[n,s]),U(()=>{if(!(!a.current||n.length<2||t.current.length===0)){for(let i=0;i<s;i++){const c=i*6;let u=t.current[c],d=t.current[c+1],f=t.current[c+2],g=t.current[c+3],m=t.current[c+4];const h=t.current[c+5];if(m+=h,m>=1){u=f,d=g,m=0;const C=n.filter(k=>Math.abs(k.x-u)===1&&k.y===d||Math.abs(k.y-d)===1&&k.x===u);if(C.length>0){const k=C.length>1?C.filter(D=>Math.abs(D.x-t.current[c])>.1||Math.abs(D.y-t.current[c+1])>.1):C,F=k.length>0?k[Math.floor(Math.random()*k.length)]:C[0];f=F.x,g=F.y}else{const k=n[Math.floor(Math.random()*n.length)];u=k.x,d=k.y,f=k.x,g=k.y}}t.current[c]=u,t.current[c+1]=d,t.current[c+2]=f,t.current[c+3]=g,t.current[c+4]=m;const w=ne.lerp(u,f,m),j=ne.lerp(d,g,m),x=f-u,y=g-d,p=Math.atan2(y,x),v=.15,_=Math.sqrt(x*x+y*y)||1,M=-y/_*v,G=x/_*v,[z,S,N]=q(w+M,j+G);r.position.set(z,-.3+.075,N),r.rotation.set(0,-p,0),r.scale.set(.5,.15,.3),r.updateMatrix(),a.current.setMatrixAt(i,r.matrix)}a.current.instanceMatrix.needsUpdate=!0}}),n.length<2?null:e.jsx("instancedMesh",{ref:a,args:[R,void 0,s],castShadow:!0,children:e.jsx("meshStandardMaterial",{roughness:.5,metalness:.3})})},he=["#ef4444","#3b82f6","#10b981","#f59e0b","#8b5cf6","#ec4899","#ffffff"],mt=({population:o,grid:n})=>{const s=Math.min(Math.floor(o/2),300),a=l.useRef(null),t=l.useMemo(()=>{const c=[];return n.forEach(u=>u.forEach(d=>{(d.buildingType===b.Road||d.buildingType===b.Park||d.buildingType===b.None)&&c.push({x:d.x,y:d.y})})),c},[n]),r=l.useRef(new Float32Array(0)),i=l.useMemo(()=>new ge,[]);return l.useEffect(()=>{if(s===0||t.length===0)return;r.current=new Float32Array(s*6);const c=new Float32Array(s*3);for(let u=0;u<s;u++){const d=t[Math.floor(Math.random()*t.length)],f=d.x+A(-.4,.4),g=d.y+A(-.4,.4);r.current[u*6+0]=f,r.current[u*6+1]=g;const m=t[Math.floor(Math.random()*t.length)];r.current[u*6+2]=m.x+A(-.4,.4),r.current[u*6+3]=m.y+A(-.4,.4),r.current[u*6+4]=A(.005,.015),r.current[u*6+5]=Math.random()*Math.PI*2;const h=new H(he[Math.floor(Math.random()*he.length)]);c[u*3]=h.r,c[u*3+1]=h.g,c[u*3+2]=h.b}a.current&&(a.current.instanceColor=new xe(c,3))},[s,t]),U(c=>{if(!a.current||s===0||r.current.length===0)return;const u=c.clock.elapsedTime;for(let d=0;d<s;d++){const f=d*6;let g=r.current[f],m=r.current[f+1],h=r.current[f+2],w=r.current[f+3];const j=r.current[f+4],x=r.current[f+5],y=h-g,p=w-m,v=Math.sqrt(y*y+p*p);if(v<.1){if(t.length>0){const k=t[Math.floor(Math.random()*t.length)];h=k.x+A(-.4,.4),w=k.y+A(-.4,.4),r.current[f+2]=h,r.current[f+3]=w}}else g+=y/v*j,m+=p/v*j,r.current[f]=g,r.current[f+1]=m;const[_,M,G]=q(g,m),z=Math.abs(Math.sin(u*10+x))*.03,S=.2,N=.08;i.position.set(_,-.35+S/2+z,G),i.rotation.set(0,-Math.atan2(p,y),0),i.scale.set(N,S,N),i.updateMatrix(),a.current.setMatrixAt(d,i.matrix)}a.current.instanceMatrix.needsUpdate=!0}),s===0?null:e.jsx("instancedMesh",{ref:a,args:[R,void 0,s],castShadow:!0,children:e.jsx("meshStandardMaterial",{roughness:.8})})},oe=({position:o,scale:n,speed:s})=>{const a=l.useRef(null);U((r,i)=>{a.current&&(a.current.position.x+=s*i,a.current.position.x>P*1.5&&(a.current.position.x=-P*1.5))});const t=l.useMemo(()=>Array.from({length:5+Math.random()*5}).map(()=>({pos:[A(-1,1),A(-.5,.5),A(-1,1)],scale:A(.5,1.2)})),[]);return e.jsx("group",{ref:a,position:o,scale:n,children:t.map((r,i)=>e.jsx("mesh",{geometry:be,position:r.pos,scale:r.scale,castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"white",flatShading:!0,opacity:.9,transparent:!0})},i))})},re=({position:o,speed:n,offset:s})=>{const a=l.useRef(null);return U(t=>{if(a.current){const r=t.clock.elapsedTime+s;a.current.position.x=o[0]+Math.sin(r*n)*P,a.current.position.z=o[1]+Math.cos(r*n)*P/2,a.current.rotation.y=-r*n+Math.PI,a.current.scale.y=1+Math.sin(r*15)*.3}}),e.jsxs("group",{ref:a,position:[o[0],o[2],o[1]],children:[e.jsx("mesh",{geometry:R,scale:[.2,.05,.05],position:[.1,0,0],rotation:[0,Math.PI/4,0],children:e.jsx("meshBasicMaterial",{color:"#333"})}),e.jsx("mesh",{geometry:R,scale:[.2,.05,.05],position:[-.1,0,0],rotation:[0,-Math.PI/4,0],children:e.jsx("meshBasicMaterial",{color:"#333"})})]})},ft=()=>e.jsxs("group",{raycast:()=>null,children:[e.jsx(oe,{position:[-12,8,4],scale:1.5,speed:.3}),e.jsx(oe,{position:[5,9,-8],scale:1.2,speed:.5}),e.jsx(oe,{position:[15,7,10],scale:1.8,speed:.2}),e.jsxs("group",{position:[0,0,0],scale:.8,children:[e.jsx(re,{position:[0,0,10],speed:.6,offset:0}),e.jsx(re,{position:[0,0,10],speed:.6,offset:1.2}),e.jsx(re,{position:[0,0,10],speed:.6,offset:2.5})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.6,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[P*4,P*4]}),e.jsx("meshStandardMaterial",{color:"#3b82f6",roughness:.1,metalness:.5,opacity:.8,transparent:!0})]})]}),ht=K.memo(({x:o,y:n,grid:s,yOffset:a})=>{const t=l.useMemo(()=>new T({color:"#fbbf24"}),[]),r=l.useMemo(()=>new Fe(.1,.5),[]),i=n>0&&s[n-1][o].buildingType===b.Road,c=n<P-1&&s[n+1][o].buildingType===b.Road,u=o>0&&s[n][o-1].buildingType===b.Road,d=o<P-1&&s[n][o+1].buildingType===b.Road;return[i,c,u,d].filter(Boolean).length===0?e.jsx("mesh",{rotation:[-Math.PI/2,0,0],position:[0,a,0],geometry:r,material:t}):e.jsxs("group",{rotation:[-Math.PI/2,0,0],position:[0,a,0],children:[(i||c)&&(u||d)&&e.jsx("mesh",{position:[0,0,.005],material:t,children:e.jsx("planeGeometry",{args:[.12,.12]})}),i&&e.jsx("mesh",{position:[0,.25,0],geometry:r,material:t}),c&&e.jsx("mesh",{position:[0,-.25,0],geometry:r,material:t}),u&&e.jsx("mesh",{position:[-.25,0,0],rotation:[0,0,Math.PI/2],geometry:r,material:t}),d&&e.jsx("mesh",{position:[.25,0,0],rotation:[0,0,Math.PI/2],geometry:r,material:t})]})}),pt=K.memo(({type:o,x:n,y:s,grid:a,onHover:t,onLeave:r,onClick:i})=>{const[c,u,d]=q(n,s);let f="#10b981",g=-.3,m=.5;if(o===b.None){const w=Z(n,s);f=w>.7?"#059669":w>.3?"#10b981":"#34d399",g=-.3-w*.1}else o===b.Road?(f="#374151",g=-.29):(f="#d1d5db",g=-.28);const h=g-m/2;return e.jsxs("mesh",{position:[c,h,d],receiveShadow:!0,castShadow:!0,onPointerEnter:w=>{w.stopPropagation(),t(n,s)},onPointerOut:w=>{w.stopPropagation(),r()},onPointerDown:w=>{w.stopPropagation(),w.button===0&&i(n,s)},children:[e.jsx("boxGeometry",{args:[1,m,1]}),e.jsx("meshStandardMaterial",{color:f,flatShading:!0,roughness:1}),o===b.Road&&e.jsx(ht,{x:n,y:s,grid:a,yOffset:m/2+.001})]})}),gt=({x:o,y:n,color:s})=>{const[a,t,r]=q(o,n);return e.jsxs("mesh",{position:[a,-.25,r],rotation:[-Math.PI/2,0,0],raycast:()=>null,children:[e.jsx("planeGeometry",{args:[1,1]}),e.jsx("meshBasicMaterial",{color:s,transparent:!0,opacity:.4,side:Le,depthTest:!1}),e.jsx(ot,{thickness:.05,color:"white"})]})},xt=({grid:o,onTileClick:n,hoveredTool:s,population:a})=>{const[t,r]=l.useState(null),i=l.useCallback((m,h)=>{r({x:m,y:h})},[]),c=l.useCallback(()=>{r(null)},[]),u=t&&o[t.y][t.x].buildingType===b.None&&s!==b.None,d=u?X[s].color:"white",f=s===b.None,g=t?q(t.x,t.y):[0,0,0];return e.jsx("div",{className:"absolute inset-0 bg-sky-900 touch-none",children:e.jsxs(Ne,{shadows:!0,dpr:[1,1.5],gl:{antialias:!0},children:[e.jsx(st,{makeDefault:!0,zoom:45,position:[20,20,20],near:-100,far:200}),e.jsx(at,{enableRotate:!0,enableZoom:!0,minZoom:20,maxZoom:120,maxPolarAngle:Math.PI/2.2,minPolarAngle:.1,target:[0,-.5,0]}),e.jsx("ambientLight",{intensity:.5,color:"#cceeff"}),e.jsx("directionalLight",{castShadow:!0,position:[15,20,10],intensity:2,color:"#fffbeb","shadow-mapSize":[2048,2048],"shadow-camera-left":-15,"shadow-camera-right":15,"shadow-camera-top":15,"shadow-camera-bottom":-15}),e.jsx(Oe,{preset:"city"}),e.jsx(ft,{}),e.jsxs("group",{children:[o.map((m,h)=>m.map((w,j)=>{const[x,y,p]=q(j,h);return e.jsxs(K.Fragment,{children:[e.jsx(pt,{type:w.buildingType,x:j,y:h,grid:o,onHover:i,onLeave:c,onClick:n}),e.jsx("group",{position:[x,0,p],raycast:()=>null,children:w.buildingType!==b.None&&w.buildingType!==b.Road&&e.jsx(me,{type:w.buildingType,baseColor:X[w.buildingType].color,x:j,y:h})})]},`${j}-${h}`)})),e.jsxs("group",{raycast:()=>null,children:[e.jsx(ut,{grid:o}),e.jsx(mt,{population:a,grid:o}),u&&t&&e.jsx("group",{position:[g[0],0,g[2]],children:e.jsx(ct,{speed:3,rotationIntensity:0,floatIntensity:.1,floatingRange:[0,.1],children:e.jsx(me,{type:s,baseColor:d,x:t.x,y:t.y,transparent:!0,opacity:.7})})}),t&&e.jsx(gt,{x:t.x,y:t.y,color:f?"#ef4444":u?"#ffffff":"#000000"})]})]}),e.jsx(lt,{size:10,samples:8})]})})},bt=[b.None,b.Road,b.Residential,b.Commercial,b.Industrial,b.Park],vt=({type:o,isSelected:n,onClick:s,money:a})=>{const t=X[o],r=a>=t.cost,i=o===b.None,c=t.color;return e.jsxs("button",{onClick:s,disabled:!i&&!r,className:`
        relative flex flex-col items-center justify-center rounded-lg border-2 transition-all shadow-lg backdrop-blur-sm shrink-0
        w-14 h-14 md:w-16 md:h-16
        ${n?"border-white bg-white/20 scale-110 z-10":"border-gray-600 bg-gray-900/80 hover:bg-gray-800"}
        ${!i&&!r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
      `,title:t.description,children:[e.jsxs("div",{className:"w-6 h-6 md:w-8 md:h-8 rounded mb-0.5 md:mb-1 border border-black/30 shadow-inner flex items-center justify-center overflow-hidden",style:{backgroundColor:i?"transparent":c},children:[i&&e.jsx("div",{className:"w-full h-full bg-red-600 text-white flex justify-center items-center font-bold text-base md:text-lg",children:"âœ•"}),o===b.Road&&e.jsx("div",{className:"w-full h-2 bg-gray-800 transform -rotate-45"})]}),e.jsx("span",{className:"text-[8px] md:text-[10px] font-bold text-white uppercase tracking-wider drop-shadow-md leading-none",children:t.name}),t.cost>0&&e.jsxs("span",{className:`text-[8px] md:text-[10px] font-mono leading-none ${r?"text-green-300":"text-red-400"}`,children:["$",t.cost]})]})},yt=({stats:o,selectedTool:n,onSelectTool:s,newsFeed:a,saveSettings:t,onSave:r,onToggleAutoSave:i,onClearNewsFeed:c})=>{const u=l.useRef(null),[d,f]=l.useState(!1);l.useEffect(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[a]);const g=()=>t.lastSavedAt?new Date(t.lastSavedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Never";return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-2 md:p-4 font-sans z-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-start pointer-events-auto gap-2 w-full max-w-full",children:[e.jsxs("div",{className:"bg-gray-900/90 text-white p-2 md:p-3 rounded-xl border border-gray-700 shadow-2xl backdrop-blur-md flex gap-3 md:gap-6 items-center justify-between md:justify-start w-full md:w-auto",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:"Treasury"}),e.jsxs("span",{className:"text-lg md:text-2xl font-black text-green-400 font-mono drop-shadow-md",children:["$",o.money.toLocaleString()]})]}),e.jsx("div",{className:"w-px h-6 md:h-8 bg-gray-700"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:"Citizens"}),e.jsx("span",{className:"text-base md:text-xl font-bold text-blue-300 font-mono drop-shadow-md",children:o.population.toLocaleString()})]}),e.jsx("div",{className:"w-px h-6 md:h-8 bg-gray-700"}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:"Day"}),e.jsx("span",{className:"text-base md:text-lg font-bold text-white font-mono",children:o.day})]})]}),e.jsxs("div",{className:"bg-gray-900/90 text-white p-2 md:p-3 rounded-xl border border-gray-700 shadow-2xl backdrop-blur-md flex gap-2 md:gap-3 items-center",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-lg transition-colors text-xs font-bold uppercase tracking-wide",title:"Save Game",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),e.jsx("span",{className:"hidden md:inline",children:"Save"})]}),e.jsxs("button",{onClick:i,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-xs font-bold uppercase tracking-wide ${t.autoSaveEnabled?"bg-green-600 hover:bg-green-500":"bg-gray-600 hover:bg-gray-500"}`,title:t.autoSaveEnabled?"Auto-save ON (every 30s)":"Auto-save OFF",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{className:"hidden md:inline",children:"Auto"})]}),e.jsxs("div",{className:"flex flex-col items-end text-[8px] md:text-[10px] leading-tight",children:[e.jsx("span",{className:"text-gray-400 uppercase font-bold tracking-widest",children:"Saved"}),e.jsx("span",{className:`font-mono ${t.lastSavedAt?"text-green-300":"text-gray-500"}`,children:g()})]})]})]}),e.jsxs("div",{className:"flex flex-col-reverse md:flex-row md:justify-between md:items-end pointer-events-auto mt-auto gap-2 w-full max-w-full",children:[e.jsxs("div",{className:"flex gap-1 md:gap-2 bg-gray-900/80 p-1 md:p-2 rounded-2xl border border-gray-600/50 backdrop-blur-xl shadow-2xl w-full md:w-auto overflow-x-auto no-scrollbar justify-start md:justify-start",children:[e.jsx("div",{className:"flex gap-1 md:gap-2 min-w-max px-1",children:bt.map(m=>e.jsx(vt,{type:m,isSelected:n===m,onClick:()=>s(m),money:o.money},m))}),e.jsx("div",{className:"text-[8px] text-gray-500 uppercase writing-mode-vertical flex items-center justify-center font-bold tracking-widest border-l border-gray-700 pl-1 ml-1 select-none",children:"Build"})]}),e.jsxs("div",{className:`w-full md:w-80 bg-black/80 text-white rounded-xl border border-gray-700/80 backdrop-blur-xl shadow-2xl flex flex-col overflow-hidden relative selection:bg-white/30 selection:text-white transition-all duration-300 ${d?"h-auto":"h-32 md:h-48"}`,children:[e.jsxs("div",{className:"bg-gray-800/90 px-3 py-1.5 text-[10px] font-bold uppercase tracking-widest text-gray-300 border-b border-gray-600 flex justify-between items-center cursor-pointer hover:bg-gray-700/90 transition-colors",onClick:()=>f(!d),children:[e.jsx("span",{children:"City Feed"}),e.jsxs("div",{className:"flex items-center gap-2",children:[!d&&a.length>0&&e.jsx("button",{onClick:m=>{m.stopPropagation(),c()},className:"text-gray-400 hover:text-red-400 transition-colors p-0.5 rounded hover:bg-white/10",title:"Clear feed",children:e.jsx(Ze,{className:"w-3 h-3"})}),e.jsx("button",{className:"text-gray-400 hover:text-white transition-colors p-0.5 rounded hover:bg-white/10",title:d?"Expand feed":"Collapse feed",children:d?e.jsx(Ye,{className:"w-3 h-3"}):e.jsx(He,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"})]})]}),!d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none bg-[linear-gradient(to_bottom,rgba(255,255,255,0)_50%,rgba(0,0,0,0.1)_50%)] bg-size-[100%_4px] opacity-30 z-20"}),e.jsxs("div",{ref:u,className:"flex-1 overflow-y-auto p-2 md:p-3 space-y-2 text-[10px] md:text-xs font-mono scroll-smooth mask-image-b z-10",children:[a.length===0&&e.jsx("div",{className:"text-gray-500 italic text-center mt-10",children:"No active news stream."}),a.map(m=>e.jsxs("div",{className:`
                border-l-2 pl-2 py-1 transition-all animate-fade-in leading-tight relative
                ${m.type==="positive"?"border-green-500 text-green-200 bg-green-900/20":""}
                ${m.type==="negative"?"border-red-500 text-red-200 bg-red-900/20":""}
                ${m.type==="neutral"?"border-blue-400 text-blue-100 bg-blue-900/20":""}
              `,children:[e.jsx("span",{className:"opacity-70 text-[8px] absolute top-0.5 right-1",children:new Date(Number(m.id.split(".")[0])).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),m.text]},m.id))]})]})]})]})]})},wt=({onStart:o,hasSavedGame:n})=>e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-50 text-white font-sans p-6 bg-black/30 backdrop-blur-sm transition-all duration-1000",children:e.jsxs("div",{className:"max-w-md w-full bg-slate-900/90 p-8 rounded-2xl border border-slate-700 shadow-2xl backdrop-blur-xl relative overflow-hidden animate-fade-in",children:[e.jsx("div",{className:"absolute -top-24 -right-24 w-48 h-48 bg-cyan-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute -bottom-24 -left-24 w-48 h-48 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h1",{className:"text-5xl font-black mb-2 bg-linear-to-br from-white via-cyan-200 to-blue-400 bg-clip-text text-transparent tracking-tight",children:"SkyMetropolis"}),e.jsx("p",{className:"text-slate-400 mb-8 text-sm font-medium uppercase tracking-widest",children:"Isometric City Builder"}),e.jsxs("div",{className:"space-y-3",children:[n&&e.jsxs("button",{onClick:()=>o(!0),className:"w-full py-4 bg-linear-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold rounded-xl shadow-lg shadow-green-900/20 transform transition-all hover:scale-[1.02] active:scale-[0.98] text-lg tracking-wide flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Continue"]}),e.jsx("button",{onClick:()=>o(!1),className:`w-full py-4 text-white font-bold rounded-xl shadow-lg transform transition-all hover:scale-[1.02] active:scale-[0.98] text-lg tracking-wide ${n?"bg-linear-to-r from-slate-600 to-slate-700 hover:from-slate-500 hover:to-slate-600 shadow-slate-900/20":"bg-linear-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 shadow-cyan-900/20"}`,children:n?"New Game":"Start Building"})]})]})]})}),jt=()=>{const o=[];for(let n=0;n<P;n++){const s=[];for(let a=0;a<P;a++)s.push({x:a,y:n,buildingType:b.None});o.push(s)}return o};function St(){const[o,n]=l.useState(!1),[s,a]=l.useState(jt),[t,r]=l.useState({money:Ke,population:0,day:1}),[i,c]=l.useState(b.Road),[u,d]=l.useState([]),[f,g]=l.useState({autoSaveEnabled:!0,lastSavedAt:null}),[m,h]=l.useState(!1),w=l.useRef(s),j=l.useRef(t);l.useEffect(()=>{w.current=s},[s]),l.useEffect(()=>{j.current=t},[t]);const x=l.useCallback(S=>{d(N=>[...N.slice(-12),S])},[]),y=l.useCallback(()=>{d([])},[]),p=l.useCallback(async(S=!1)=>{const N=await ee.save(w.current,j.current);return N?(g(C=>({...C,lastSavedAt:Date.now()})),S||x({id:Date.now().toString(),text:"City saved successfully.",type:"positive"})):S||x({id:Date.now().toString(),text:"Failed to save city data.",type:"negative"}),N},[x]),v=l.useCallback(async()=>{const S=await ee.load();return S?(a(S.grid),r(S.stats),g(N=>({...N,lastSavedAt:S.savedAt})),x({id:Date.now().toString(),text:`City restored from ${new Date(S.savedAt).toLocaleString()}.`,type:"positive"}),!0):!1},[x]),_=l.useCallback(()=>{g(S=>{const N=!S.autoSaveEnabled;return{...S,autoSaveEnabled:N}})},[]),M=l.useRef(!0);l.useEffect(()=>{if(M.current){M.current=!1;return}x({id:Date.now().toString(),text:f.autoSaveEnabled?"Auto-save enabled (every 30 seconds).":"Auto-save disabled.",type:"neutral"})},[f.autoSaveEnabled,x]),l.useEffect(()=>{ee.hasSave().then(h)},[]),l.useEffect(()=>{if(!o||!f.autoSaveEnabled)return;const S=setInterval(()=>{p(!0)},3e4);return()=>clearInterval(S)},[o,f.autoSaveEnabled,p]),l.useEffect(()=>{o&&x({id:Date.now().toString(),text:"Welcome to SkyMetropolis. Terrain generation complete.",type:"positive"})},[o,x]),l.useEffect(()=>{if(!o)return;const S=setInterval(()=>{let N=0,C=0,k={};w.current.flat().forEach(E=>{if(E.buildingType!==b.None){const B=X[E.buildingType];N+=B.incomeGen,C+=B.popGen,k[E.buildingType]=(k[E.buildingType]||0)+1}});const F=k[b.Residential]||0,D=F*50;r(E=>{let B=E.population+C;return B>D&&(B=D),F===0&&E.population>0&&(B=Math.max(0,E.population-5)),{money:E.money+N,population:B,day:E.day+1}})},Xe);return()=>clearInterval(S)},[o]);const G=l.useCallback((S,N)=>{if(!o)return;const C=w.current,k=j.current,F=i;if(S<0||S>=P||N<0||N>=P)return;const D=C[N][S],E=X[F];if(F===b.None){if(D.buildingType!==b.None)if(k.money>=5){const V=C.map(J=>[...J]);V[N][S]={...D,buildingType:b.None},a(V),r(J=>({...J,money:J.money-5}))}else x({id:Date.now().toString(),text:"Cannot afford demolition costs.",type:"negative"});return}if(D.buildingType===b.None)if(k.money>=E.cost){r(V=>({...V,money:V.money-E.cost}));const B=C.map(V=>[...V]);B[N][S]={...D,buildingType:F},a(B)}else x({id:Date.now().toString()+Math.random(),text:`Treasury insufficient for ${E.name}.`,type:"negative"})},[i,x,o]),z=async(S=!1)=>{S&&await v(),n(!0)};return e.jsxs("div",{className:"relative w-screen h-screen overflow-hidden selection:bg-transparent selection:text-transparent bg-sky-900",children:[e.jsx(xt,{grid:s,onTileClick:G,hoveredTool:i,population:t.population}),!o&&e.jsx(wt,{onStart:z,hasSavedGame:m}),o&&e.jsx(yt,{stats:t,selectedTool:i,onSelectTool:c,newsFeed:u,saveSettings:f,onSave:()=>p(!1),onToggleAutoSave:_,onClearNewsFeed:y}),e.jsx("style",{children:`
        @keyframes fade-in { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .animate-fade-in { animation: fade-in 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        .mask-image-b { -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%); mask-image: linear-gradient(to bottom, transparent 0%, black 15%); }
        
        /* Vertical text for toolbar label */
        .writing-mode-vertical { writing-mode: vertical-rl; text-orientation: mixed; }
        
        /* Custom scrollbar for news */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
        `})]})}const Pt={fullscreen:!0};function Tt(){return[{title:"Sky Metropolis"},{property:"og:title",content:"Sky Metropolis"},{name:"description",content:"Sky Metropolis - A city building simulation game with isometric 3D graphics."}]}const At=ve(St);export{At as default,Pt as handle,Tt as meta};
