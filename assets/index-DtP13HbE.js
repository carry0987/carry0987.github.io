import{r as s,j as e,w as Oe}from"./chunk-JMJ3UQ3L-DTa-kQyz.js";import{_ as Le,u as Ne,a as ue,C as Be,O as Ge}from"./OrbitControls-Cu28hcz1.js";import{c as H}from"./createLucideIcon-DJfiQI6J.js";import{H as We}from"./house-BtsHXS8_.js";import{s as $e,g as Ve,r as He}from"./index-tSOQ2Rud.js";import{_ as Ce,f as Fe,h as Ye,ai as qe,j as le,S as Pe,M as Me,aj as ze,x as Ke,V as z,ak as re,i as Xe,v as Je}from"./three.module-sEz3UYRk.js";import{G as Ze,E as Qe}from"./Environment-aZ-2o2HK.js";import{C as et}from"./clock-BKAR4OtO.js";import{S as tt,R as rt,T as st,C as ot,a as at}from"./trash-2-AgHRitPU.js";import{X as nt}from"./x-DoNpzKz6.js";import{T as it}from"./triangle-alert-b9EnD7-w.js";import"./shaderMaterial-GGJzNv2p.js";import"./constants-CLnqI9Eg.js";const ct=[["path",{d:"M8 6v6",key:"18i7km"}],["path",{d:"M15 6v6",key:"1sg6z9"}],["path",{d:"M2 12h19.6",key:"de5uta"}],["path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3",key:"1wwztk"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M9 18h5",key:"lrx6i"}],["circle",{cx:"16",cy:"18",r:"2",key:"1v4tcr"}]],lt=H("bus",ct);const dt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ut=H("calendar",dt);const xt=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],ht=H("eraser",xt);const pt=[["path",{d:"M12 16h.01",key:"1drbdi"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M3 19a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.5a.5.5 0 0 0-.769-.422l-4.462 2.844A.5.5 0 0 1 15 10.5v-2a.5.5 0 0 0-.769-.422L9.77 10.922A.5.5 0 0 1 9 10.5V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2z",key:"1iv0i2"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ft=H("factory",pt);const mt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],vt=H("pencil",mt);const yt=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],gt=H("route",yt);const St=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],jt=H("shopping-cart",St);const bt=[["path",{d:"M10 10v.2A3 3 0 0 1 8.9 16H5a3 3 0 0 1-1-5.8V10a3 3 0 0 1 6 0Z",key:"1l6gj6"}],["path",{d:"M7 16v6",key:"1a82de"}],["path",{d:"M13 19v3",key:"13sx9i"}],["path",{d:"M12 19h8.3a1 1 0 0 0 .7-1.7L18 14h.3a1 1 0 0 0 .7-1.7L16 9h.2a1 1 0 0 0 .8-1.7L13 3l-1.4 1.5",key:"1sj9kv"}]],Mt=H("trees",bt);const wt=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Nt=H("trending-up",wt);const Ct=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Pt=H("users",Ct);const Rt=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],kt=H("wallet",Rt),Tt={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},Dt={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};function xe(r,o){const f=r+"Geometry";return s.forwardRef(({args:i,children:l,...n},M)=>{const S=s.useRef(null);return s.useImperativeHandle(M,()=>S.current),s.useLayoutEffect(()=>{o?.(S.current)}),s.createElement("mesh",Le({ref:S},n),s.createElement(f,{attach:"geometry",args:i}),l)})}const g=xe("box"),ge=xe("cone"),q=xe("cylinder"),Et=xe("sphere"),At=xe("plane"),It=s.forwardRef(({scale:r=10,frames:o=1/0,opacity:f=1,width:i=1,height:l=1,blur:n=1,near:M=0,far:S=10,resolution:m=512,smooth:x=!0,color:P="#000000",depthWrite:U=!1,renderOrder:D,...L},u)=>{const k=s.useRef(null),N=Ne(_=>_.scene),t=Ne(_=>_.gl),y=s.useRef(null);i=i*(Array.isArray(r)?r[0]:r||1),l=l*(Array.isArray(r)?r[1]:r||1);const[p,E,A,a,c,d,v]=s.useMemo(()=>{const _=new Ce(m,m),B=new Ce(m,m);B.texture.generateMipmaps=_.texture.generateMipmaps=!1;const X=new Fe(i,l).rotateX(Math.PI/2),ye=new Ye(X),ee=new qe;ee.depthTest=ee.depthWrite=!1,ee.onBeforeCompile=J=>{J.uniforms={...J.uniforms,ucolor:{value:new le(P)}},J.fragmentShader=J.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),J.fragmentShader=J.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const he=new Pe(Tt),pe=new Pe(Dt);return pe.depthTest=he.depthTest=!1,[_,X,ee,ye,he,pe,B]},[m,i,l,r,P]),C=_=>{a.visible=!0,a.material=c,c.uniforms.tDiffuse.value=p.texture,c.uniforms.h.value=_*1/256,t.setRenderTarget(v),t.render(a,y.current),a.material=d,d.uniforms.tDiffuse.value=v.texture,d.uniforms.v.value=_*1/256,t.setRenderTarget(p),t.render(a,y.current),a.visible=!1};let T=0,R,$;return ue(()=>{y.current&&(o===1/0||T<o)&&(T++,R=N.background,$=N.overrideMaterial,k.current.visible=!1,N.background=null,N.overrideMaterial=A,t.setRenderTarget(p),t.render(N,y.current),C(n),x&&C(n*.4),t.setRenderTarget(null),k.current.visible=!0,N.overrideMaterial=$,N.background=R)}),s.useImperativeHandle(u,()=>k.current,[]),s.createElement("group",Le({"rotation-x":Math.PI/2},L,{ref:k}),s.createElement("mesh",{renderOrder:D,geometry:E,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},s.createElement("meshBasicMaterial",{transparent:!0,map:p.texture,opacity:f,depthWrite:U})),s.createElement("orthographicCamera",{ref:y,args:[-i/2,i/2,l/2,-l/2,M,S]}))});var h=(r=>(r.EMPTY="EMPTY",r.ROAD="ROAD",r.RESIDENTIAL="RESIDENTIAL",r.COMMERCIAL="COMMERCIAL",r.INDUSTRIAL="INDUSTRIAL",r.PARK="PARK",r.BUS_STOP="BUS_STOP",r))(h||{});const j=16,Re=1,de={[h.EMPTY]:{type:h.EMPTY,cost:0,color:"#2d3748",label:"Bulldoze",icon:ht,description:"Clear the land for new developments."},[h.ROAD]:{type:h.ROAD,cost:10,color:"#4a5568",label:"Road",icon:gt,description:"Connect your city. Essential for cars and growth."},[h.RESIDENTIAL]:{type:h.RESIDENTIAL,cost:50,color:"#48bb78",label:"Residential",icon:We,description:"Where your citizens live. Provides population."},[h.COMMERCIAL]:{type:h.COMMERCIAL,cost:80,color:"#4299e1",label:"Commercial",icon:jt,description:"Stores and offices. Boosts city income and development."},[h.INDUSTRIAL]:{type:h.INDUSTRIAL,cost:120,color:"#ecc94b",label:"Industrial",icon:ft,description:"Factories and production. High income generation."},[h.PARK]:{type:h.PARK,cost:200,color:"#38b2ac",label:"Park",icon:Mt,description:"Green spaces for relaxation and city aesthetics."},[h.BUS_STOP]:{type:h.BUS_STOP,cost:150,color:"#f6ad55",label:"Bus Stop",icon:lt,description:"Define routes. Buses stop at nearby roads to pick up citizens."}},ke={money:5e3,population:0,day:1,income:0,expense:0},Lt="neo-city-db",Z="saves",se="current-save",zt=1;class _t{db=null;dbReady;constructor(){this.dbReady=this.initDB()}initDB(){return new Promise((o,f)=>{if(typeof window>"u"||!window.indexedDB){o();return}const i=indexedDB.open(Lt,1);i.onerror=()=>{console.error("Failed to open IndexedDB:",i.error),f(i.error)},i.onsuccess=()=>{this.db=i.result,o()},i.onupgradeneeded=l=>{const n=l.target.result;n.objectStoreNames.contains(Z)||n.createObjectStore(Z)}})}async save(o,f,i,l,n){await this.dbReady;const M={cityData:o,stats:f,cityName:i,gameTime:l,feedMessages:n,savedAt:Date.now(),version:zt};return this.db?new Promise(S=>{const P=this.db.transaction([Z],"readwrite").objectStore(Z).put(M,se);P.onsuccess=()=>S(!0),P.onerror=()=>{console.error("IndexedDB save failed, trying localStorage"),S(this.saveToLocalStorage(M))}}):this.saveToLocalStorage(M)}saveToLocalStorage(o){try{return $e(se,o),!0}catch(f){return console.error("localStorage save failed:",f),!1}}async load(){if(await this.dbReady,this.db){const o=await new Promise(f=>{const n=this.db.transaction([Z],"readonly").objectStore(Z).get(se);n.onsuccess=()=>f(n.result||null),n.onerror=()=>{console.error("IndexedDB load failed, trying localStorage"),f(null)}});if(o)return o}return this.loadFromLocalStorage()}loadFromLocalStorage(){try{const o=Ve(se,!0);if(o)return o}catch(o){console.error("localStorage load failed:",o)}return null}async deleteSave(){if(await this.dbReady,this.db)return new Promise(o=>{const l=this.db.transaction([Z],"readwrite").objectStore(Z).delete(se);l.onsuccess=()=>o(!0),l.onerror=()=>o(!1)});try{return He(se),!0}catch{return!1}}async hasSave(){return await this.load()!==null}}const Se=new _t,Ut=({type:r,variant:o=0,position:f,isSelected:i,connections:l})=>{const n=s.useRef(null);ue(S=>{n.current&&i?n.current.position.y=Math.sin(S.clock.elapsedTime*4)*.1+.1:n.current&&(n.current.position.y=Me.lerp(n.current.position.y,0,.1))});const M=s.useMemo(()=>{const S=i?"#ffffff":"#000000",m=i?.5:0,x="#fbbf24",P="#ffffff",U="#1a1a1a",D="#a0aec0",L="#2d3748";switch(r){case h.ROAD:{const{n:u=!1,s:k=!1,e:N=!1,w:t=!1}=l||{},y=[u,k,N,t].filter(Boolean).length,p=u&&k&&!N&&!t,E=N&&t&&!u&&!k,A=y>2,a=({type:v="double",rotation:C=0,length:T=.5,position:R=[0,.081,0]})=>v==="double"?e.jsxs("group",{rotation:[0,C,0],position:R,children:[e.jsx(g,{args:[.02,.005,T],children:e.jsx("meshStandardMaterial",{color:x})}),e.jsx(g,{args:[.02,.005,T],position:[.04,0,0],children:e.jsx("meshStandardMaterial",{color:x})})]}):v==="dashed"?e.jsxs("group",{rotation:[0,C,0],position:R,children:[e.jsx(g,{args:[.02,.005,T*.3],position:[.02,0,T*.3],children:e.jsx("meshStandardMaterial",{color:x})}),e.jsx(g,{args:[.02,.005,T*.3],position:[.02,0,-T*.3],children:e.jsx("meshStandardMaterial",{color:x})})]}):e.jsx(g,{args:[.03,.005,T],rotation:[0,C,0],position:R,children:e.jsx("meshStandardMaterial",{color:x})}),c=({rotation:v=0,position:C=[0,.083,0]})=>e.jsx("group",{rotation:[0,v,0],position:C,children:[-.24,-.12,0,.12,.24].map((T,R)=>e.jsx(g,{args:[.08,.004,.22],position:[T,0,0],children:e.jsx("meshStandardMaterial",{color:P,roughness:.4})},R))}),d=({rotation:v=0,position:C=[0,0,0],args:T=[1,.03,.04]})=>e.jsx(g,{args:T,rotation:[0,v,0],position:C,children:e.jsx("meshStandardMaterial",{color:L,roughness:.7})});return e.jsxs("group",{children:[e.jsx(g,{args:[1,.08,1],position:[0,.04,0],children:e.jsx("meshStandardMaterial",{color:U,emissive:S,emissiveIntensity:m,roughness:.9})}),e.jsx(g,{args:[.1,.022,1],position:[-.45,.08,0],receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:D})}),e.jsx(g,{args:[.1,.022,1],position:[.45,.08,0],receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:D})}),e.jsx(g,{args:[1,.022,.1],position:[0,.08,-.45],receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:D})}),e.jsx(g,{args:[1,.022,.1],position:[0,.08,.45],receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:D})}),u&&(!p||A)&&e.jsx(c,{position:[0,.083,-.36]}),k&&(!p||A)&&e.jsx(c,{position:[0,.083,.36]}),t&&(!E||A)&&e.jsx(c,{rotation:Math.PI/2,position:[-.36,.083,0]}),N&&(!E||A)&&e.jsx(c,{rotation:Math.PI/2,position:[.36,.083,0]}),e.jsxs("group",{position:[-.01,0,0],children:[u&&e.jsx(a,{type:p?"dashed":"double",length:.4,position:[0,.081,-.25]}),k&&e.jsx(a,{type:p?"dashed":"double",length:.4,position:[0,.081,.25]}),t&&e.jsx(a,{type:E?"dashed":"double",rotation:Math.PI/2,length:.4,position:[-.25,.081,0]}),N&&e.jsx(a,{type:E?"dashed":"double",rotation:Math.PI/2,length:.4,position:[.25,.081,0]})]}),!u&&e.jsx(d,{position:[0,.09,-.48],args:[1,.04,.04]}),!k&&e.jsx(d,{position:[0,.09,.48],args:[1,.04,.04]}),!N&&e.jsx(d,{position:[.48,.09,0],args:[.04,.04,1]}),!t&&e.jsx(d,{position:[-.48,.09,0],args:[.04,.04,1]})]})}case h.RESIDENTIAL:{const u="#48bb78";return o===1?e.jsxs("group",{children:[e.jsx(g,{args:[.4,.7,.6],position:[-.15,.35,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(g,{args:[.4,.4,.6],position:[.15,.2,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#c6f6d5"})}),e.jsx(g,{args:[.8,.05,.7],position:[0,.7,0],children:e.jsx("meshStandardMaterial",{color:"#2d3748"})})]}):o===2?e.jsxs("group",{children:[e.jsx(g,{args:[.8,.35,.4],position:[0,.175,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(g,{args:[.9,.1,.5],position:[0,.35,0],rotation:[.05,0,0],children:e.jsx("meshStandardMaterial",{color:"#22543d"})})]}):e.jsxs("group",{children:[e.jsx(g,{args:[.6,.5,.6],position:[0,.25,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(ge,{args:[.5,.4,4],position:[0,.7,0],rotation:[0,Math.PI/4,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#276749"})})]})}case h.COMMERCIAL:{const u="#4299e1";return o===1?e.jsxs("group",{children:[e.jsx(g,{args:[.6,1.2,.6],position:[0,.6,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m,transparent:!0,opacity:.9,metalness:1,roughness:0})}),e.jsx(g,{args:[.65,.05,.65],position:[0,1.2,0],children:e.jsx("meshStandardMaterial",{color:"#2b6cb0"})})]}):o===2?e.jsxs("group",{children:[e.jsx(g,{args:[.8,.4,.8],position:[0,.2,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(g,{args:[.2,.5,.1],position:[.2,.45,.35],children:e.jsx("meshStandardMaterial",{color:"#f6e05e",emissive:"#f6e05e",emissiveIntensity:.5})}),e.jsx(g,{args:[.9,.05,.9],position:[0,.4,0],children:e.jsx("meshStandardMaterial",{color:"#2c5282"})})]}):e.jsxs("group",{children:[e.jsx(g,{args:[.7,.8,.7],position:[0,.4,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(g,{args:[.75,.1,.75],position:[0,.85,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#2b6cb0"})})]})}case h.INDUSTRIAL:{const u="#ecc94b";return o===1?e.jsxs("group",{children:[e.jsx(q,{args:[.2,.2,.5,12],position:[-.2,.25,-.2],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#cbd5e0",emissive:S,emissiveIntensity:m})}),e.jsx(q,{args:[.2,.2,.5,12],position:[.2,.25,.2],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#cbd5e0"})}),e.jsx(g,{args:[.8,.1,.8],position:[0,.05,0],children:e.jsx("meshStandardMaterial",{color:"#4a5568"})})]}):o===2?e.jsxs("group",{children:[e.jsx(g,{args:[.7,.4,.7],position:[0,.2,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(q,{args:[.05,.05,.8,6],position:[.2,.4,.2],children:e.jsx("meshStandardMaterial",{color:"#744210"})}),e.jsx(q,{args:[.05,.05,.8,6],position:[-.2,.4,.2],children:e.jsx("meshStandardMaterial",{color:"#744210"})}),e.jsx(q,{args:[.05,.05,.8,6],position:[0,.4,-.2],children:e.jsx("meshStandardMaterial",{color:"#744210"})})]}):e.jsxs("group",{children:[e.jsx(g,{args:[.8,.6,.8],position:[0,.3,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(q,{args:[.1,.1,1,8],position:[.2,.6,.2],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#744210"})})]})}case h.PARK:{const u="#38b2ac";return o===1?e.jsxs("group",{children:[e.jsx(g,{args:[.9,.1,.9],position:[0,.05,0],receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(q,{args:[.3,.3,.05,16],position:[0,.1,0],children:e.jsx("meshStandardMaterial",{color:"#63b3ed",metalness:1,roughness:0})}),e.jsx(Et,{args:[.1,8,8],position:[0,.2,0],children:e.jsx("meshStandardMaterial",{color:"#ebf8ff",transparent:!0,opacity:.6})})]}):o===2?e.jsxs("group",{children:[e.jsx(g,{args:[.9,.1,.9],position:[0,.05,0],receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(g,{args:[.2,.2,.2],position:[-.2,.2,.2],children:e.jsx("meshStandardMaterial",{color:"#f56565"})}),e.jsx(q,{args:[.02,.2,.4,4],position:[.2,.2,-.2],rotation:[0,0,.5],children:e.jsx("meshStandardMaterial",{color:"#4299e1"})})]}):e.jsxs("group",{children:[e.jsx(g,{args:[.9,.1,.9],position:[0,.05,0],receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:u,emissive:S,emissiveIntensity:m})}),e.jsx(ge,{args:[.2,.5,8],position:[0,.4,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#234e52"})}),e.jsx(ge,{args:[.15,.3,8],position:[.25,.25,.2],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#2d6a4f"})})]})}case h.BUS_STOP:return e.jsxs("group",{children:[e.jsx(g,{args:[.8,.05,.8],position:[0,.025,0],receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#718096",emissive:S,emissiveIntensity:m})}),e.jsx(g,{args:[.6,.5,.05],position:[0,.25,-.3],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#4a5568",transparent:!0,opacity:.8})}),e.jsx(g,{args:[.7,.05,.4],position:[0,.5,-.15],rotation:[.1,0,0],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#2d3748"})}),e.jsx(g,{args:[.4,.1,.15],position:[0,.1,-.15],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#744210"})}),e.jsx(q,{args:[.02,.02,.6,8],position:[.3,.3,.2],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#a0aec0"})}),e.jsx(g,{args:[.15,.1,.02],position:[.3,.55,.2],castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#f6ad55"})})]});default:return null}},[r,o,i,l]);return e.jsx("group",{position:f,ref:n,children:M})},Ot=({cityData:r,onTileClick:o,selectedType:f,selectedBuilding:i})=>{const[l,n]=s.useState(null),M=x=>{x.stopPropagation();const P=Math.floor(x.point.x+j/2),U=Math.floor(x.point.z+j/2);P>=0&&P<j&&U>=0&&U<j?n({x:P,z:U}):n(null)},S=x=>{x.stopPropagation(),l&&o(l.x,l.z)},m=(x,P)=>r.some(U=>U.x===x&&U.z===P&&U.type===h.ROAD);return e.jsxs("group",{children:[e.jsxs("group",{position:[0,-.25,0],children:[e.jsx(g,{args:[j,.5,j],children:e.jsx("meshStandardMaterial",{color:"#38a169"})}),e.jsx(g,{args:[j,1.5,j],position:[0,-1,0],children:e.jsx("meshStandardMaterial",{color:"#4a3728"})})]}),e.jsx(Ze,{infiniteGrid:!1,args:[j,j],fadeDistance:30,sectionSize:Re,sectionThickness:1.5,sectionColor:"#2d3748",cellSize:Re,cellThickness:.5,cellColor:"#2d3748",position:[0,.01,0]}),e.jsx(At,{args:[j,j],rotation:[-Math.PI/2,0,0],position:[0,.02,0],onPointerMove:M,onPointerOut:()=>n(null),onClick:S,receiveShadow:!0,children:e.jsx("meshStandardMaterial",{transparent:!0,opacity:0})}),r.map(x=>{if(x.type===h.EMPTY)return null;const P=x.type===h.ROAD?{n:m(x.x,x.z-1),s:m(x.x,x.z+1),e:m(x.x+1,x.z),w:m(x.x-1,x.z)}:void 0;return e.jsx(Ut,{type:x.type,variant:x.level,isSelected:i?.x===x.x&&i?.z===x.z,position:[x.x-j/2+.5,0,x.z-j/2+.5],connections:P},`${x.x}-${x.z}`)}),l&&e.jsxs("mesh",{position:[l.x-j/2+.5,.03,l.z-j/2+.5],rotation:[-Math.PI/2,0,0],children:[e.jsx("planeGeometry",{args:[.95,.95]}),e.jsx("meshStandardMaterial",{color:f===h.EMPTY?"#f56565":"#ffffff",transparent:!0,opacity:.3})]})]})},Bt=({stats:r,cityName:o,onRenameCity:f,selectedType:i,onSelectType:l,selectedBuildingInfo:n,onDeselect:M,isFeedVisible:S,onToggleFeed:m,saveSettings:x,onSave:P,onToggleAutoSave:U,gameTime:D})=>{const[L,u]=s.useState(!1),[k,N]=s.useState(o),t=s.useRef(null),y=n?n.type:i,p=y!==h.EMPTY?de[y]:null,E=a=>{const c=Math.floor(a),d=Math.floor(a%1*60),v=c>=12?"PM":"AM";return`${c%12||12}:${d.toString().padStart(2,"0")} ${v}`};s.useEffect(()=>{L&&t.current&&(t.current.focus(),t.current.select())},[L]);const A=a=>{a?.preventDefault();const c=k.trim()||o;f(c),N(c),u(!1)};return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-6",children:[e.jsxs("div",{className:"flex flex-row justify-between items-start w-full relative",children:[e.jsxs("div",{className:"flex flex-col space-y-4 items-start",children:[e.jsx("div",{className:"pointer-events-auto group",children:L?e.jsx("form",{onSubmit:A,className:"flex items-center",children:e.jsx("input",{ref:t,type:"text",value:k,onChange:a=>N(a.target.value),onBlur:()=>A(),className:"bg-gray-800/80 backdrop-blur-md border-2 border-blue-500 rounded-lg px-4 py-1 text-2xl font-black text-white shadow-[0_0_15px_rgba(59,130,246,0.5)] focus:outline-none tracking-tight",maxLength:24})}):e.jsxs("div",{onClick:()=>u(!0),className:"flex items-center space-x-3 cursor-pointer hover:translate-x-1 transition-transform duration-200",children:[e.jsx("h1",{className:"text-3xl font-black italic tracking-tighter drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)] text-white bg-linear-to-br from-white to-gray-400 bg-clip-text",children:o}),e.jsx(vt,{className:"w-3 h-3 text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity"})]})}),e.jsx("div",{className:"flex justify-start items-start pointer-events-auto w-full",children:e.jsxs("div",{className:"bg-gray-900/80 backdrop-blur-md border border-gray-700 p-4 rounded-xl shadow-2xl flex space-x-8",children:[e.jsx(oe,{icon:kt,label:"Budget",value:`$${r.money.toLocaleString()}`,color:"text-yellow-400"}),e.jsx(oe,{icon:Pt,label:"Population",value:r.population.toLocaleString(),color:"text-green-400"}),e.jsx(oe,{icon:ut,label:"Day",value:r.day.toString(),color:"text-blue-400"}),e.jsx(oe,{icon:et,label:"Time",value:E(D),color:"text-indigo-400"}),e.jsx(oe,{icon:Nt,label:"Cashflow",value:`$${r.income-r.expense}/m`,color:r.income-r.expense>=0?"text-green-400":"text-red-400"})]})})]}),e.jsxs("div",{className:"bg-gray-900/90 text-white p-2 md:p-3 rounded-xl border border-gray-700 shadow-2xl backdrop-blur-md flex gap-2 md:gap-3 items-center pointer-events-auto",children:[e.jsxs("button",{onClick:P,className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-lg transition-colors text-xs font-bold uppercase tracking-wide",title:"Save City",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Save"})]}),e.jsxs("button",{onClick:U,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-xs font-bold uppercase tracking-wide ${x.autoSaveEnabled?"bg-green-600 hover:bg-green-500 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,title:x.autoSaveEnabled?"Disable Auto-save":"Enable Auto-save",children:[e.jsx(rt,{className:`w-4 h-4 ${x.autoSaveEnabled?"animate-spin":""}`}),e.jsx("span",{className:"hidden md:inline",children:"Auto"})]}),x.lastSavedAt&&e.jsxs("div",{className:"hidden lg:flex flex-col items-end border-l border-gray-700 pl-3",children:[e.jsx("span",{className:"text-[8px] text-gray-500 uppercase font-bold tracking-widest",children:"Last Sync"}),e.jsx("span",{className:"text-[10px] font-mono text-blue-400",children:new Date(x.lastSavedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})]}),p&&e.jsxs("div",{className:"absolute top-1/2 left-6 -translate-y-1/2 w-72 bg-gray-900/95 backdrop-blur-xl border border-blue-500/30 rounded-2xl shadow-2xl p-6 pointer-events-auto animate-in slide-in-from-left duration-300",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-gray-800",children:e.jsx(p.icon,{className:"w-6 h-6",style:{color:p.color}})}),n&&e.jsx("button",{onClick:M,className:"text-gray-500 hover:text-white transition-colors",children:e.jsx(nt,{className:"w-5 h-5"})})]}),e.jsx("h3",{className:"text-xl font-bold mb-1",children:p.label}),e.jsx("p",{className:"text-xs text-gray-500 mb-4 uppercase tracking-widest",children:n?"Building Inspector":"Construction Tool"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-gray-300 leading-relaxed italic",children:['"',p.description,'"']}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 border-t border-gray-800 pt-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Cost"}),e.jsxs("p",{className:`text-sm ${r.money>=p.cost?"text-green-400":"text-red-400"}`,children:["$",p.cost.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Status"}),e.jsx("p",{className:"text-sm text-green-400",children:n?"Operational":"Ready"})]}),n&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Coordinates"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["X: ",n.x,", Z: ",n.z]})]})]})]})]}),e.jsx("div",{className:"flex justify-start pointer-events-auto",children:e.jsx("div",{className:"bg-gray-900/90 backdrop-blur-md border border-gray-700 p-2 rounded-2xl shadow-2xl flex space-x-2",children:Object.values(de).map(a=>e.jsxs("button",{onClick:()=>l(a.type),className:`flex flex-col items-center justify-center w-20 h-20 rounded-xl transition-all ${i===a.type?"bg-blue-600 ring-2 ring-white scale-105":"bg-gray-800 hover:bg-gray-700"}`,children:[e.jsx(a.icon,{className:"w-6 h-6 mb-1"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-tighter",children:a.label}),e.jsxs("span",{className:"text-[10px] opacity-70",children:["$",a.cost]})]},a.type))})})]})},oe=({icon:r,label:o,value:f,color:i})=>e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400 tracking-widest",children:o}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(r,{className:`w-4 h-4 ${i}`}),e.jsx("span",{className:"text-xl font-bold tabular-nums",children:f})]})]}),K=[.14,.32],Gt=.42,Wt=.85,je=1.6,Q=24,ae=40,ne=6,$t=3,Vt=2,Ht=2.5,G=new ze,w=new ze,ie=new le,Ft=new Ke().makeScale(0,0,0),Te=["#f56565","#4299e1","#f6e05e","#ffffff","#2d3748","#38b2ac","#9f7aea"],De=["#f6ad55","#4fd1c5","#6366f1"],Ee=["#8d5524","#c68642","#e0ac69","#f1c27d","#ffdbac"],Ae=["#2563eb","#dc2626","#16a34a","#d97706","#7c3aed","#db2777","#4b5563","#1e293b","#f97316","#06b6d4","#84cc16","#6366f1"],Yt=({cityData:r})=>{const o=s.useRef(null),f=s.useRef(null),i=s.useRef(null),l=s.useRef(null),n=s.useRef(null),M=s.useRef(null),S=s.useRef(null),m=s.useRef(null),x=s.useRef(null),P=s.useRef([]);s.useEffect(()=>{const D=r.filter(a=>a.type===h.ROAD),L=r.filter(a=>a.type===h.BUS_STOP),u=r.filter(a=>a.type!==h.EMPTY&&a.type!==h.ROAD),k=P.current.filter(a=>a.type==="car"),N=P.current.filter(a=>a.type==="person"),t=P.current.filter(a=>a.type==="bus");let y=[...P.current];y=y.filter(a=>{const c=Math.floor(a.targetPos.x+j/2),d=Math.floor(a.targetPos.z+j/2),v=r.find(C=>C.x===c&&C.z===d);return a.type==="car"||a.type==="bus"?v&&v.type===h.ROAD:v&&v.type!==h.EMPTY});const p=Math.min(Q,D.length)-k.length;if(p>0)for(let a=0;a<p;a++){const c=D[Math.floor(Math.random()*D.length)],d=new z(c.x-j/2+.5,.08,c.z-j/2+.5),v=Math.floor(Math.random()*K.length);y.push({id:Math.random(),type:"car",prevPos:d.clone(),currentPos:d.clone(),targetPos:d.clone(),actualWorldPos:d.clone(),progress:1,baseSpeed:.5+Math.random()*.4,currentSpeed:.5,color:Te[Math.floor(Math.random()*Te.length)],waitTimer:0,lastDirection:new z(0,0,1),targetRotation:new re,currentRotation:new re,laneIndex:v,visualLaneOffset:K[v],laneChangeTimer:0,preferredSide:0,isStoppedAtStation:!1})}const E=Math.min(ne,L.length*2)-t.length;if(E>0&&D.length>0)for(let a=0;a<E;a++){const c=D[Math.floor(Math.random()*D.length)],d=new z(c.x-j/2+.5,.12,c.z-j/2+.5);y.push({id:Math.random(),type:"bus",prevPos:d.clone(),currentPos:d.clone(),targetPos:d.clone(),actualWorldPos:d.clone(),progress:1,baseSpeed:.35,currentSpeed:.35,color:De[Math.floor(Math.random()*De.length)],waitTimer:0,lastDirection:new z(0,0,1),targetRotation:new re,currentRotation:new re,laneIndex:1,visualLaneOffset:K[1],laneChangeTimer:0,preferredSide:0,isStoppedAtStation:!1})}const A=Math.min(ae,u.length)-N.length;if(A>0)for(let a=0;a<A;a++){const c=u[Math.floor(Math.random()*u.length)],d=new z(c.x-j/2+.5,.05,c.z-j/2+.5);y.push({id:Math.random(),type:"person",prevPos:d.clone(),currentPos:d.clone(),targetPos:d.clone(),actualWorldPos:d.clone(),progress:1,baseSpeed:.12+Math.random()*.1,currentSpeed:.12,color:Ae[Math.floor(Math.random()*Ae.length)],headColor:Ee[Math.floor(Math.random()*Ee.length)],scale:.85+Math.random()*.3,waitTimer:0,lastDirection:new z(0,0,1),targetRotation:new re,currentRotation:new re,laneIndex:0,visualLaneOffset:0,laneChangeTimer:0,preferredSide:Math.random()>.5?1:-1,isStoppedAtStation:!1})}if(P.current=y,o.current){const a=y.filter(c=>c.type==="car");for(let c=0;c<Q;c++)c<a.length&&(o.current.setColorAt(c,ie.set(a[c].color)),f.current?.setColorAt(c,ie.set(a[c].color)));o.current.instanceColor&&(o.current.instanceColor.needsUpdate=!0),f.current?.instanceColor&&(f.current.instanceColor.needsUpdate=!0)}if(M.current){const a=y.filter(c=>c.type==="bus");for(let c=0;c<ne;c++)c<a.length&&M.current.setColorAt(c,ie.set(a[c].color));M.current.instanceColor&&(M.current.instanceColor.needsUpdate=!0)}if(m.current){const a=y.filter(c=>c.type==="person");for(let c=0;c<ae;c++)c<a.length&&(m.current.setColorAt(c,ie.set(a[c].color)),x.current?.setColorAt(c,ie.set(a[c].headColor)));m.current.instanceColor&&(m.current.instanceColor.needsUpdate=!0),x.current?.instanceColor&&(x.current.instanceColor.needsUpdate=!0)}},[r]);const U=(D,L,u,k,N)=>{const y=[{x:D+1,z:L},{x:D-1,z:L},{x:D,z:L+1},{x:D,z:L-1}].map(p=>{const E=r.find(a=>a.x===p.x&&a.z===p.z);if(!E)return{...p,score:-1/0};if((N==="car"||N==="bus")&&E.type!==h.ROAD)return{...p,score:-1/0};if(N==="person"&&E.type===h.EMPTY)return{...p,score:-1/0};let A=100;return p.x===u&&p.z===k&&(A-=195),A+=Math.random()*20,{...p,score:A}}).filter(p=>p.score!==-1/0);return y.length>0?(y.sort((p,E)=>E.score-p.score),y[0]):null};return ue((D,L)=>{[o,f,i,l,n,M,S,m,x].forEach(t=>{if(t.current)for(let y=0;y<(t.current.count||0);y++)t.current.setMatrixAt(y,Ft)});let u=0,k=0,N=0;P.current.forEach(t=>{const y=t.type==="car",p=t.type==="bus",E=t.type==="person";if((y||p)&&t.currentSpeed<.05){if(t.waitTimer+=L,t.waitTimer>$t){const d=t.currentPos.clone();t.currentPos.copy(t.targetPos),t.targetPos.copy(d),t.progress=1-t.progress,t.waitTimer=0}}else t.waitTimer=0;if(t.progress>=1){const d=Math.floor(t.targetPos.x+j/2),v=Math.floor(t.targetPos.z+j/2);if(p&&!t.isStoppedAtStation&&[{x:d+1,z:v},{x:d-1,z:v},{x:d,z:v+1},{x:d,z:v-1}].some(_=>r.find(B=>B.x===_.x&&B.z===_.z)?.type===h.BUS_STOP)&&(t.isStoppedAtStation=!0,t.waitTimer=Ht),p&&t.isStoppedAtStation)if(t.waitTimer-=L,t.waitTimer<=0)t.isStoppedAtStation=!1;else return;const C=Math.floor(t.prevPos.x+j/2),T=Math.floor(t.prevPos.z+j/2),R=U(d,v,C,T,t.type);if(R){t.prevPos.copy(t.currentPos),t.currentPos.copy(t.targetPos);const $=r.find(B=>B.x===R.x&&B.z===R.z),_=new z(R.x-j/2+.5,p?.12:y?.08:.05,R.z-j/2+.5);if(y||p){const B=new z().subVectors(_,t.currentPos).normalize(),X=new z(-B.z,0,B.x).multiplyScalar(K[t.laneIndex]);t.targetPos.copy(_.add(X))}else if($?.type===h.ROAD){const B=new z().subVectors(_,t.currentPos).normalize(),X=new z(-B.z,0,B.x).multiplyScalar(Gt*t.preferredSide);t.targetPos.copy(_.add(X))}else{const B=new z((Math.random()-.5)*.45,0,(Math.random()-.5)*.45);t.targetPos.copy(_.add(B))}t.progress=0}else if(y||p){const $=t.currentPos.clone();t.currentPos.copy(t.targetPos),t.targetPos.copy($),t.progress=0}}let A=t.baseSpeed;if(y||p){t.laneChangeTimer=Math.max(0,t.laneChangeTimer-L);const d=new z().subVectors(t.targetPos,t.currentPos).normalize();let v=!1;for(const C of P.current)if((C.type==="car"||C.type==="bus")&&C.id!==t.id){const T=t.actualWorldPos.distanceTo(C.actualWorldPos);if(T<je){const R=new z().subVectors(C.actualWorldPos,t.actualWorldPos).normalize();d.dot(R)>.6&&t.laneIndex===C.laneIndex&&(A=T<(p?1.2:Wt)?0:t.baseSpeed*.4,y&&T<je*.8&&C.currentSpeed<t.baseSpeed*.6&&(v=!0))}}if(y&&v&&t.laneChangeTimer<=0){const C=(t.laneIndex+1)%K.length;let T=!0;for(const R of P.current)if((R.type==="car"||R.type==="bus")&&R.id!==t.id&&R.laneIndex===C&&t.actualWorldPos.distanceTo(R.actualWorldPos)<je){T=!1;break}if(T){t.laneIndex=C,t.laneChangeTimer=Vt;const R=new z().subVectors(t.targetPos,t.currentPos).normalize(),$=t.targetPos.clone().sub(new z(-R.z,0,R.x).multiplyScalar(K[1-C]));t.targetPos.copy($.add(new z(-R.z,0,R.x).multiplyScalar(K[C])))}}t.visualLaneOffset=Me.lerp(t.visualLaneOffset,K[t.laneIndex],.05)}else for(const d of P.current)d.type==="person"&&d.id!==t.id&&t.actualWorldPos.distanceTo(d.actualWorldPos)<.2&&(A*=.5);t.currentSpeed=Me.lerp(t.currentSpeed,A,.1),t.progress=Math.min(1,t.progress+L*t.currentSpeed);const a=new z().lerpVectors(t.currentPos,t.targetPos,t.progress);if(y||p){const d=new z().subVectors(t.targetPos,t.currentPos).normalize(),v=new z(-d.z,0,d.x).multiplyScalar(t.visualLaneOffset-K[t.laneIndex]);t.actualWorldPos.copy(a.add(v))}else t.actualWorldPos.copy(a);G.position.copy(t.actualWorldPos);const c=new z().subVectors(t.targetPos,t.currentPos).normalize();if(c.lengthSq()>.001&&(G.lookAt(t.actualWorldPos.clone().add(c)),t.targetRotation.copy(G.quaternion),t.lastDirection.copy(c)),t.currentRotation.slerp(t.targetRotation,E?.3:.12),G.quaternion.copy(t.currentRotation),y&&u<Q){G.updateMatrix(),o.current?.setMatrixAt(u,G.matrix),w.copy(G),w.position.y+=.07,w.position.add(t.lastDirection.clone().multiplyScalar(-.04)),w.scale.set(.8,.7,.5),w.updateMatrix(),f.current?.setMatrixAt(u,w.matrix),w.scale.set(.85,.75,.55),w.updateMatrix(),i.current?.setMatrixAt(u,w.matrix);const d=new z(-t.lastDirection.z,0,t.lastDirection.x).normalize();w.copy(G),w.position.add(t.lastDirection.clone().multiplyScalar(.201)).add(d.clone().multiplyScalar(.06)),w.scale.set(1,1,1),w.updateMatrix(),l.current?.setMatrixAt(u*2,w.matrix),w.position.add(d.clone().multiplyScalar(-.12)),w.updateMatrix(),l.current?.setMatrixAt(u*2+1,w.matrix),w.copy(G),w.position.add(t.lastDirection.clone().multiplyScalar(-.201)).add(d.clone().multiplyScalar(.06)),w.updateMatrix(),n.current?.setMatrixAt(u*2,w.matrix),w.position.add(d.clone().multiplyScalar(-.12)),w.updateMatrix(),n.current?.setMatrixAt(u*2+1,w.matrix),u++}else if(p&&k<ne)G.updateMatrix(),M.current?.setMatrixAt(k,G.matrix),w.copy(G),w.position.y+=.08,w.scale.set(.9,.6,.85),w.updateMatrix(),S.current?.setMatrixAt(k,w.matrix),k++;else if(E&&N<ae){const d=Math.abs(Math.sin(D.clock.elapsedTime*10+t.id))*.03,v=t.scale||1;G.scale.set(v,v,v),G.position.y=t.actualWorldPos.y+d+.05*v,G.updateMatrix(),m.current?.setMatrixAt(N,G.matrix),w.copy(G),w.position.y+=.09*v,w.scale.set(v*.8,v*.8,v*.8),w.updateMatrix(),x.current?.setMatrixAt(N,w.matrix),N++}}),[o,f,i,l,n,M,S,m,x].forEach(t=>{t.current&&(t.current.instanceMatrix.needsUpdate=!0)})}),e.jsxs("group",{children:[e.jsxs("instancedMesh",{ref:o,args:[void 0,void 0,Q],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.2,.1,.4]}),e.jsx("meshStandardMaterial",{roughness:.3,metalness:.7})]}),e.jsxs("instancedMesh",{ref:f,args:[void 0,void 0,Q],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.2,.1,.4]}),e.jsx("meshStandardMaterial",{roughness:.3,metalness:.7})]}),e.jsxs("instancedMesh",{ref:i,args:[void 0,void 0,Q],children:[e.jsx("boxGeometry",{args:[.2,.1,.4]}),e.jsx("meshStandardMaterial",{color:"#050505",roughness:0,metalness:1})]}),e.jsxs("instancedMesh",{ref:l,args:[void 0,void 0,Q*2],children:[e.jsx("boxGeometry",{args:[.05,.03,.01]}),e.jsx("meshStandardMaterial",{color:"#ffffff",emissive:"#ffffff",emissiveIntensity:3})]}),e.jsxs("instancedMesh",{ref:n,args:[void 0,void 0,Q*2],children:[e.jsx("boxGeometry",{args:[.05,.03,.01]}),e.jsx("meshStandardMaterial",{color:"#ff0000",emissive:"#ff0000",emissiveIntensity:3})]}),e.jsxs("instancedMesh",{ref:M,args:[void 0,void 0,ne],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.35,.25,.8]}),e.jsx("meshStandardMaterial",{roughness:.4,metalness:.3})]}),e.jsxs("instancedMesh",{ref:S,args:[void 0,void 0,ne],children:[e.jsx("boxGeometry",{args:[.35,.25,.8]}),e.jsx("meshStandardMaterial",{color:"#0a0a0a",roughness:0,metalness:1})]}),e.jsxs("instancedMesh",{ref:m,args:[void 0,void 0,ae],castShadow:!0,children:[e.jsx("capsuleGeometry",{args:[.04,.08,4,8]}),e.jsx("meshStandardMaterial",{roughness:.8})]}),e.jsxs("instancedMesh",{ref:x,args:[void 0,void 0,ae],castShadow:!0,children:[e.jsx("sphereGeometry",{args:[.035,8,8]}),e.jsx("meshStandardMaterial",{roughness:.6})]})]})},qt=({gameTime:r})=>{const o=(r-6)/24*Math.PI*2,f=25,i=s.useMemo(()=>new z(Math.cos(o)*f,Math.sin(o)*f,8),[o]),l=r<5.5||r>19.5,n=r>=5.5&&r<=7||r>=18&&r<=19.5,M=s.useMemo(()=>l?new le("#3b82f6"):n?new le("#ffaa44"):new le("#ffffff"),[l,n]),S=s.useMemo(()=>l?.2:n?.8:1.2,[l,n]),m=s.useMemo(()=>l?"#0f172a":n?"#fb923c":"#BAE6FD",[l,n]);return e.jsxs("group",{children:[e.jsx("color",{attach:"background",args:[m]}),e.jsx("directionalLight",{position:i,intensity:S,color:M,castShadow:!0,"shadow-bias":-5e-4,"shadow-mapSize":[2048,2048]}),e.jsx("ambientLight",{intensity:l?.3:.6,color:l?"#3b82f6":"#ffffff"})]})},ve=(r,o)=>Math.random()*(o-r)+r,Ie=new Xe(1,1,1),Kt=new Je(1,8,8),ce=({position:r,scale:o,speed:f})=>{const i=s.useRef(null);ue((n,M)=>{i.current&&(i.current.position.x+=f*M,i.current.position.x>j*1.5&&(i.current.position.x=-j*1.5))});const l=s.useMemo(()=>Array.from({length:5+Math.round(Math.random()*5)}).map(()=>({pos:[ve(-1,1),ve(-.5,.5),ve(-1,1)],scale:ve(.5,1.2)})),[]);return e.jsx("group",{ref:i,position:r,scale:o,children:l.map((n,M)=>e.jsx("mesh",{geometry:Kt,position:n.pos,scale:n.scale,castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"white",flatShading:!0,opacity:.4,transparent:!0})},M))})},be=({position:r,speed:o,offset:f})=>{const i=s.useRef(null);return ue(l=>{if(i.current){const n=l.clock.elapsedTime+f;i.current.position.x=r[0]+Math.sin(n*o)*(j/2),i.current.position.z=r[1]+Math.cos(n*o)*(j/2),i.current.rotation.y=-n*o+Math.PI,i.current.scale.y=1+Math.sin(n*15)*.3}}),e.jsxs("group",{ref:i,position:[r[0],r[2],r[1]],children:[e.jsx("mesh",{geometry:Ie,scale:[.2,.05,.05],position:[.1,0,0],rotation:[0,Math.PI/4,0],children:e.jsx("meshBasicMaterial",{color:"#333"})}),e.jsx("mesh",{geometry:Ie,scale:[.2,.05,.05],position:[-.1,0,0],rotation:[0,-Math.PI/4,0],children:e.jsx("meshBasicMaterial",{color:"#333"})})]})},Xt=()=>e.jsxs("group",{raycast:()=>null,children:[e.jsx(ce,{position:[-12,10,4],scale:1.5,speed:.3}),e.jsx(ce,{position:[-12,10,4],scale:1.5,speed:.3}),e.jsx(ce,{position:[5,12,-8],scale:1.2,speed:.5}),e.jsx(ce,{position:[15,9,10],scale:1.8,speed:.2}),e.jsx(ce,{position:[-5,11,-12],scale:1.3,speed:.4}),e.jsxs("group",{position:[0,0,0],scale:.8,children:[e.jsx(be,{position:[0,0,8],speed:.6,offset:0}),e.jsx(be,{position:[2,0,8],speed:.6,offset:1.2}),e.jsx(be,{position:[-2,0,8],speed:.6,offset:2.5})]})]}),Jt=({messages:r,isVisible:o,onClear:f})=>{const[i,l]=s.useState(!1);return o?e.jsxs("div",{className:"fixed bottom-6 right-6 w-70 z-50 flex flex-col pointer-events-auto",children:[e.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-xl border border-slate-700/50 rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-700/50 bg-slate-800/30",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-slate-400",children:"City Feed"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:f,className:"text-slate-500 hover:text-red-400 transition-colors",title:"Clear all logs",children:e.jsx(st,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>l(!i),className:"text-slate-500 hover:text-white transition-colors",children:i?e.jsx(ot,{className:"w-3 h-3"}):e.jsx(at,{className:"w-3 h-3"})}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)] animate-pulse"})]})]}),!i&&e.jsx("div",{className:"h-64 overflow-y-auto p-4 space-y-3 custom-scrollbar",children:r.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-slate-600 italic text-xs font-mono",children:"Waiting for citizen feedback..."}):r.map(n=>e.jsx("div",{className:"relative group animate-in fade-in slide-in-from-bottom-2 duration-300",children:e.jsxs("div",{className:"bg-slate-800/40 border-l-2 border-green-500/80 p-3 pl-4 rounded-r-lg hover:bg-slate-800/60 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("span",{className:"text-[10px] font-bold text-slate-500 font-mono tracking-tight",children:["@",n.user]}),e.jsx("span",{className:"text-[9px] text-slate-600 font-mono uppercase",children:n.timestamp})]}),e.jsx("p",{className:"text-xs text-slate-200 font-mono leading-relaxed pr-8",children:n.content})]})},n.id))})]}),e.jsx("style",{dangerouslySetInnerHTML:{__html:`
        .custom-scrollbar::-webkit-scrollbar {
          width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: rgba(71, 85, 105, 0.5);
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: rgba(100, 116, 139, 0.8);
        }
      `}})]}):null},Zt=({onStart:r,hasSavedGame:o})=>e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-50 text-white font-sans p-6 bg-black/30 backdrop-blur-sm transition-all duration-1000",children:e.jsxs("div",{className:"max-w-md w-full bg-slate-900/90 p-8 rounded-2xl border border-slate-700 shadow-2xl backdrop-blur-xl relative overflow-hidden animate-fade-in",children:[e.jsx("div",{className:"absolute -top-24 -right-24 w-48 h-48 bg-cyan-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute -bottom-24 -left-24 w-48 h-48 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h1",{className:"text-5xl font-black mb-2 bg-linear-to-br from-white via-cyan-200 to-blue-400 bg-clip-text text-transparent tracking-tight",children:"Neo City"}),e.jsx("p",{className:"text-slate-400 mb-8 text-sm font-medium uppercase tracking-widest",children:"Cyberpunk City Simulation"}),e.jsxs("div",{className:"space-y-3",children:[o&&e.jsxs("button",{onClick:()=>r(!0),className:"w-full py-4 bg-linear-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold rounded-xl shadow-lg shadow-green-900/20 transform transition-all hover:scale-[1.02] active:scale-[0.98] text-lg tracking-wide flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Continue"]}),e.jsx("button",{onClick:()=>r(!1),className:`w-full py-4 text-white font-bold rounded-xl shadow-lg transform transition-all hover:scale-[1.02] active:scale-[0.98] text-lg tracking-wide ${o?"bg-linear-to-r from-slate-600 to-slate-700 hover:from-slate-500 hover:to-slate-600 shadow-slate-900/20":"bg-linear-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 shadow-cyan-900/20"}`,children:o?"New Game":"Start Building"})]})]})]})}),Qt=()=>{const[r,o]=s.useState(!1),[f,i]=s.useState([]),[l,n]=s.useState(ke),[M,S]=s.useState("Neo City"),[m,x]=s.useState(h.ROAD),[P,U]=s.useState(null),[D,L]=s.useState(null),[u,k]=s.useState(10),[N,t]=s.useState([]),[y,p]=s.useState(!0),[E,A]=s.useState({autoSaveEnabled:!0,lastSavedAt:null}),[a,c]=s.useState(!1),d=s.useRef(f),v=s.useRef(l),C=s.useRef(M),T=s.useRef(u),R=s.useRef(N),$=s.useRef(l.money);s.useEffect(()=>{d.current=f},[f]),s.useEffect(()=>{v.current=l},[l]),s.useEffect(()=>{C.current=M},[M]),s.useEffect(()=>{T.current=u},[u]),s.useEffect(()=>{R.current=N},[N]),s.useEffect(()=>{(async()=>{const O=await Se.hasSave();c(O)})()},[]);const _=s.useCallback(async(b=!1)=>{const O=await Se.save(d.current,v.current,C.current,T.current,R.current);if(O&&(A(I=>({...I,lastSavedAt:Date.now()})),!b)){const V=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});t(W=>[{id:Math.random().toString(36).substr(2,9),user:"SYSTEM",content:"City data synchronized to neural network.",timestamp:V,type:"positive"},...W])}return O},[t]),B=s.useCallback(async()=>{const b=await Se.load();return b?(i(b.cityData),n(b.stats),S(b.cityName),k(b.gameTime),t(b.feedMessages),A(O=>({...O,lastSavedAt:b.savedAt})),!0):!1},[]),X=async(b=!1)=>{if(b)await B();else{n(ke),k(10);const O=[];for(let V=0;V<j;V++)for(let W=0;W<j;W++)O.push({x:V,z:W,type:h.EMPTY,level:0});i(O);const I={id:"welcome",user:"SYSTEM",content:`Welcome to ${M}. Terrain generation complete. Ready for development.`,timestamp:"10:00 AM",type:"neutral"};t([I])}o(!0)},ye=()=>{A(b=>({...b,autoSaveEnabled:!b.autoSaveEnabled}))};s.useEffect(()=>{if(!r||!E.autoSaveEnabled)return;const b=setInterval(()=>{_(!0)},6e4);return()=>clearInterval(b)},[r,E.autoSaveEnabled,_]),s.useEffect(()=>{if(!r)return;const b=setInterval(()=>{i(O=>{const I=O.reduce((Y,fe)=>(Y[fe.type]=(Y[fe.type]||0)+1,Y),{}),V=(I[h.RESIDENTIAL]||0)*10,W=(I[h.COMMERCIAL]||0)*15+(I[h.INDUSTRIAL]||0)*25,te=(I[h.ROAD]||0)*2+(I[h.PARK]||0)*10;return n(Y=>({...Y,population:V,money:Y.money+(W-te),income:W,expense:te})),O})},5e3);return()=>clearInterval(b)},[r]);const ee=s.useRef(u);s.useEffect(()=>{if(!r)return;const b=setInterval(()=>{k(O=>{const I=O+.08;return I>=24?0:I})},100);return()=>clearInterval(b)},[r]),s.useEffect(()=>{r&&(ee.current>22&&u<2&&n(b=>({...b,day:b.day+1})),ee.current=u)},[u,r]),s.useEffect(()=>{if(r){if(l.money<0&&$.current>=0){const O=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});t(I=>[{id:Math.random().toString(36).substr(2,9),user:"SYSTEM",content:"Warning: City treasury is in deficit! Revenue generation required.",timestamp:O,type:"negative"},...I].slice(0,50))}$.current=l.money}},[l.money]);const he=s.useCallback((b,O)=>{r&&(L(null),i(I=>{const V=I.findIndex(F=>F.x===b&&F.z===O);if(V===-1)return I;const W=I[V];if(m===h.EMPTY){if(W.type===h.EMPTY)return I;const F=[...I],we=Math.floor(de[W.type].cost*.8),Ue=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return t(me=>[{id:Math.random().toString(36).substr(2,9),user:"SYSTEM",content:`Demolition complete: ${de[W.type].label} removed. $${we} refunded to treasury.`,timestamp:Ue,type:"positive"},...me].slice(0,50)),n(me=>({...me,money:me.money+we})),F[V]={...W,type:h.EMPTY,level:0},U(null),F}if(W.type!==h.EMPTY)return U({x:b,z:O}),I;const te=de[m];if(v.current.money<te.cost)return L("Insufficient budget!"),I;const Y=[...I],fe=Math.floor(Math.random()*3);Y[V]={...W,type:m,level:fe};const _e=new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return t(F=>[{id:Math.random().toString(36).substr(2,9),user:"SYSTEM",content:`Construction complete: ${te.label} deployed at [${b}, ${O}].`,timestamp:_e,type:"neutral"},...F].slice(0,50)),n(F=>({...F,money:F.money-te.cost})),U({x:b,z:O}),Y}))},[m,r]),pe=b=>{x(b),U(null),L(null)},J=f.find(b=>b.x===P?.x&&b.z===P?.z)||null;return e.jsxs("div",{className:"relative w-full h-screen",children:[e.jsxs(Be,{shadows:!0,camera:{position:[15,15,15],fov:40},children:[e.jsx(Xt,{}),e.jsx(qt,{gameTime:u}),e.jsx(Ot,{cityData:f,onTileClick:he,selectedType:m,selectedBuilding:P}),e.jsx(Yt,{cityData:f}),e.jsx(It,{position:[0,-.01,0],opacity:.3,scale:30,blur:2.5,far:5}),e.jsx(Qe,{preset:"city"}),e.jsx(Ge,{makeDefault:!0,maxPolarAngle:Math.PI/2.1,minDistance:5,maxDistance:40})]}),!r&&e.jsx(Zt,{onStart:X,hasSavedGame:a}),r&&e.jsxs(e.Fragment,{children:[e.jsx(Jt,{messages:N,isVisible:y,onClear:()=>t([])}),D&&e.jsxs("div",{className:"absolute top-24 left-1/2 -translate-x-1/2 z-50 bg-red-600/90 text-white px-6 py-2 rounded-full shadow-lg border border-red-400 animate-bounce pointer-events-none flex items-center",children:[e.jsx(it,{className:"w-5 h-5 mr-2"}),D]}),e.jsx(Bt,{stats:l,cityName:M,onRenameCity:S,selectedType:m,onSelectType:pe,selectedBuildingInfo:J,onDeselect:()=>U(null),isFeedVisible:y,onToggleFeed:()=>p(!y),saveSettings:E,onSave:()=>_(!1),onToggleAutoSave:ye,gameTime:u})]})]})},fr={fullscreen:!0};function mr(){return[{title:"Neo City"},{property:"og:title",content:"Neo City"},{name:"description",content:"Neo City - A city building simulation game with isometric 3D graphics."}]}const vr=Oe(Qt);export{vr as default,fr as handle,mr as meta};
