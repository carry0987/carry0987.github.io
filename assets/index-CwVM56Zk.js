import{a as l,R as K,p as e,w as be}from"./chunk-WWGJGFF6-B6u1Qf49.js";import{s as ve,g as ye,r as we}from"./index-Cpx2NyP8.js";import{u as I,e as je,a as ae,_ as se,v as Se,b as U,M as Me,C as ke}from"./constants-BBDI6V1X.js";import{V as L,a as Ne,j as Re,k as he,l as _e,m as Ce,e as Ie,g as H,n as Ee,H as Te,L as ie,D as Pe,o as Ae,p as Q,q as ne,f as Ge,r as Be,s as De,t as ze,u as P,d as Fe,v as pe,w as ge,x as Le}from"./three.module-BciEV48b.js";import{s as Oe,E as $e}from"./Environment-CIYW_Ags.js";import{c as Ue}from"./createLucideIcon-DTDhPEOD.js";const Ve=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],He=Ue("trash-2",Ve);var b=(o=>(o.None="None",o.Road="Road",o.Residential="Residential",o.Commercial="Commercial",o.Industrial="Industrial",o.Park="Park",o))(b||{});const T=15,We=2e3,Ye=1e6,X={[b.None]:{type:b.None,cost:0,name:"Bulldoze",description:"Clear a tile",color:"#ef4444",popGen:0,incomeGen:0},[b.Road]:{type:b.Road,cost:10,name:"Road",description:"Connects buildings.",color:"#374151",popGen:0,incomeGen:0},[b.Residential]:{type:b.Residential,cost:100,name:"House",description:"+5 Pop/day",color:"#f87171",popGen:5,incomeGen:0},[b.Commercial]:{type:b.Commercial,cost:200,name:"Shop",description:"+$15/day",color:"#60a5fa",popGen:0,incomeGen:15},[b.Industrial]:{type:b.Industrial,cost:400,name:"Factory",description:"+$40/day",color:"#facc15",popGen:0,incomeGen:40},[b.Park]:{type:b.Park,cost:50,name:"Park",description:"Looks nice.",color:"#4ade80",popGen:1,incomeGen:0}},qe="sky-metropolis-db",O="saves",W="current-save",Ze=1;class Xe{db=null;dbReady;constructor(){this.dbReady=this.initDB()}initDB(){return new Promise((n,s)=>{if(typeof window>"u"||!window.indexedDB){n();return}const a=indexedDB.open(qe,1);a.onerror=()=>{console.error("Failed to open IndexedDB:",a.error),s(a.error)},a.onsuccess=()=>{this.db=a.result,n()},a.onupgradeneeded=t=>{const r=t.target.result;r.objectStoreNames.contains(O)||r.createObjectStore(O)}})}async save(n,s){await this.dbReady;const a={grid:n,stats:s,savedAt:Date.now(),version:Ze};return this.db?new Promise(t=>{const c=this.db.transaction([O],"readwrite").objectStore(O).put(a,W);c.onsuccess=()=>t(!0),c.onerror=()=>{console.error("IndexedDB save failed, trying localStorage"),t(this.saveToLocalStorage(a))}}):this.saveToLocalStorage(a)}saveToLocalStorage(n){try{return ve(W,n),!0}catch(s){return console.error("localStorage save failed:",s),!1}}async load(){if(await this.dbReady,this.db){const n=await new Promise(s=>{const r=this.db.transaction([O],"readonly").objectStore(O).get(W);r.onsuccess=()=>s(r.result||null),r.onerror=()=>{console.error("IndexedDB load failed, trying localStorage"),s(null)}});if(n)return n}return this.loadFromLocalStorage()}loadFromLocalStorage(){try{const n=ye(W,!0);if(n)return n}catch(n){console.error("localStorage load failed:",n)}return null}async deleteSave(){if(await this.dbReady,this.db)return new Promise(n=>{const t=this.db.transaction([O],"readwrite").objectStore(O).delete(W);t.onsuccess=()=>n(!0),t.onerror=()=>n(!1)});try{return we(W),!0}catch{return!1}}async hasSave(){return await this.load()!==null}}const ee=new Xe;function Ke(o,n=Math.PI/3){const s=Math.cos(n),a=(1+1e-10)*100,t=[new L,new L,new L],r=new L,i=new L,c=new L,m=new L;function u(j){const x=~~(j.x*a),y=~~(j.y*a),h=~~(j.z*a);return`${x},${y},${h}`}const d=o.index?o.toNonIndexed():o,p=d.attributes.position,g={};for(let j=0,x=p.count/3;j<x;j++){const y=3*j,h=t[0].fromBufferAttribute(p,y+0),v=t[1].fromBufferAttribute(p,y+1),_=t[2].fromBufferAttribute(p,y+2);r.subVectors(_,v),i.subVectors(h,v);const M=new L().crossVectors(r,i).normalize();for(let G=0;G<3;G++){const z=t[G],S=u(z);S in g||(g[S]=[]),g[S].push(M)}}const f=new Float32Array(p.count*3),w=new Ne(f,3,!1);for(let j=0,x=p.count/3;j<x;j++){const y=3*j,h=t[0].fromBufferAttribute(p,y+0),v=t[1].fromBufferAttribute(p,y+1),_=t[2].fromBufferAttribute(p,y+2);r.subVectors(_,v),i.subVectors(h,v),c.crossVectors(r,i).normalize();for(let M=0;M<3;M++){const G=t[M],z=u(G),S=g[z];m.set(0,0,0);for(let k=0,C=S.length;k<C;k++){const N=S[k];c.dot(N)>s&&m.add(N)}m.normalize(),w.setXYZ(y+M,m.x,m.y,m.z)}}return d.setAttribute("normal",w),d}const le=Oe({screenspace:!1,color:new H("black"),opacity:1,thickness:.05,size:new he},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${Se>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function Je({color:o="black",opacity:n=1,transparent:s=!1,screenspace:a=!1,toneMapped:t=!0,polygonOffset:r=!1,polygonOffsetFactor:i=0,renderOrder:c=0,thickness:m=.05,angle:u=Math.PI,clippingPlanes:d,...p}){const g=l.useRef(null),[f]=l.useState(()=>new le({side:Re})),{gl:w}=I(),j=w.getDrawingBufferSize(new he);l.useMemo(()=>je({OutlinesMaterial:le}),[]);const x=l.useRef(0),y=l.useRef(null);return l.useLayoutEffect(()=>{const h=g.current;if(!h)return;const v=h.parent;if(v&&v.geometry&&(x.current!==u||y.current!==v.geometry)){var _;x.current=u,y.current=v.geometry;let M=(_=h.children)==null?void 0:_[0];M&&(u&&M.geometry.dispose(),h.remove(M)),v.skeleton?(M=new _e,M.material=f,M.bind(v.skeleton,v.bindMatrix),h.add(M)):v.isInstancedMesh?(M=new Ce(v.geometry,f,v.count),M.instanceMatrix=v.instanceMatrix,h.add(M)):(M=new Ie,M.material=f,h.add(M)),M.geometry=u?Ke(v.geometry,u):v.geometry,M.morphTargetInfluences=v.morphTargetInfluences,M.morphTargetDictionary=v.morphTargetDictionary}}),l.useLayoutEffect(()=>{const h=g.current;if(!h)return;const v=h.children[0];if(v){v.renderOrder=c;const _=h.parent;ae(v,{morphTargetInfluences:_.morphTargetInfluences,morphTargetDictionary:_.morphTargetDictionary}),ae(v.material,{transparent:s,thickness:m,color:o,opacity:n,size:j,screenspace:a,toneMapped:t,polygonOffset:r,polygonOffsetFactor:i,clippingPlanes:d,clipping:d&&d.length>0})}}),l.useEffect(()=>()=>{const h=g.current;if(!h)return;const v=h.children[0];v&&(u&&v.geometry.dispose(),h.remove(v))},[]),l.createElement("group",se({ref:g},p))}function Qe(o,n,s){const a=I(f=>f.size),t=I(f=>f.viewport),r=typeof o=="number"?o:a.width*t.dpr,i=a.height*t.dpr,c=(typeof o=="number"?s:o)||{},{samples:m=0,depth:u,...d}=c,p=u??c.depthBuffer,g=l.useMemo(()=>{const f=new Ee(r,i,{minFilter:ie,magFilter:ie,type:Te,...d});return p&&(f.depthTexture=new Pe(r,i,Ae)),f.samples=m,f},[]);return l.useLayoutEffect(()=>{g.setSize(r,i),m&&(g.samples=m)},[m,g,r,i]),l.useEffect(()=>()=>g.dispose(),[]),g}const et=o=>typeof o=="function",tt=l.forwardRef(({envMap:o,resolution:n=256,frames:s=1/0,children:a,makeDefault:t,...r},i)=>{const c=I(({set:x})=>x),m=I(({camera:x})=>x),u=I(({size:x})=>x),d=l.useRef(null);l.useImperativeHandle(i,()=>d.current,[]);const p=l.useRef(null),g=Qe(n);l.useLayoutEffect(()=>{r.manual||d.current.updateProjectionMatrix()},[u,r]),l.useLayoutEffect(()=>{d.current.updateProjectionMatrix()}),l.useLayoutEffect(()=>{if(t){const x=m;return c(()=>({camera:d.current})),()=>c(()=>({camera:x}))}},[d,t,c]);let f=0,w=null;const j=et(a);return U(x=>{j&&(s===1/0||f<s)&&(p.current.visible=!1,x.gl.setRenderTarget(g),w=x.scene.background,o&&(x.scene.background=o),x.gl.render(x.scene,d.current),x.scene.background=w,x.gl.setRenderTarget(null),p.current.visible=!0,f++)}),l.createElement(l.Fragment,null,l.createElement("orthographicCamera",se({left:u.width/-2,right:u.width/2,top:u.height/2,bottom:u.height/-2,ref:d},r),!j&&a),l.createElement("group",{ref:p},j&&a(g.texture)))}),ot=l.forwardRef((o={enableDamping:!0},n)=>{const{domElement:s,camera:a,makeDefault:t,onChange:r,onStart:i,onEnd:c,...m}=o,u=I(h=>h.invalidate),d=I(h=>h.camera),p=I(h=>h.gl),g=I(h=>h.events),f=I(h=>h.set),w=I(h=>h.get),j=s||g.connected||p.domElement,x=a||d,y=l.useMemo(()=>new Me(x),[x]);return l.useEffect(()=>{y.connect(j);const h=v=>{u(),r&&r(v)};return y.addEventListener("change",h),i&&y.addEventListener("start",i),c&&y.addEventListener("end",c),()=>{y.dispose(),y.removeEventListener("change",h),i&&y.removeEventListener("start",i),c&&y.removeEventListener("end",c)}},[r,i,c,y,u,j]),l.useEffect(()=>{if(t){const h=w().controls;return f({controls:y}),()=>f({controls:h})}},[t,y]),U(()=>y.update(),-1),l.createElement("primitive",se({ref:n,object:y,enableDamping:!0},m))}),rt=({focus:o=0,size:n=25,samples:s=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${n})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${o});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${s}; i ++) {
    offset = (vogelDiskSample(j, ${s}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${s}; i++) {
    vogelSample = vogelDiskSample(j, ${s}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${n}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${s}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`;function ce(o,n,s){n.traverse(a=>{a.material&&(o.properties.remove(a.material),a.material.dispose==null||a.material.dispose())}),o.info.programs.length=0,o.compile(n,s)}function nt({focus:o=0,samples:n=10,size:s=25}){const a=I(i=>i.gl),t=I(i=>i.scene),r=I(i=>i.camera);return l.useEffect(()=>{const i=Q.shadowmap_pars_fragment;return Q.shadowmap_pars_fragment=Q.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP",`#ifdef USE_SHADOWMAP
`+rt({size:s,samples:n,focus:o})).replace("#if defined( SHADOWMAP_TYPE_PCF )",`
return PCSS(shadowMap, shadowCoord);
#if defined( SHADOWMAP_TYPE_PCF )`),ce(a,t,r),()=>{Q.shadowmap_pars_fragment=i,ce(a,t,r)}},[o,s,n]),null}const st=l.forwardRef(({children:o,enabled:n=!0,speed:s=1,rotationIntensity:a=1,floatIntensity:t=1,floatingRange:r=[-.1,.1],autoInvalidate:i=!1,...c},m)=>{const u=l.useRef(null);l.useImperativeHandle(m,()=>u.current,[]);const d=l.useRef(Math.random()*1e4);return U(p=>{var g,f;if(!n||s===0)return;i&&p.invalidate();const w=d.current+p.clock.elapsedTime;u.current.rotation.x=Math.cos(w/4*s)/8*a,u.current.rotation.y=Math.sin(w/4*s)/8*a,u.current.rotation.z=Math.sin(w/4*s)/20*a;let j=Math.sin(w/4*s)/10;j=ne.mapLinear(j,-.1,.1,(g=r?.[0])!==null&&g!==void 0?g:-.1,(f=r?.[1])!==null&&f!==void 0?f:.1),u.current.position.y=j*t,u.current.updateMatrix()}),l.createElement("group",c,l.createElement("group",{ref:u,matrixAutoUpdate:!1},o))}),de=T/2-.5,q=(o,n)=>[o-de,0,n-de],Z=(o,n)=>Math.abs(Math.sin(o*12.9898+n*78.233)*43758.5453)%1,A=(o,n)=>Math.random()*(n-o)+o,R=new Ge(1,1,1),Y=new Be(1,1,1,8),te=new De(1,1,4),xe=new ze(1,8,8),$=K.memo(({position:o,scale:n})=>e.jsx("mesh",{geometry:R,position:o,scale:n,children:e.jsx("meshStandardMaterial",{color:"#bfdbfe",emissive:"#bfdbfe",emissiveIntensity:.2,roughness:.1,metalness:.8})})),at=({position:o})=>{const n=l.useRef(null);return U(s=>{n.current&&n.current.children.forEach((a,t)=>{const r=a;r.position.y+=.01+t*.005,r.scale.addScalar(.005);const i=r.material;i&&(i.opacity-=.005,r.position.y>1.5&&(r.position.y=0,r.scale.setScalar(.1+Math.random()*.1),i.opacity=.6))})}),e.jsxs("group",{position:o,children:[e.jsx("mesh",{geometry:Y,castShadow:!0,receiveShadow:!0,position:[0,.5,0],scale:[.2,1,.2],children:e.jsx("meshStandardMaterial",{color:"#4b5563"})}),e.jsx("group",{ref:n,position:[0,1,0],children:[0,1,2].map(s=>e.jsx("mesh",{geometry:xe,position:[Math.random()*.1,s*.4,Math.random()*.1],scale:.2,children:e.jsx("meshStandardMaterial",{color:"#d1d5db",transparent:!0,opacity:.6,flatShading:!0})},s))})]})},ue=K.memo(({type:o,baseColor:n,x:s,y:a,opacity:t=1,transparent:r=!1})=>{const i=Z(s,a),c=Math.floor(i*100),m=Math.floor(i*4)*(Math.PI/2),u=l.useMemo(()=>{const j=new H(n);return j.offsetHSL(i*.1-.05,0,i*.2-.1),j},[n,i]),d=l.useMemo(()=>new P({color:u,flatShading:!0,opacity:t,transparent:r,roughness:.8}),[u,t,r]),p=l.useMemo(()=>new P({color:new H(u).multiplyScalar(.7),flatShading:!0,opacity:t,transparent:r}),[u,t,r]),g=l.useMemo(()=>new P({color:new H(u).multiplyScalar(.5).offsetHSL(0,0,-.1),flatShading:!0,opacity:t,transparent:r}),[u,t,r]),f={castShadow:!0,receiveShadow:!0},w=-.3;return e.jsx("group",{rotation:[0,m,0],position:[0,w,0],children:(()=>{switch(o){case b.Residential:return c<33?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...f,material:d,geometry:R,position:[0,.3,0],scale:[.7,.6,.6]}),e.jsx("mesh",{...f,material:g,geometry:te,position:[0,.75,0],scale:[.6,.4,.6],rotation:[0,Math.PI/4,0]}),e.jsx($,{position:[.2,.3,.31],scale:[.15,.2,.05]}),e.jsx($,{position:[-.2,.3,.31],scale:[.15,.2,.05]}),e.jsx("mesh",{...f,material:p,geometry:R,position:[0,.1,.32],scale:[.15,.2,.05]})]}):c<66?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...f,material:d,geometry:R,position:[-.1,.35,0],scale:[.6,.7,.8]}),e.jsx("mesh",{...f,material:p,geometry:R,position:[.25,.25,.1],scale:[.4,.5,.6]}),e.jsx($,{position:[-.1,.5,.41],scale:[.4,.2,.05]})]}):e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...f,material:d,geometry:R,position:[0,.5,0],scale:[.5,1,.6]}),e.jsx("mesh",{...f,material:g,geometry:R,position:[0,1.05,0],scale:[.55,.1,.65]}),e.jsx($,{position:[0,.7,.31],scale:[.3,.2,.05]}),e.jsx($,{position:[0,.3,.31],scale:[.3,.2,.05]})]});case b.Commercial:if(c<40){const y=1.5+i*1.5;return e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...f,material:d,geometry:R,position:[0,y/2,0],scale:[.7,y,.7]}),Array.from({length:Math.floor(y*3)}).map((h,v)=>e.jsx($,{position:[0,.2+v*.3,0],scale:[.72,.15,.72]},v)),e.jsx("mesh",{...f,material:p,geometry:R,position:[0,y+.1,0],scale:[.5,.2,.5]})]})}else return c<70?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...f,material:d,geometry:R,position:[0,.4,0],scale:[.9,.8,.8]}),e.jsx($,{position:[0,.3,.41],scale:[.8,.4,.05]}),e.jsx("mesh",{...f,material:new P({color:i>.5?"#ef4444":"#3b82f6"}),geometry:R,position:[0,.55,.5],scale:[.9,.1,.2],rotation:[Math.PI/6,0,0]})]}):e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...f,material:d,geometry:R,position:[-.2,.5,-.2],scale:[.5,1,.5]}),e.jsx("mesh",{...f,material:p,geometry:R,position:[.1,.3,.1],scale:[.7,.6,.7]}),e.jsx($,{position:[.1,.3,.46],scale:[.6,.3,.05]}),e.jsx("mesh",{...f,material:new P({color:"#9ca3af"}),geometry:R,position:[.2,.65,.2],scale:[.2,.1,.2]})]});case b.Industrial:return c<50?e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...f,material:d,geometry:R,position:[0,.4,0],scale:[.9,.8,.8]}),e.jsx("mesh",{...f,material:g,geometry:R,position:[-.2,.9,0],scale:[.4,.2,.8],rotation:[0,0,Math.PI/4]}),e.jsx("mesh",{...f,material:g,geometry:R,position:[.2,.9,0],scale:[.4,.2,.8],rotation:[0,0,Math.PI/4]}),e.jsx(at,{position:[.3,.4,.3]})]}):e.jsxs(e.Fragment,{children:[e.jsx("mesh",{...f,material:d,geometry:R,position:[-.2,.3,0],scale:[.5,.6,.9]}),e.jsx("mesh",{...f,material:p,geometry:Y,position:[.25,.4,-.2],scale:[.2,.8,.2]}),e.jsx("mesh",{...f,material:p,geometry:Y,position:[.25,.4,.25],scale:[.2,.8,.2]}),e.jsx("mesh",{...f,material:new P({color:"#6b7280"}),geometry:R,position:[.25,.7,0],scale:[.05,.05,.5]})]});case b.Park:const j=1+Math.floor(i*3),x=[[-.2,-.2],[.2,.2],[-.2,.2],[.2,-.2]];return e.jsxs("group",{position:[0,-w-.29,0],children:[" ",e.jsxs("mesh",{receiveShadow:!0,rotation:[-Math.PI/2,0,0],position:[0,.01,0],children:[e.jsx("planeGeometry",{args:[.9,.9]}),e.jsx("meshStandardMaterial",{color:"#86efac"})]}),c<30&&e.jsxs("group",{position:[0,.05,0],children:[e.jsx("mesh",{material:new P({color:"#cbd5e1"}),geometry:Y,scale:[.4,.1,.4],castShadow:!0,receiveShadow:!0}),e.jsx("mesh",{material:new P({color:"#3b82f6",roughness:.1}),geometry:Y,position:[0,.06,0],scale:[.3,.05,.3]})]}),Array.from({length:j}).map((y,h)=>{const v=x[h%x.length],_=.5+Z(s+h,a-h)*.5,M=new H("#166534").offsetHSL(0,0,Z(s,a+h)*.2);return e.jsxs("group",{position:[v[0],0,v[1]],scale:_,rotation:[0,Z(h,s)*Math.PI,0],children:[e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:new P({color:"#78350f"}),geometry:Y,position:[0,.15,0],scale:[.1,.3,.1]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:new P({color:M,flatShading:!0}),geometry:te,position:[0,.4,0],scale:[.4,.5,.4]}),e.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:new P({color:M,flatShading:!0}),geometry:te,position:[0,.65,0],scale:[.3,.4,.3]})]},h)})]});case b.Road:return null;default:return null}})()})}),me=["#ef4444","#3b82f6","#eab308","#ffffff","#1f2937","#f97316"],it=({grid:o})=>{const n=l.useMemo(()=>{const i=[];return o.forEach(c=>c.forEach(m=>{m.buildingType===b.Road&&i.push({x:m.x,y:m.y})})),i},[o]),s=Math.min(n.length,30),a=l.useRef(null),t=l.useRef(new Float32Array(0)),r=l.useMemo(()=>new pe,[]);return l.useMemo(()=>new Float32Array(0),[]),l.useEffect(()=>{if(n.length<2)return;t.current=new Float32Array(s*6);const i=new Float32Array(s*3);for(let c=0;c<s;c++){const m=n[Math.floor(Math.random()*n.length)];t.current[c*6+0]=m.x,t.current[c*6+1]=m.y,t.current[c*6+2]=m.x,t.current[c*6+3]=m.y,t.current[c*6+4]=1,t.current[c*6+5]=A(.01,.03);const u=new H(me[Math.floor(Math.random()*me.length)]);i[c*3]=u.r,i[c*3+1]=u.g,i[c*3+2]=u.b}a.current&&(a.current.instanceColor=new ge(i,3))},[n,s]),U(()=>{if(!(!a.current||n.length<2||t.current.length===0)){for(let i=0;i<s;i++){const c=i*6;let m=t.current[c],u=t.current[c+1],d=t.current[c+2],p=t.current[c+3],g=t.current[c+4];const f=t.current[c+5];if(g+=f,g>=1){m=d,u=p,g=0;const C=n.filter(N=>Math.abs(N.x-m)===1&&N.y===u||Math.abs(N.y-u)===1&&N.x===m);if(C.length>0){const N=C.length>1?C.filter(D=>Math.abs(D.x-t.current[c])>.1||Math.abs(D.y-t.current[c+1])>.1):C,F=N.length>0?N[Math.floor(Math.random()*N.length)]:C[0];d=F.x,p=F.y}else{const N=n[Math.floor(Math.random()*n.length)];m=N.x,u=N.y,d=N.x,p=N.y}}t.current[c]=m,t.current[c+1]=u,t.current[c+2]=d,t.current[c+3]=p,t.current[c+4]=g;const w=ne.lerp(m,d,g),j=ne.lerp(u,p,g),x=d-m,y=p-u,h=Math.atan2(y,x),v=.15,_=Math.sqrt(x*x+y*y)||1,M=-y/_*v,G=x/_*v,[z,S,k]=q(w+M,j+G);r.position.set(z,-.3+.075,k),r.rotation.set(0,-h,0),r.scale.set(.5,.15,.3),r.updateMatrix(),a.current.setMatrixAt(i,r.matrix)}a.current.instanceMatrix.needsUpdate=!0}}),n.length<2?null:e.jsx("instancedMesh",{ref:a,args:[R,void 0,s],castShadow:!0,children:e.jsx("meshStandardMaterial",{roughness:.5,metalness:.3})})},fe=["#ef4444","#3b82f6","#10b981","#f59e0b","#8b5cf6","#ec4899","#ffffff"],lt=({population:o,grid:n})=>{const s=Math.min(Math.floor(o/2),300),a=l.useRef(null),t=l.useMemo(()=>{const c=[];return n.forEach(m=>m.forEach(u=>{(u.buildingType===b.Road||u.buildingType===b.Park||u.buildingType===b.None)&&c.push({x:u.x,y:u.y})})),c},[n]),r=l.useRef(new Float32Array(0)),i=l.useMemo(()=>new pe,[]);return l.useEffect(()=>{if(s===0||t.length===0)return;r.current=new Float32Array(s*6);const c=new Float32Array(s*3);for(let m=0;m<s;m++){const u=t[Math.floor(Math.random()*t.length)],d=u.x+A(-.4,.4),p=u.y+A(-.4,.4);r.current[m*6+0]=d,r.current[m*6+1]=p;const g=t[Math.floor(Math.random()*t.length)];r.current[m*6+2]=g.x+A(-.4,.4),r.current[m*6+3]=g.y+A(-.4,.4),r.current[m*6+4]=A(.005,.015),r.current[m*6+5]=Math.random()*Math.PI*2;const f=new H(fe[Math.floor(Math.random()*fe.length)]);c[m*3]=f.r,c[m*3+1]=f.g,c[m*3+2]=f.b}a.current&&(a.current.instanceColor=new ge(c,3))},[s,t]),U(c=>{if(!a.current||s===0||r.current.length===0)return;const m=c.clock.elapsedTime;for(let u=0;u<s;u++){const d=u*6;let p=r.current[d],g=r.current[d+1],f=r.current[d+2],w=r.current[d+3];const j=r.current[d+4],x=r.current[d+5],y=f-p,h=w-g,v=Math.sqrt(y*y+h*h);if(v<.1){if(t.length>0){const N=t[Math.floor(Math.random()*t.length)];f=N.x+A(-.4,.4),w=N.y+A(-.4,.4),r.current[d+2]=f,r.current[d+3]=w}}else p+=y/v*j,g+=h/v*j,r.current[d]=p,r.current[d+1]=g;const[_,M,G]=q(p,g),z=Math.abs(Math.sin(m*10+x))*.03,S=.2,k=.08;i.position.set(_,-.35+S/2+z,G),i.rotation.set(0,-Math.atan2(h,y),0),i.scale.set(k,S,k),i.updateMatrix(),a.current.setMatrixAt(u,i.matrix)}a.current.instanceMatrix.needsUpdate=!0}),s===0?null:e.jsx("instancedMesh",{ref:a,args:[R,void 0,s],castShadow:!0,children:e.jsx("meshStandardMaterial",{roughness:.8})})},oe=({position:o,scale:n,speed:s})=>{const a=l.useRef(null);U((r,i)=>{a.current&&(a.current.position.x+=s*i,a.current.position.x>T*1.5&&(a.current.position.x=-T*1.5))});const t=l.useMemo(()=>Array.from({length:5+Math.random()*5}).map(()=>({pos:[A(-1,1),A(-.5,.5),A(-1,1)],scale:A(.5,1.2)})),[]);return e.jsx("group",{ref:a,position:o,scale:n,children:t.map((r,i)=>e.jsx("mesh",{geometry:xe,position:r.pos,scale:r.scale,castShadow:!0,children:e.jsx("meshStandardMaterial",{color:"white",flatShading:!0,opacity:.9,transparent:!0})},i))})},re=({position:o,speed:n,offset:s})=>{const a=l.useRef(null);return U(t=>{if(a.current){const r=t.clock.elapsedTime+s;a.current.position.x=o[0]+Math.sin(r*n)*T,a.current.position.z=o[1]+Math.cos(r*n)*T/2,a.current.rotation.y=-r*n+Math.PI,a.current.scale.y=1+Math.sin(r*15)*.3}}),e.jsxs("group",{ref:a,position:[o[0],o[2],o[1]],children:[e.jsx("mesh",{geometry:R,scale:[.2,.05,.05],position:[.1,0,0],rotation:[0,Math.PI/4,0],children:e.jsx("meshBasicMaterial",{color:"#333"})}),e.jsx("mesh",{geometry:R,scale:[.2,.05,.05],position:[-.1,0,0],rotation:[0,-Math.PI/4,0],children:e.jsx("meshBasicMaterial",{color:"#333"})})]})},ct=()=>e.jsxs("group",{raycast:()=>null,children:[e.jsx(oe,{position:[-12,8,4],scale:1.5,speed:.3}),e.jsx(oe,{position:[5,9,-8],scale:1.2,speed:.5}),e.jsx(oe,{position:[15,7,10],scale:1.8,speed:.2}),e.jsxs("group",{position:[0,0,0],scale:.8,children:[e.jsx(re,{position:[0,0,10],speed:.6,offset:0}),e.jsx(re,{position:[0,0,10],speed:.6,offset:1.2}),e.jsx(re,{position:[0,0,10],speed:.6,offset:2.5})]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.6,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[T*4,T*4]}),e.jsx("meshStandardMaterial",{color:"#3b82f6",roughness:.1,metalness:.5,opacity:.8,transparent:!0})]})]}),dt=K.memo(({x:o,y:n,grid:s,yOffset:a})=>{const t=l.useMemo(()=>new P({color:"#fbbf24"}),[]),r=l.useMemo(()=>new Fe(.1,.5),[]),i=n>0&&s[n-1][o].buildingType===b.Road,c=n<T-1&&s[n+1][o].buildingType===b.Road,m=o>0&&s[n][o-1].buildingType===b.Road,u=o<T-1&&s[n][o+1].buildingType===b.Road;return[i,c,m,u].filter(Boolean).length===0?e.jsx("mesh",{rotation:[-Math.PI/2,0,0],position:[0,a,0],geometry:r,material:t}):e.jsxs("group",{rotation:[-Math.PI/2,0,0],position:[0,a,0],children:[(i||c)&&(m||u)&&e.jsx("mesh",{position:[0,0,.005],material:t,children:e.jsx("planeGeometry",{args:[.12,.12]})}),i&&e.jsx("mesh",{position:[0,.25,0],geometry:r,material:t}),c&&e.jsx("mesh",{position:[0,-.25,0],geometry:r,material:t}),m&&e.jsx("mesh",{position:[-.25,0,0],rotation:[0,0,Math.PI/2],geometry:r,material:t}),u&&e.jsx("mesh",{position:[.25,0,0],rotation:[0,0,Math.PI/2],geometry:r,material:t})]})}),ut=K.memo(({type:o,x:n,y:s,grid:a,onHover:t,onLeave:r,onClick:i})=>{const[c,m,u]=q(n,s);let d="#10b981",p=-.3,g=.5;if(o===b.None){const w=Z(n,s);d=w>.7?"#059669":w>.3?"#10b981":"#34d399",p=-.3-w*.1}else o===b.Road?(d="#374151",p=-.29):(d="#d1d5db",p=-.28);const f=p-g/2;return e.jsxs("mesh",{position:[c,f,u],receiveShadow:!0,castShadow:!0,onPointerEnter:w=>{w.stopPropagation(),t(n,s)},onPointerOut:w=>{w.stopPropagation(),r()},onPointerDown:w=>{w.stopPropagation(),w.button===0&&i(n,s)},children:[e.jsx("boxGeometry",{args:[1,g,1]}),e.jsx("meshStandardMaterial",{color:d,flatShading:!0,roughness:1}),o===b.Road&&e.jsx(dt,{x:n,y:s,grid:a,yOffset:g/2+.001})]})}),mt=({x:o,y:n,color:s})=>{const[a,t,r]=q(o,n);return e.jsxs("mesh",{position:[a,-.25,r],rotation:[-Math.PI/2,0,0],raycast:()=>null,children:[e.jsx("planeGeometry",{args:[1,1]}),e.jsx("meshBasicMaterial",{color:s,transparent:!0,opacity:.4,side:Le,depthTest:!1}),e.jsx(Je,{thickness:.05,color:"white"})]})},ft=({grid:o,onTileClick:n,hoveredTool:s,population:a})=>{const[t,r]=l.useState(null),i=l.useCallback((g,f)=>{r({x:g,y:f})},[]),c=l.useCallback(()=>{r(null)},[]),m=t&&o[t.y][t.x].buildingType===b.None&&s!==b.None,u=m?X[s].color:"white",d=s===b.None,p=t?q(t.x,t.y):[0,0,0];return e.jsx("div",{className:"absolute inset-0 bg-sky-900 touch-none",children:e.jsxs(ke,{shadows:!0,dpr:[1,1.5],gl:{antialias:!0},children:[e.jsx(tt,{makeDefault:!0,zoom:45,position:[20,20,20],near:-100,far:200}),e.jsx(ot,{enableRotate:!0,enableZoom:!0,minZoom:20,maxZoom:120,maxPolarAngle:Math.PI/2.2,minPolarAngle:.1,target:[0,-.5,0]}),e.jsx("ambientLight",{intensity:.5,color:"#cceeff"}),e.jsx("directionalLight",{castShadow:!0,position:[15,20,10],intensity:2,color:"#fffbeb","shadow-mapSize":[2048,2048],"shadow-camera-left":-15,"shadow-camera-right":15,"shadow-camera-top":15,"shadow-camera-bottom":-15}),e.jsx($e,{preset:"city"}),e.jsx(ct,{}),e.jsxs("group",{children:[o.map((g,f)=>g.map((w,j)=>{const[x,y,h]=q(j,f);return e.jsxs(K.Fragment,{children:[e.jsx(ut,{type:w.buildingType,x:j,y:f,grid:o,onHover:i,onLeave:c,onClick:n}),e.jsx("group",{position:[x,0,h],raycast:()=>null,children:w.buildingType!==b.None&&w.buildingType!==b.Road&&e.jsx(ue,{type:w.buildingType,baseColor:X[w.buildingType].color,x:j,y:f})})]},`${j}-${f}`)})),e.jsxs("group",{raycast:()=>null,children:[e.jsx(it,{grid:o}),e.jsx(lt,{population:a,grid:o}),m&&t&&e.jsx("group",{position:[p[0],0,p[2]],children:e.jsx(st,{speed:3,rotationIntensity:0,floatIntensity:.1,floatingRange:[0,.1],children:e.jsx(ue,{type:s,baseColor:u,x:t.x,y:t.y,transparent:!0,opacity:.7})})}),t&&e.jsx(mt,{x:t.x,y:t.y,color:d?"#ef4444":m?"#ffffff":"#000000"})]})]}),e.jsx(nt,{size:10,samples:8})]})})},ht=[b.None,b.Road,b.Residential,b.Commercial,b.Industrial,b.Park],pt=({type:o,isSelected:n,onClick:s,money:a})=>{const t=X[o],r=a>=t.cost,i=o===b.None,c=t.color;return e.jsxs("button",{onClick:s,disabled:!i&&!r,className:`
        relative flex flex-col items-center justify-center rounded-lg border-2 transition-all shadow-lg backdrop-blur-sm shrink-0
        w-14 h-14 md:w-16 md:h-16
        ${n?"border-white bg-white/20 scale-110 z-10":"border-gray-600 bg-gray-900/80 hover:bg-gray-800"}
        ${!i&&!r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
      `,title:t.description,children:[e.jsxs("div",{className:"w-6 h-6 md:w-8 md:h-8 rounded mb-0.5 md:mb-1 border border-black/30 shadow-inner flex items-center justify-center overflow-hidden",style:{backgroundColor:i?"transparent":c},children:[i&&e.jsx("div",{className:"w-full h-full bg-red-600 text-white flex justify-center items-center font-bold text-base md:text-lg",children:"âœ•"}),o===b.Road&&e.jsx("div",{className:"w-full h-2 bg-gray-800 transform -rotate-45"})]}),e.jsx("span",{className:"text-[8px] md:text-[10px] font-bold text-white uppercase tracking-wider drop-shadow-md leading-none",children:t.name}),t.cost>0&&e.jsxs("span",{className:`text-[8px] md:text-[10px] font-mono leading-none ${r?"text-green-300":"text-red-400"}`,children:["$",t.cost]})]})},gt=({stats:o,selectedTool:n,onSelectTool:s,newsFeed:a,saveSettings:t,onSave:r,onToggleAutoSave:i,onClearNewsFeed:c})=>{const m=l.useRef(null);l.useEffect(()=>{m.current&&(m.current.scrollTop=m.current.scrollHeight)},[a]);const u=()=>t.lastSavedAt?new Date(t.lastSavedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Never";return e.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col justify-between p-2 md:p-4 font-sans z-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-start pointer-events-auto gap-2 w-full max-w-full",children:[e.jsxs("div",{className:"bg-gray-900/90 text-white p-2 md:p-3 rounded-xl border border-gray-700 shadow-2xl backdrop-blur-md flex gap-3 md:gap-6 items-center justify-between md:justify-start w-full md:w-auto",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:"Treasury"}),e.jsxs("span",{className:"text-lg md:text-2xl font-black text-green-400 font-mono drop-shadow-md",children:["$",o.money.toLocaleString()]})]}),e.jsx("div",{className:"w-px h-6 md:h-8 bg-gray-700"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:"Citizens"}),e.jsx("span",{className:"text-base md:text-xl font-bold text-blue-300 font-mono drop-shadow-md",children:o.population.toLocaleString()})]}),e.jsx("div",{className:"w-px h-6 md:h-8 bg-gray-700"}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] text-gray-400 uppercase font-bold tracking-widest",children:"Day"}),e.jsx("span",{className:"text-base md:text-lg font-bold text-white font-mono",children:o.day})]})]}),e.jsxs("div",{className:"bg-gray-900/90 text-white p-2 md:p-3 rounded-xl border border-gray-700 shadow-2xl backdrop-blur-md flex gap-2 md:gap-3 items-center",children:[e.jsxs("button",{onClick:r,className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-lg transition-colors text-xs font-bold uppercase tracking-wide",title:"Save Game",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),e.jsx("span",{className:"hidden md:inline",children:"Save"})]}),e.jsxs("button",{onClick:i,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg transition-colors text-xs font-bold uppercase tracking-wide ${t.autoSaveEnabled?"bg-green-600 hover:bg-green-500":"bg-gray-600 hover:bg-gray-500"}`,title:t.autoSaveEnabled?"Auto-save ON (every 30s)":"Auto-save OFF",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{className:"hidden md:inline",children:"Auto"})]}),e.jsxs("div",{className:"flex flex-col items-end text-[8px] md:text-[10px] leading-tight",children:[e.jsx("span",{className:"text-gray-400 uppercase font-bold tracking-widest",children:"Saved"}),e.jsx("span",{className:`font-mono ${t.lastSavedAt?"text-green-300":"text-gray-500"}`,children:u()})]})]})]}),e.jsxs("div",{className:"flex flex-col-reverse md:flex-row md:justify-between md:items-end pointer-events-auto mt-auto gap-2 w-full max-w-full",children:[e.jsxs("div",{className:"flex gap-1 md:gap-2 bg-gray-900/80 p-1 md:p-2 rounded-2xl border border-gray-600/50 backdrop-blur-xl shadow-2xl w-full md:w-auto overflow-x-auto no-scrollbar justify-start md:justify-start",children:[e.jsx("div",{className:"flex gap-1 md:gap-2 min-w-max px-1",children:ht.map(d=>e.jsx(pt,{type:d,isSelected:n===d,onClick:()=>s(d),money:o.money},d))}),e.jsx("div",{className:"text-[8px] text-gray-500 uppercase writing-mode-vertical flex items-center justify-center font-bold tracking-widest border-l border-gray-700 pl-1 ml-1 select-none",children:"Build"})]}),e.jsxs("div",{className:"w-full md:w-80 h-32 md:h-48 bg-black/80 text-white rounded-xl border border-gray-700/80 backdrop-blur-xl shadow-2xl flex flex-col overflow-hidden relative selection:bg-white/30 selection:text-white",children:[e.jsxs("div",{className:"bg-gray-800/90 px-3 py-1.5 text-[10px] font-bold uppercase tracking-widest text-gray-300 border-b border-gray-600 flex justify-between items-center",children:[e.jsx("span",{children:"City Feed"}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.length>0&&e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-red-400 transition-colors p-0.5 rounded hover:bg-white/10",title:"Clear feed",children:e.jsx(He,{className:"w-3 h-3"})}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"})]})]}),e.jsx("div",{className:"absolute inset-0 pointer-events-none bg-[linear-gradient(to_bottom,rgba(255,255,255,0)_50%,rgba(0,0,0,0.1)_50%)] bg-size-[100%_4px] opacity-30 z-20"}),e.jsxs("div",{ref:m,className:"flex-1 overflow-y-auto p-2 md:p-3 space-y-2 text-[10px] md:text-xs font-mono scroll-smooth mask-image-b z-10",children:[a.length===0&&e.jsx("div",{className:"text-gray-500 italic text-center mt-10",children:"No active news stream."}),a.map(d=>e.jsxs("div",{className:`
                border-l-2 pl-2 py-1 transition-all animate-fade-in leading-tight relative
                ${d.type==="positive"?"border-green-500 text-green-200 bg-green-900/20":""}
                ${d.type==="negative"?"border-red-500 text-red-200 bg-red-900/20":""}
                ${d.type==="neutral"?"border-blue-400 text-blue-100 bg-blue-900/20":""}
              `,children:[e.jsx("span",{className:"opacity-70 text-[8px] absolute top-0.5 right-1",children:new Date(Number(d.id.split(".")[0])).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),d.text]},d.id))]})]})]})]})},xt=({onStart:o,hasSavedGame:n})=>e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-50 text-white font-sans p-6 bg-black/30 backdrop-blur-sm transition-all duration-1000",children:e.jsxs("div",{className:"max-w-md w-full bg-slate-900/90 p-8 rounded-2xl border border-slate-700 shadow-2xl backdrop-blur-xl relative overflow-hidden animate-fade-in",children:[e.jsx("div",{className:"absolute -top-24 -right-24 w-48 h-48 bg-cyan-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsx("div",{className:"absolute -bottom-24 -left-24 w-48 h-48 bg-indigo-500/20 rounded-full blur-3xl pointer-events-none"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h1",{className:"text-5xl font-black mb-2 bg-linear-to-br from-white via-cyan-200 to-blue-400 bg-clip-text text-transparent tracking-tight",children:"SkyMetropolis"}),e.jsx("p",{className:"text-slate-400 mb-8 text-sm font-medium uppercase tracking-widest",children:"Isometric City Builder"}),e.jsxs("div",{className:"space-y-3",children:[n&&e.jsxs("button",{onClick:()=>o(!0),className:"w-full py-4 bg-linear-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold rounded-xl shadow-lg shadow-green-900/20 transform transition-all hover:scale-[1.02] active:scale-[0.98] text-lg tracking-wide flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Continue"]}),e.jsx("button",{onClick:()=>o(!1),className:`w-full py-4 text-white font-bold rounded-xl shadow-lg transform transition-all hover:scale-[1.02] active:scale-[0.98] text-lg tracking-wide ${n?"bg-linear-to-r from-slate-600 to-slate-700 hover:from-slate-500 hover:to-slate-600 shadow-slate-900/20":"bg-linear-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 shadow-cyan-900/20"}`,children:n?"New Game":"Start Building"})]})]})]})}),bt=()=>{const o=[];for(let n=0;n<T;n++){const s=[];for(let a=0;a<T;a++)s.push({x:a,y:n,buildingType:b.None});o.push(s)}return o};function vt(){const[o,n]=l.useState(!1),[s,a]=l.useState(bt),[t,r]=l.useState({money:Ye,population:0,day:1}),[i,c]=l.useState(b.Road),[m,u]=l.useState([]),[d,p]=l.useState({autoSaveEnabled:!0,lastSavedAt:null}),[g,f]=l.useState(!1),w=l.useRef(s),j=l.useRef(t);l.useEffect(()=>{w.current=s},[s]),l.useEffect(()=>{j.current=t},[t]);const x=l.useCallback(S=>{u(k=>[...k.slice(-12),S])},[]),y=l.useCallback(()=>{u([])},[]),h=l.useCallback(async(S=!1)=>{const k=await ee.save(w.current,j.current);return k?(p(C=>({...C,lastSavedAt:Date.now()})),S||x({id:Date.now().toString(),text:"City saved successfully.",type:"positive"})):S||x({id:Date.now().toString(),text:"Failed to save city data.",type:"negative"}),k},[x]),v=l.useCallback(async()=>{const S=await ee.load();return S?(a(S.grid),r(S.stats),p(k=>({...k,lastSavedAt:S.savedAt})),x({id:Date.now().toString(),text:`City restored from ${new Date(S.savedAt).toLocaleString()}.`,type:"positive"}),!0):!1},[x]),_=l.useCallback(()=>{p(S=>{const k=!S.autoSaveEnabled;return{...S,autoSaveEnabled:k}})},[]),M=l.useRef(!0);l.useEffect(()=>{if(M.current){M.current=!1;return}x({id:Date.now().toString(),text:d.autoSaveEnabled?"Auto-save enabled (every 30 seconds).":"Auto-save disabled.",type:"neutral"})},[d.autoSaveEnabled,x]),l.useEffect(()=>{ee.hasSave().then(f)},[]),l.useEffect(()=>{if(!o||!d.autoSaveEnabled)return;const S=setInterval(()=>{h(!0)},3e4);return()=>clearInterval(S)},[o,d.autoSaveEnabled,h]),l.useEffect(()=>{o&&x({id:Date.now().toString(),text:"Welcome to SkyMetropolis. Terrain generation complete.",type:"positive"})},[o,x]),l.useEffect(()=>{if(!o)return;const S=setInterval(()=>{let k=0,C=0,N={};w.current.flat().forEach(E=>{if(E.buildingType!==b.None){const B=X[E.buildingType];k+=B.incomeGen,C+=B.popGen,N[E.buildingType]=(N[E.buildingType]||0)+1}});const F=N[b.Residential]||0,D=F*50;r(E=>{let B=E.population+C;return B>D&&(B=D),F===0&&E.population>0&&(B=Math.max(0,E.population-5)),{money:E.money+k,population:B,day:E.day+1}})},We);return()=>clearInterval(S)},[o]);const G=l.useCallback((S,k)=>{if(!o)return;const C=w.current,N=j.current,F=i;if(S<0||S>=T||k<0||k>=T)return;const D=C[k][S],E=X[F];if(F===b.None){if(D.buildingType!==b.None)if(N.money>=5){const V=C.map(J=>[...J]);V[k][S]={...D,buildingType:b.None},a(V),r(J=>({...J,money:J.money-5}))}else x({id:Date.now().toString(),text:"Cannot afford demolition costs.",type:"negative"});return}if(D.buildingType===b.None)if(N.money>=E.cost){r(V=>({...V,money:V.money-E.cost}));const B=C.map(V=>[...V]);B[k][S]={...D,buildingType:F},a(B)}else x({id:Date.now().toString()+Math.random(),text:`Treasury insufficient for ${E.name}.`,type:"negative"})},[i,x,o]),z=async(S=!1)=>{S&&await v(),n(!0)};return e.jsxs("div",{className:"relative w-screen h-screen overflow-hidden selection:bg-transparent selection:text-transparent bg-sky-900",children:[e.jsx(ft,{grid:s,onTileClick:G,hoveredTool:i,population:t.population}),!o&&e.jsx(xt,{onStart:z,hasSavedGame:g}),o&&e.jsx(gt,{stats:t,selectedTool:i,onSelectTool:c,newsFeed:m,saveSettings:d,onSave:()=>h(!1),onToggleAutoSave:_,onClearNewsFeed:y}),e.jsx("style",{children:`
        @keyframes fade-in { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .animate-fade-in { animation: fade-in 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        .mask-image-b { -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%); mask-image: linear-gradient(to bottom, transparent 0%, black 15%); }
        
        /* Vertical text for toolbar label */
        .writing-mode-vertical { writing-mode: vertical-rl; text-orientation: mixed; }
        
        /* Custom scrollbar for news */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }
        `})]})}const Nt={fullscreen:!0};function Rt(){return[{title:"Sky Metropolis"},{property:"og:title",content:"Sky Metropolis"},{name:"description",content:"Sky Metropolis - A city building simulation game with isometric 3D graphics."}]}const _t=be(vt);export{_t as default,Nt as handle,Rt as meta};
